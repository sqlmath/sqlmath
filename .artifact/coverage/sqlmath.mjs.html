<!DOCTYPE html>
<html lang="en">
<head>
<title>V8 Coverage Report</title>
<style>
/* jslint utility2:true */
/*csslint ignore:start*/
.coverage,
.coverage a,
.coverage div,
.coverage pre,
.coverage span,
.coverage table,
.coverage tbody,
.coverage td,
.coverage th,
.coverage thead,
.coverage tr {
  box-sizing: border-box;
  font-family: monospace;
}
/*csslint ignore:end*/

/* css - coverage_report - general */
body {
  margin: 0;
}
.coverage pre {
  margin: 5px 0;
}
.coverage table {
  border-collapse: collapse;
}
.coverage td,
.coverage th {
  border: 1px solid #777;
  line-height: 20px;
  margin: 0;
  padding: 5px 10px;
}
.coverage td span {
  display: inline-block;
  width: 100%;
}
.coverage .content {
  padding: 0 5px;
}
.coverage .content a {
  text-decoration: none;
}
.coverage .count {
  margin: 0 5px;
  padding: 0 5px;
}
.coverage .footer,
.coverage .header {
  padding: 20px;
}
.coverage .footer {
  text-align: center;
}
.coverage .percentbar {
  height: 12px;
  margin: 2px 0;
  min-width: 200px;
  position: relative;
  width: 100%;
}
.coverage .percentbar div {
  height: 100%;
  position: absolute;
}
.coverage .title {
  font-size: large;
  font-weight: bold;
  margin-bottom: 10px;
}

/* css - coverage_report - color */
.coverage td,
.coverage th {
  background: #fff;
}
.coverage .count,
.coverage .coverageHigh {
  background: #9d9;
}
.coverage .count {
  color: #666;
}
.coverage .coverageIgnore {
  background: #ccc;
}
.coverage .coverageLow,
.coverage .uncovered {
  background: #ebb;
}
.coverage .coverageMedium {
  background: #fd7;
}
.coverage .footer,
.coverage .header,
.coverage .lineno {
  background: #ddd;
}
.coverage .percentbar {
  background: #999;
}
.coverage .percentbar div {
  background: #666;
}

/* css - coverage_report - important */
.coverage pre:hover span,
.coverage tr:hover td {
  background: #7d7;
}
.coverage pre:hover span.uncovered,
.coverage tr:hover td.coverageLow {
  background: #f99;
}
</style>
</head>
<body class="coverage">
<!-- header start -->
<div class="header">
<div class="title">V8 Coverage Report</div>
<table>
<thead>
  <tr>
  <th>Files covered</th>
  <th>Lines</th>
  <th>Remaining</th>
  </tr>
</thead>
<tbody>
<tr>
  <td class="coverageHigh">
      <a href="index.html">. / </a>sqlmath.mjs<br>
    <div class="percentbar">
      <div style="width: 100.00%;"></div>
    </div>
  </td>
  <td style="text-align: right;">
     100.00 %<br>
    1821 / 1821
  </td>
  <td style="text-align: right;">
    <br>
    0 / 1821
  </td>
  </tr>
</tbody>
</table>
</div>
<!-- header end -->
<!-- content start -->
<div class="content">
<pre><span class="lineno"><a href="#line_1" id="line_1">    1.</a></span><span class="count        ">      1</span><span>// MIT License</span></pre>
<pre><span class="lineno"><a href="#line_2" id="line_2">    2.</a></span><span class="count        ">      1</span><span>//</span></pre>
<pre><span class="lineno"><a href="#line_3" id="line_3">    3.</a></span><span class="count        ">      1</span><span>// Copyright (c) 2021 Kai Zhu</span></pre>
<pre><span class="lineno"><a href="#line_4" id="line_4">    4.</a></span><span class="count        ">      1</span><span>//</span></pre>
<pre><span class="lineno"><a href="#line_5" id="line_5">    5.</a></span><span class="count        ">      1</span><span>// Permission is hereby granted, free of charge, to any person obtaining a copy</span></pre>
<pre><span class="lineno"><a href="#line_6" id="line_6">    6.</a></span><span class="count        ">      1</span><span>// of this software and associated documentation files (the "Software"), to deal</span></pre>
<pre><span class="lineno"><a href="#line_7" id="line_7">    7.</a></span><span class="count        ">      1</span><span>// in the Software without restriction, including without limitation the rights</span></pre>
<pre><span class="lineno"><a href="#line_8" id="line_8">    8.</a></span><span class="count        ">      1</span><span>// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span></pre>
<pre><span class="lineno"><a href="#line_9" id="line_9">    9.</a></span><span class="count        ">      1</span><span>// copies of the Software, and to permit persons to whom the Software is</span></pre>
<pre><span class="lineno"><a href="#line_10" id="line_10">   10.</a></span><span class="count        ">      1</span><span>// furnished to do so, subject to the following conditions:</span></pre>
<pre><span class="lineno"><a href="#line_11" id="line_11">   11.</a></span><span class="count        ">      1</span><span>//</span></pre>
<pre><span class="lineno"><a href="#line_12" id="line_12">   12.</a></span><span class="count        ">      1</span><span>// The above copyright notice and this permission notice shall be included in</span></pre>
<pre><span class="lineno"><a href="#line_13" id="line_13">   13.</a></span><span class="count        ">      1</span><span>// all copies or substantial portions of the Software.</span></pre>
<pre><span class="lineno"><a href="#line_14" id="line_14">   14.</a></span><span class="count        ">      1</span><span>//</span></pre>
<pre><span class="lineno"><a href="#line_15" id="line_15">   15.</a></span><span class="count        ">      1</span><span>// THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></pre>
<pre><span class="lineno"><a href="#line_16" id="line_16">   16.</a></span><span class="count        ">      1</span><span>// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></pre>
<pre><span class="lineno"><a href="#line_17" id="line_17">   17.</a></span><span class="count        ">      1</span><span>// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span></pre>
<pre><span class="lineno"><a href="#line_18" id="line_18">   18.</a></span><span class="count        ">      1</span><span>// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></pre>
<pre><span class="lineno"><a href="#line_19" id="line_19">   19.</a></span><span class="count        ">      1</span><span>// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span></pre>
<pre><span class="lineno"><a href="#line_20" id="line_20">   20.</a></span><span class="count        ">      1</span><span>// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span></pre>
<pre><span class="lineno"><a href="#line_21" id="line_21">   21.</a></span><span class="count        ">      1</span><span>// SOFTWARE.</span></pre>
<pre><span class="lineno"><a href="#line_22" id="line_22">   22.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_23" id="line_23">   23.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_24" id="line_24">   24.</a></span><span class="count        ">      1</span><span>/*jslint beta, bitwise, name, node*/</span></pre>
<pre><span class="lineno"><a href="#line_25" id="line_25">   25.</a></span><span class="count        ">      1</span><span>/*global FinalizationRegistry*/</span></pre>
<pre><span class="lineno"><a href="#line_26" id="line_26">   26.</a></span><span class="count        ">      1</span><span>"use strict";</span></pre>
<pre><span class="lineno"><a href="#line_27" id="line_27">   27.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_28" id="line_28">   28.</a></span><span class="count        ">      1</span><span>const JSBATON_ARGC = 8;</span></pre>
<pre><span class="lineno"><a href="#line_29" id="line_29">   29.</a></span><span class="count        ">      1</span><span>const JSBATON_OFFSET_ALL = 256;</span></pre>
<pre><span class="lineno"><a href="#line_30" id="line_30">   30.</a></span><span class="count        ">      1</span><span>const JSBATON_OFFSET_ARGV = 128;</span></pre>
<pre><span class="lineno"><a href="#line_31" id="line_31">   31.</a></span><span class="count        ">      1</span><span>const JSBATON_OFFSET_BUFV = 192;</span></pre>
<pre><span class="lineno"><a href="#line_32" id="line_32">   32.</a></span><span class="count        ">      1</span><span>// const JSBATON_OFFSET_ERRMSG = 48;</span></pre>
<pre><span class="lineno"><a href="#line_33" id="line_33">   33.</a></span><span class="count        ">      1</span><span>const JSBATON_OFFSET_FUNCNAME = 8;</span></pre>
<pre><span class="lineno"><a href="#line_34" id="line_34">   34.</a></span><span class="count        ">      1</span><span>const JS_MAX_SAFE_INTEGER = 0x1f_ffff_ffff_ffff;</span></pre>
<pre><span class="lineno"><a href="#line_35" id="line_35">   35.</a></span><span class="count        ">      1</span><span>const JS_MIN_SAFE_INTEGER = -0x1f_ffff_ffff_ffff;</span></pre>
<pre><span class="lineno"><a href="#line_36" id="line_36">   36.</a></span><span class="count        ">      1</span><span>const SIZEOF_BLOB_MAX = 1_000_000_000;</span></pre>
<pre><span class="lineno"><a href="#line_37" id="line_37">   37.</a></span><span class="count        ">      1</span><span>// const SIZEOF_ERRMSG = 80;</span></pre>
<pre><span class="lineno"><a href="#line_38" id="line_38">   38.</a></span><span class="count        ">      1</span><span>const SIZEOF_FUNCNAME = 16;</span></pre>
<pre><span class="lineno"><a href="#line_39" id="line_39">   39.</a></span><span class="count        ">      1</span><span>const SQLITE_DATATYPE_BLOB = 0x04;</span></pre>
<pre><span class="lineno"><a href="#line_40" id="line_40">   40.</a></span><span class="count        ">      1</span><span>const SQLITE_DATATYPE_EXTERNALBUFFER = 0x71;</span></pre>
<pre><span class="lineno"><a href="#line_41" id="line_41">   41.</a></span><span class="count        ">      1</span><span>const SQLITE_DATATYPE_FLOAT = 0x02;</span></pre>
<pre><span class="lineno"><a href="#line_42" id="line_42">   42.</a></span><span class="count        ">      1</span><span>const SQLITE_DATATYPE_INTEGER = 0x01;</span></pre>
<pre><span class="lineno"><a href="#line_43" id="line_43">   43.</a></span><span class="count        ">      1</span><span>const SQLITE_DATATYPE_INTEGER_0 = 0x00;</span></pre>
<pre><span class="lineno"><a href="#line_44" id="line_44">   44.</a></span><span class="count        ">      1</span><span>const SQLITE_DATATYPE_INTEGER_1 = 0x21;</span></pre>
<pre><span class="lineno"><a href="#line_45" id="line_45">   45.</a></span><span class="count        ">      1</span><span>const SQLITE_DATATYPE_NULL = 0x05;</span></pre>
<pre><span class="lineno"><a href="#line_46" id="line_46">   46.</a></span><span class="count        ">      1</span><span>const SQLITE_DATATYPE_TEXT = 0x03;</span></pre>
<pre><span class="lineno"><a href="#line_47" id="line_47">   47.</a></span><span class="count        ">      1</span><span>const SQLITE_DATATYPE_TEXT_0 = 0x13;</span></pre>
<pre><span class="lineno"><a href="#line_48" id="line_48">   48.</a></span><span class="count        ">      1</span><span>const SQLITE_RESPONSETYPE_LASTBLOB = 1;</span></pre>
<pre><span class="lineno"><a href="#line_49" id="line_49">   49.</a></span><span class="count        ">      1</span><span>const SQLITE_RESPONSETYPE_LASTVALUE = 2;</span></pre>
<pre><span class="lineno"><a href="#line_50" id="line_50">   50.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_51" id="line_51">   51.</a></span><span class="count        ">      1</span><span>const FILENAME_DBTMP = "/tmp/__dbtmp1"; //jslint-ignore-line</span></pre>
<pre><span class="lineno"><a href="#line_52" id="line_52">   52.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_53" id="line_53">   53.</a></span><span class="count        ">      1</span><span>const LGBM_DTYPE_FLOAT32 = 0;   /* float32 (single precision float)*/</span></pre>
<pre><span class="lineno"><a href="#line_54" id="line_54">   54.</a></span><span class="count        ">      1</span><span>const LGBM_DTYPE_FLOAT64 = 1;   /* float64 (double precision float)*/</span></pre>
<pre><span class="lineno"><a href="#line_55" id="line_55">   55.</a></span><span class="count        ">      1</span><span>const LGBM_DTYPE_INT32 = 2;     /* int32*/</span></pre>
<pre><span class="lineno"><a href="#line_56" id="line_56">   56.</a></span><span class="count        ">      1</span><span>const LGBM_DTYPE_INT64 = 3;     /* int64*/</span></pre>
<pre><span class="lineno"><a href="#line_57" id="line_57">   57.</a></span><span class="count        ">      1</span><span>const LGBM_FEATURE_IMPORTANCE_GAIN = 1; /* Gain type of feature importance*/</span></pre>
<pre><span class="lineno"><a href="#line_58" id="line_58">   58.</a></span><span class="count        ">      1</span><span>const LGBM_FEATURE_IMPORTANCE_SPLIT = 0;/* Split type of feature importance*/</span></pre>
<pre><span class="lineno"><a href="#line_59" id="line_59">   59.</a></span><span class="count        ">      1</span><span>const LGBM_MATRIX_TYPE_CSC = 1; /* CSC sparse matrix type*/</span></pre>
<pre><span class="lineno"><a href="#line_60" id="line_60">   60.</a></span><span class="count        ">      1</span><span>const LGBM_MATRIX_TYPE_CSR = 0; /* CSR sparse matrix type*/</span></pre>
<pre><span class="lineno"><a href="#line_61" id="line_61">   61.</a></span><span class="count        ">      1</span><span>const LGBM_PREDICT_CONTRIB = 3; /* Predict feature contributions (SHAP values)*/</span></pre>
<pre><span class="lineno"><a href="#line_62" id="line_62">   62.</a></span><span class="count        ">      1</span><span>const LGBM_PREDICT_LEAF_INDEX = 2;      /* Predict leaf index*/</span></pre>
<pre><span class="lineno"><a href="#line_63" id="line_63">   63.</a></span><span class="count        ">      1</span><span>const LGBM_PREDICT_NORMAL = 0;  /* Normal prediction w/ transform (if needed)*/</span></pre>
<pre><span class="lineno"><a href="#line_64" id="line_64">   64.</a></span><span class="count        ">      1</span><span>const LGBM_PREDICT_RAW_SCORE = 1;       /* Predict raw score*/</span></pre>
<pre><span class="lineno"><a href="#line_65" id="line_65">   65.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_AUTOPROXY = 0x00000020;       /* VFS only */</span></pre>
<pre><span class="lineno"><a href="#line_66" id="line_66">   66.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_CREATE = 0x00000004;          /* Ok for sqlite3_open_v2() */</span></pre>
<pre><span class="lineno"><a href="#line_67" id="line_67">   67.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_DELETEONCLOSE = 0x00000008;   /* VFS only */</span></pre>
<pre><span class="lineno"><a href="#line_68" id="line_68">   68.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_EXCLUSIVE = 0x00000010;       /* VFS only */</span></pre>
<pre><span class="lineno"><a href="#line_69" id="line_69">   69.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_FULLMUTEX = 0x00010000;       /* Ok for sqlite3_open_v2() */</span></pre>
<pre><span class="lineno"><a href="#line_70" id="line_70">   70.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_MAIN_DB = 0x00000100;         /* VFS only */</span></pre>
<pre><span class="lineno"><a href="#line_71" id="line_71">   71.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_MAIN_JOURNAL = 0x00000800;    /* VFS only */</span></pre>
<pre><span class="lineno"><a href="#line_72" id="line_72">   72.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_MEMORY = 0x00000080;          /* Ok for sqlite3_open_v2() */</span></pre>
<pre><span class="lineno"><a href="#line_73" id="line_73">   73.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_NOFOLLOW = 0x01000000;        /* Ok for sqlite3_open_v2() */</span></pre>
<pre><span class="lineno"><a href="#line_74" id="line_74">   74.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_NOMUTEX = 0x00008000;         /* Ok for sqlite3_open_v2() */</span></pre>
<pre><span class="lineno"><a href="#line_75" id="line_75">   75.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_PRIVATECACHE = 0x00040000;    /* Ok for sqlite3_open_v2() */</span></pre>
<pre><span class="lineno"><a href="#line_76" id="line_76">   76.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_READONLY = 0x00000001;        /* Ok for sqlite3_open_v2() */</span></pre>
<pre><span class="lineno"><a href="#line_77" id="line_77">   77.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_READWRITE = 0x00000002;       /* Ok for sqlite3_open_v2() */</span></pre>
<pre><span class="lineno"><a href="#line_78" id="line_78">   78.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_SHAREDCACHE = 0x00020000;     /* Ok for sqlite3_open_v2() */</span></pre>
<pre><span class="lineno"><a href="#line_79" id="line_79">   79.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_SUBJOURNAL = 0x00002000;      /* VFS only */</span></pre>
<pre><span class="lineno"><a href="#line_80" id="line_80">   80.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_SUPER_JOURNAL = 0x00004000;   /* VFS only */</span></pre>
<pre><span class="lineno"><a href="#line_81" id="line_81">   81.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_TEMP_DB = 0x00000200;         /* VFS only */</span></pre>
<pre><span class="lineno"><a href="#line_82" id="line_82">   82.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_TEMP_JOURNAL = 0x00001000;    /* VFS only */</span></pre>
<pre><span class="lineno"><a href="#line_83" id="line_83">   83.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_TRANSIENT_DB = 0x00000400;    /* VFS only */</span></pre>
<pre><span class="lineno"><a href="#line_84" id="line_84">   84.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_URI = 0x00000040;             /* Ok for sqlite3_open_v2() */</span></pre>
<pre><span class="lineno"><a href="#line_85" id="line_85">   85.</a></span><span class="count        ">      1</span><span>const SQLITE_OPEN_WAL = 0x00080000;             /* VFS only */</span></pre>
<pre><span class="lineno"><a href="#line_86" id="line_86">   86.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_87" id="line_87">   87.</a></span><span class="count        ">      1</span><span>let IS_BROWSER;</span></pre>
<pre><span class="lineno"><a href="#line_88" id="line_88">   88.</a></span><span class="count        ">      1</span><span>let cModule;</span></pre>
<pre><span class="lineno"><a href="#line_89" id="line_89">   89.</a></span><span class="count        ">      1</span><span>let cModulePath;</span></pre>
<pre><span class="lineno"><a href="#line_90" id="line_90">   90.</a></span><span class="count        ">      1</span><span>let consoleError = console.error;</span></pre>
<pre><span class="lineno"><a href="#line_91" id="line_91">   91.</a></span><span class="count        ">      1</span><span>let dbFinalizationRegistry;</span></pre>
<pre><span class="lineno"><a href="#line_92" id="line_92">   92.</a></span><span class="count        ">      1</span><span>// init debugInline</span></pre>
<pre><span class="lineno"><a href="#line_93" id="line_93">   93.</a></span><span class="count        ">      1</span><span>let debugInline = (function () {</span></pre>
<pre><span class="lineno"><a href="#line_94" id="line_94">   94.</a></span><span class="count        ">      3</span><span>    let __consoleError = function () {</span></pre>
<pre><span class="lineno"><a href="#line_95" id="line_95">   95.</a></span><span class="count        ">      3</span><span>        return;</span></pre>
<pre><span class="lineno"><a href="#line_96" id="line_96">   96.</a></span><span class="count        ">      3</span><span>    };</span></pre>
<pre><span class="lineno"><a href="#line_97" id="line_97">   97.</a></span><span class="count        ">      1</span><span>    function debug(...argv) {</span></pre>
<pre><span class="lineno"><a href="#line_98" id="line_98">   98.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_99" id="line_99">   99.</a></span><span class="count        ">      1</span><span>// This function will print &lt;argv&gt; to stderr and then return &lt;argv&gt;[0].</span></pre>
<pre><span class="lineno"><a href="#line_100" id="line_100">  100.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_101" id="line_101">  101.</a></span><span class="count        ">      1</span><span>        __consoleError("\n\ndebugInline");</span></pre>
<pre><span class="lineno"><a href="#line_102" id="line_102">  102.</a></span><span class="count        ">      1</span><span>        __consoleError(...argv);</span></pre>
<pre><span class="lineno"><a href="#line_103" id="line_103">  103.</a></span><span class="count        ">      1</span><span>        __consoleError("\n");</span></pre>
<pre><span class="lineno"><a href="#line_104" id="line_104">  104.</a></span><span class="count        ">      1</span><span>        return argv[0];</span></pre>
<pre><span class="lineno"><a href="#line_105" id="line_105">  105.</a></span><span class="count        ">      1</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_106" id="line_106">  106.</a></span><span class="count        ">      1</span><span>    debug(); // Coverage-hack.</span></pre>
<pre><span class="lineno"><a href="#line_107" id="line_107">  107.</a></span><span class="count        ">      1</span><span>    __consoleError = console.error; //jslint-ignore-line</span></pre>
<pre><span class="lineno"><a href="#line_108" id="line_108">  108.</a></span><span class="count        ">      1</span><span>    return debug;</span></pre>
<pre><span class="lineno"><a href="#line_109" id="line_109">  109.</a></span><span class="count        ">      1</span><span>}());</span></pre>
<pre><span class="lineno"><a href="#line_110" id="line_110">  110.</a></span><span class="count        ">      1</span><span>let moduleChildProcess;</span></pre>
<pre><span class="lineno"><a href="#line_111" id="line_111">  111.</a></span><span class="count        ">      1</span><span>let moduleChildProcessSpawn;</span></pre>
<pre><span class="lineno"><a href="#line_112" id="line_112">  112.</a></span><span class="count        ">      1</span><span>let moduleCrypto;</span></pre>
<pre><span class="lineno"><a href="#line_113" id="line_113">  113.</a></span><span class="count        ">      1</span><span>let moduleFs;</span></pre>
<pre><span class="lineno"><a href="#line_114" id="line_114">  114.</a></span><span class="count        ">      1</span><span>let moduleFsInitResolveList;</span></pre>
<pre><span class="lineno"><a href="#line_115" id="line_115">  115.</a></span><span class="count        ">      1</span><span>let modulePath;</span></pre>
<pre><span class="lineno"><a href="#line_116" id="line_116">  116.</a></span><span class="count        ">      1</span><span>let moduleUrl;</span></pre>
<pre><span class="lineno"><a href="#line_117" id="line_117">  117.</a></span><span class="count        ">      1</span><span>let {</span></pre>
<pre><span class="lineno"><a href="#line_118" id="line_118">  118.</a></span><span class="count        ">      1</span><span>    npm_config_mode_debug,</span></pre>
<pre><span class="lineno"><a href="#line_119" id="line_119">  119.</a></span><span class="count        ">      1</span><span>    npm_config_mode_setup,</span></pre>
<pre><span class="lineno"><a href="#line_120" id="line_120">  120.</a></span><span class="count        ">      1</span><span>    npm_config_mode_test</span></pre>
<pre><span class="lineno"><a href="#line_121" id="line_121">  121.</a></span><span class="count        ">      1</span><span>} = typeof process === "object" &amp;&amp; process?.env;</span></pre>
<pre><span class="lineno"><a href="#line_122" id="line_122">  122.</a></span><span class="count        ">      1</span><span>let sqlMessageDict = {}; // dict of web-worker-callbacks</span></pre>
<pre><span class="lineno"><a href="#line_123" id="line_123">  123.</a></span><span class="count        ">      1</span><span>let sqlMessageId = 0;</span></pre>
<pre><span class="lineno"><a href="#line_124" id="line_124">  124.</a></span><span class="count        ">      1</span><span>let sqlWorker;</span></pre>
<pre><span class="lineno"><a href="#line_125" id="line_125">  125.</a></span><span class="count        ">      1</span><span>let version = "v2025.1.1-beta";</span></pre>
<pre><span class="lineno"><a href="#line_126" id="line_126">  126.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_127" id="line_127">  127.</a></span><span class="count        ">     88</span><span>async function assertErrorThrownAsync(asyncFunc, regexp) {</span></pre>
<pre><span class="lineno"><a href="#line_128" id="line_128">  128.</a></span><span class="count        ">     88</span><span></span></pre>
<pre><span class="lineno"><a href="#line_129" id="line_129">  129.</a></span><span class="count        ">     88</span><span>// This function will assert calling &lt;asyncFunc&gt; throws an error.</span></pre>
<pre><span class="lineno"><a href="#line_130" id="line_130">  130.</a></span><span class="count        ">     88</span><span></span></pre>
<pre><span class="lineno"><a href="#line_131" id="line_131">  131.</a></span><span class="count        ">     88</span><span>    let err;</span></pre>
<pre><span class="lineno"><a href="#line_132" id="line_132">  132.</a></span><span class="count        ">     88</span><span>    try {</span></pre>
<pre><span class="lineno"><a href="#line_133" id="line_133">  133.</a></span><span class="count        ">      1</span><span>        await asyncFunc();</span></pre>
<pre><span class="lineno"><a href="#line_134" id="line_134">  134.</a></span><span class="count        ">     87</span><span>    } catch (errCaught) {</span></pre>
<pre><span class="lineno"><a href="#line_135" id="line_135">  135.</a></span><span class="count        ">     87</span><span>        err = errCaught;</span></pre>
<pre><span class="lineno"><a href="#line_136" id="line_136">  136.</a></span><span class="count        ">     87</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_137" id="line_137">  137.</a></span><span class="count        ">     88</span><span>    assertOrThrow(err, "No error thrown.");</span></pre>
<pre><span class="lineno"><a href="#line_138" id="line_138">  138.</a></span><span class="count        ">     88</span><span>    assertOrThrow(</span></pre>
<pre><span class="lineno"><a href="#line_139" id="line_139">  139.</a></span><span class="count        ">     85</span><span>        !regexp || new RegExp(regexp).test(err.message),</span></pre>
<pre><span class="lineno"><a href="#line_140" id="line_140">  140.</a></span><span class="count        ">     88</span><span>        err</span></pre>
<pre><span class="lineno"><a href="#line_141" id="line_141">  141.</a></span><span class="count        ">     88</span><span>    );</span></pre>
<pre><span class="lineno"><a href="#line_142" id="line_142">  142.</a></span><span class="count        ">     88</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_143" id="line_143">  143.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_144" id="line_144">  144.</a></span><span class="count        ">  14292</span><span>function assertInt64(val) {</span></pre>
<pre><span class="lineno"><a href="#line_145" id="line_145">  145.</a></span><span class="count        ">  14292</span><span>    // This function will assert &lt;val&gt; is within range of c99-signed-long-long.</span></pre>
<pre><span class="lineno"><a href="#line_146" id="line_146">  146.</a></span><span class="count        ">  14292</span><span>    val = BigInt(val);</span></pre>
<pre><span class="lineno"><a href="#line_147" id="line_147">  147.</a></span><span class="count        ">  14292</span><span>    if (!(</span></pre>
<pre><span class="lineno"><a href="#line_148" id="line_148">  148.</a></span><span class="count        ">  14285</span><span>        -9_223_372_036_854_775_808n &lt;= val &amp;&amp; val &lt;= 9_223_372_036_854_775_807n</span></pre>
<pre><span class="lineno"><a href="#line_149" id="line_149">  149.</a></span><span class="count        ">     14</span><span>    )) {</span></pre>
<pre><span class="lineno"><a href="#line_150" id="line_150">  150.</a></span><span class="count        ">     14</span><span>        throw new Error(</span></pre>
<pre><span class="lineno"><a href="#line_151" id="line_151">  151.</a></span><span class="count        ">     14</span><span>            `integer ${val} outside signed-64-bit inclusive-range`</span></pre>
<pre><span class="lineno"><a href="#line_152" id="line_152">  152.</a></span><span class="count        ">     14</span><span>            + " -9,223,372,036,854,775,808 to 9,223,372,036,854,775,807"</span></pre>
<pre><span class="lineno"><a href="#line_153" id="line_153">  153.</a></span><span class="count        ">     14</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_154" id="line_154">  154.</a></span><span class="count        ">     14</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_155" id="line_155">  155.</a></span><span class="count        ">  14292</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_156" id="line_156">  156.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_157" id="line_157">  157.</a></span><span class="count        ">   4929</span><span>function assertJsonEqual(aa, bb, message) {</span></pre>
<pre><span class="lineno"><a href="#line_158" id="line_158">  158.</a></span><span class="count        ">   4929</span><span></span></pre>
<pre><span class="lineno"><a href="#line_159" id="line_159">  159.</a></span><span class="count        ">   4929</span><span>// This function will assert JSON.stringify(&lt;aa&gt;) === JSON.stringify(&lt;bb&gt;).</span></pre>
<pre><span class="lineno"><a href="#line_160" id="line_160">  160.</a></span><span class="count        ">   4929</span><span></span></pre>
<pre><span class="lineno"><a href="#line_161" id="line_161">  161.</a></span><span class="count        ">   4929</span><span>    aa = JSON.stringify(objectDeepCopyWithKeysSorted(aa), undefined, 1);</span></pre>
<pre><span class="lineno"><a href="#line_162" id="line_162">  162.</a></span><span class="count        ">   4929</span><span>    bb = JSON.stringify(objectDeepCopyWithKeysSorted(bb), undefined, 1);</span></pre>
<pre><span class="lineno"><a href="#line_163" id="line_163">  163.</a></span><span class="count        ">      3</span><span>    if (aa !== bb) {</span></pre>
<pre><span class="lineno"><a href="#line_164" id="line_164">  164.</a></span><span class="count        ">      3</span><span>        throw new Error(</span></pre>
<pre><span class="lineno"><a href="#line_165" id="line_165">  165.</a></span><span class="count        ">      3</span><span>            "\n" + aa + "\n!==\n" + bb</span></pre>
<pre><span class="lineno"><a href="#line_166" id="line_166">  166.</a></span><span class="count        ">      3</span><span>            + (</span></pre>
<pre><span class="lineno"><a href="#line_167" id="line_167">  167.</a></span><span class="count        ">      3</span><span>                typeof message === "string"</span></pre>
<pre><span class="lineno"><a href="#line_168" id="line_168">  168.</a></span><span class="count        ">      3</span><span>                ? " - " + message</span></pre>
<pre><span class="lineno"><a href="#line_169" id="line_169">  169.</a></span><span class="count        ">      3</span><span>                : message</span></pre>
<pre><span class="lineno"><a href="#line_170" id="line_170">  170.</a></span><span class="count        ">      3</span><span>                ? " - " + JSON.stringify(message)</span></pre>
<pre><span class="lineno"><a href="#line_171" id="line_171">  171.</a></span><span class="count        ">      3</span><span>                : ""</span></pre>
<pre><span class="lineno"><a href="#line_172" id="line_172">  172.</a></span><span class="count        ">      3</span><span>            )</span></pre>
<pre><span class="lineno"><a href="#line_173" id="line_173">  173.</a></span><span class="count        ">      3</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_174" id="line_174">  174.</a></span><span class="count        ">      3</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_175" id="line_175">  175.</a></span><span class="count        ">   4929</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_176" id="line_176">  176.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_177" id="line_177">  177.</a></span><span class="count        ">      4</span><span>function assertNumericalEqual(aa, bb, message) {</span></pre>
<pre><span class="lineno"><a href="#line_178" id="line_178">  178.</a></span><span class="count        ">      4</span><span></span></pre>
<pre><span class="lineno"><a href="#line_179" id="line_179">  179.</a></span><span class="count        ">      4</span><span>// This function will assert aa - bb &lt;= Number.EPSILON.</span></pre>
<pre><span class="lineno"><a href="#line_180" id="line_180">  180.</a></span><span class="count        ">      4</span><span></span></pre>
<pre><span class="lineno"><a href="#line_181" id="line_181">  181.</a></span><span class="count        ">      4</span><span>    assertOrThrow(aa, "value cannot be 0 or falsy");</span></pre>
<pre><span class="lineno"><a href="#line_182" id="line_182">  182.</a></span><span class="count        ">      2</span><span>    if (!(Math.abs((aa - bb) / Math.max(aa, bb)) &lt;= 256 * Number.EPSILON)) {</span></pre>
<pre><span class="lineno"><a href="#line_183" id="line_183">  183.</a></span><span class="count        ">      2</span><span>        throw new Error(</span></pre>
<pre><span class="lineno"><a href="#line_184" id="line_184">  184.</a></span><span class="count        ">      2</span><span>            JSON.stringify(aa) + " != " + JSON.stringify(bb) + (</span></pre>
<pre><span class="lineno"><a href="#line_185" id="line_185">  185.</a></span><span class="count        ">      2</span><span>                message</span></pre>
<pre><span class="lineno"><a href="#line_186" id="line_186">  186.</a></span><span class="count        ">      2</span><span>                ? " - " + message</span></pre>
<pre><span class="lineno"><a href="#line_187" id="line_187">  187.</a></span><span class="count        ">      2</span><span>                : ""</span></pre>
<pre><span class="lineno"><a href="#line_188" id="line_188">  188.</a></span><span class="count        ">      2</span><span>            )</span></pre>
<pre><span class="lineno"><a href="#line_189" id="line_189">  189.</a></span><span class="count        ">      2</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_190" id="line_190">  190.</a></span><span class="count        ">      2</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_191" id="line_191">  191.</a></span><span class="count        ">      4</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_192" id="line_192">  192.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_193" id="line_193">  193.</a></span><span class="count        ">  48083</span><span>function assertOrThrow(condition, message) {</span></pre>
<pre><span class="lineno"><a href="#line_194" id="line_194">  194.</a></span><span class="count        ">  48083</span><span></span></pre>
<pre><span class="lineno"><a href="#line_195" id="line_195">  195.</a></span><span class="count        ">  48083</span><span>// This function will throw &lt;message&gt; if &lt;condition&gt; is falsy.</span></pre>
<pre><span class="lineno"><a href="#line_196" id="line_196">  196.</a></span><span class="count        ">  48083</span><span></span></pre>
<pre><span class="lineno"><a href="#line_197" id="line_197">  197.</a></span><span class="count        ">     72</span><span>    if (!condition) {</span></pre>
<pre><span class="lineno"><a href="#line_198" id="line_198">  198.</a></span><span class="count        ">     72</span><span>        throw (</span></pre>
<pre><span class="lineno"><a href="#line_199" id="line_199">  199.</a></span><span class="count        ">     72</span><span>            (!message || typeof message === "string")</span></pre>
<pre><span class="lineno"><a href="#line_200" id="line_200">  200.</a></span><span class="count        ">     72</span><span>            ? new Error(String(message).slice(0, 2048))</span></pre>
<pre><span class="lineno"><a href="#line_201" id="line_201">  201.</a></span><span class="count        ">     72</span><span>            : message</span></pre>
<pre><span class="lineno"><a href="#line_202" id="line_202">  202.</a></span><span class="count        ">     72</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_203" id="line_203">  203.</a></span><span class="count        ">     72</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_204" id="line_204">  204.</a></span><span class="count        ">  48083</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_205" id="line_205">  205.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_206" id="line_206">  206.</a></span><span class="count        ">     15</span><span>async function childProcessSpawn2(command, args, option) {</span></pre>
<pre><span class="lineno"><a href="#line_207" id="line_207">  207.</a></span><span class="count        ">     15</span><span></span></pre>
<pre><span class="lineno"><a href="#line_208" id="line_208">  208.</a></span><span class="count        ">     15</span><span>// This function will run child_process.spawn as a promise.</span></pre>
<pre><span class="lineno"><a href="#line_209" id="line_209">  209.</a></span><span class="count        ">     15</span><span></span></pre>
<pre><span class="lineno"><a href="#line_210" id="line_210">  210.</a></span><span class="count        ">     15</span><span>    return await new Promise(function (resolve, reject) {</span></pre>
<pre><span class="lineno"><a href="#line_211" id="line_211">  211.</a></span><span class="count        ">     15</span><span>        let bufList = [[], [], []];</span></pre>
<pre><span class="lineno"><a href="#line_212" id="line_212">  212.</a></span><span class="count        ">     15</span><span>        let child;</span></pre>
<pre><span class="lineno"><a href="#line_213" id="line_213">  213.</a></span><span class="count        ">     15</span><span>        let {</span></pre>
<pre><span class="lineno"><a href="#line_214" id="line_214">  214.</a></span><span class="count        ">     15</span><span>            modeCapture,</span></pre>
<pre><span class="lineno"><a href="#line_215" id="line_215">  215.</a></span><span class="count        ">     15</span><span>            modeDebug,</span></pre>
<pre><span class="lineno"><a href="#line_216" id="line_216">  216.</a></span><span class="count        ">     15</span><span>            stdio</span></pre>
<pre><span class="lineno"><a href="#line_217" id="line_217">  217.</a></span><span class="count        ">     15</span><span>        } = option;</span></pre>
<pre><span class="lineno"><a href="#line_218" id="line_218">  218.</a></span><span class="count        ">      1</span><span>        if (modeDebug) {</span></pre>
<pre><span class="lineno"><a href="#line_219" id="line_219">  219.</a></span><span class="count        ">      1</span><span>            consoleError(</span></pre>
<pre><span class="lineno"><a href="#line_220" id="line_220">  220.</a></span><span class="count        ">      1</span><span>                `childProcessSpawn2 - ${command} ${JSON.stringify(args)}`</span></pre>
<pre><span class="lineno"><a href="#line_221" id="line_221">  221.</a></span><span class="count        ">      1</span><span>            );</span></pre>
<pre><span class="lineno"><a href="#line_222" id="line_222">  222.</a></span><span class="count        ">      1</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_223" id="line_223">  223.</a></span><span class="count        ">     15</span><span>        child = moduleChildProcessSpawn(</span></pre>
<pre><span class="lineno"><a href="#line_224" id="line_224">  224.</a></span><span class="count        ">     15</span><span>            command,</span></pre>
<pre><span class="lineno"><a href="#line_225" id="line_225">  225.</a></span><span class="count        ">     15</span><span>            args,</span></pre>
<pre><span class="lineno"><a href="#line_226" id="line_226">  226.</a></span><span class="count        ">     15</span><span>            Object.assign({}, option, {</span></pre>
<pre><span class="lineno"><a href="#line_227" id="line_227">  227.</a></span><span class="count        ">     15</span><span>                stdio: [</span></pre>
<pre><span class="lineno"><a href="#line_228" id="line_228">  228.</a></span><span class="count        ">     15</span><span>                    "ignore",</span></pre>
<pre><span class="lineno"><a href="#line_229" id="line_229">  229.</a></span><span class="count        ">     15</span><span>                    (</span></pre>
<pre><span class="lineno"><a href="#line_230" id="line_230">  230.</a></span><span class="count        ">     15</span><span>                        modeCapture</span></pre>
<pre><span class="lineno"><a href="#line_231" id="line_231">  231.</a></span><span class="count        ">      1</span><span>                        ? "pipe"</span></pre>
<pre><span class="lineno"><a href="#line_232" id="line_232">  232.</a></span><span class="count        ">     14</span><span>                        : stdio[1]</span></pre>
<pre><span class="lineno"><a href="#line_233" id="line_233">  233.</a></span><span class="count        ">     15</span><span>                    ),</span></pre>
<pre><span class="lineno"><a href="#line_234" id="line_234">  234.</a></span><span class="count        ">     15</span><span>                    (</span></pre>
<pre><span class="lineno"><a href="#line_235" id="line_235">  235.</a></span><span class="count        ">     15</span><span>                        modeCapture</span></pre>
<pre><span class="lineno"><a href="#line_236" id="line_236">  236.</a></span><span class="count        ">      1</span><span>                        ? "pipe"</span></pre>
<pre><span class="lineno"><a href="#line_237" id="line_237">  237.</a></span><span class="count        ">     14</span><span>                        : stdio[2]</span></pre>
<pre><span class="lineno"><a href="#line_238" id="line_238">  238.</a></span><span class="count        ">     15</span><span>                    )</span></pre>
<pre><span class="lineno"><a href="#line_239" id="line_239">  239.</a></span><span class="count        ">     15</span><span>                ]</span></pre>
<pre><span class="lineno"><a href="#line_240" id="line_240">  240.</a></span><span class="count        ">     15</span><span>            })</span></pre>
<pre><span class="lineno"><a href="#line_241" id="line_241">  241.</a></span><span class="count        ">     15</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_242" id="line_242">  242.</a></span><span class="count        ">      1</span><span>        if (modeCapture) {</span></pre>
<pre><span class="lineno"><a href="#line_243" id="line_243">  243.</a></span><span class="count        ">      1</span><span>            [</span></pre>
<pre><span class="lineno"><a href="#line_244" id="line_244">  244.</a></span><span class="count        ">      1</span><span>                child.stdin, child.stdout, child.stderr</span></pre>
<pre><span class="lineno"><a href="#line_245" id="line_245">  245.</a></span><span class="count        ">      3</span><span>            ].forEach(function (pipe, ii) {</span></pre>
<pre><span class="lineno"><a href="#line_246" id="line_246">  246.</a></span><span class="count        ">      1</span><span>                if (ii === 0) {</span></pre>
<pre><span class="lineno"><a href="#line_247" id="line_247">  247.</a></span><span class="count        ">      1</span><span>                    return;</span></pre>
<pre><span class="lineno"><a href="#line_248" id="line_248">  248.</a></span><span class="count        ">      2</span><span>                }</span></pre>
<pre><span class="lineno"><a href="#line_249" id="line_249">  249.</a></span><span class="count        ">      2</span><span>                pipe.on("data", function (chunk) {</span></pre>
<pre><span class="lineno"><a href="#line_250" id="line_250">  250.</a></span><span class="count        ">      2</span><span>                    bufList[ii].push(chunk);</span></pre>
<pre><span class="lineno"><a href="#line_251" id="line_251">  251.</a></span><span class="count        ">      2</span><span>                    if (stdio[ii] !== "ignore") {</span></pre>
<pre><span class="lineno"><a href="#line_252" id="line_252">  252.</a></span><span class="count        ">      2</span><span>                        switch (ii) {</span></pre>
<pre><span class="lineno"><a href="#line_253" id="line_253">  253.</a></span><span class="count        ">      2</span><span>                        case 1:</span></pre>
<pre><span class="lineno"><a href="#line_254" id="line_254">  254.</a></span><span class="count        ">      2</span><span>                            process.stdout.write(chunk);</span></pre>
<pre><span class="lineno"><a href="#line_255" id="line_255">  255.</a></span><span class="count        ">      2</span><span>                            break;</span></pre>
<pre><span class="lineno"><a href="#line_256" id="line_256">  256.</a></span><span class="count        ">      2</span><span>                        case 2:</span></pre>
<pre><span class="lineno"><a href="#line_257" id="line_257">  257.</a></span><span class="count        ">      2</span><span>                            process.stderr.write(chunk);</span></pre>
<pre><span class="lineno"><a href="#line_258" id="line_258">  258.</a></span><span class="count        ">      2</span><span>                            break;</span></pre>
<pre><span class="lineno"><a href="#line_259" id="line_259">  259.</a></span><span class="count        ">      2</span><span>                        }</span></pre>
<pre><span class="lineno"><a href="#line_260" id="line_260">  260.</a></span><span class="count        ">      2</span><span>                    }</span></pre>
<pre><span class="lineno"><a href="#line_261" id="line_261">  261.</a></span><span class="count        ">      2</span><span>                });</span></pre>
<pre><span class="lineno"><a href="#line_262" id="line_262">  262.</a></span><span class="count        ">      2</span><span>            });</span></pre>
<pre><span class="lineno"><a href="#line_263" id="line_263">  263.</a></span><span class="count        ">      1</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_264" id="line_264">  264.</a></span><span class="count        ">     15</span><span>        child.on("exit", function (exitCode) {</span></pre>
<pre><span class="lineno"><a href="#line_265" id="line_265">  265.</a></span><span class="count        ">     15</span><span>            let resolve0 = resolve;</span></pre>
<pre><span class="lineno"><a href="#line_266" id="line_266">  266.</a></span><span class="count        ">     15</span><span>            let stderr;</span></pre>
<pre><span class="lineno"><a href="#line_267" id="line_267">  267.</a></span><span class="count        ">     15</span><span>            let stdout;</span></pre>
<pre><span class="lineno"><a href="#line_268" id="line_268">  268.</a></span><span class="count        ">     15</span><span>            // coverage-hack</span></pre>
<pre><span class="lineno"><a href="#line_269" id="line_269">  269.</a></span><span class="count        ">     15</span><span>            if (exitCode || npm_config_mode_test) {</span></pre>
<pre><span class="lineno"><a href="#line_270" id="line_270">  270.</a></span><span class="count        ">     15</span><span>                resolve = reject;</span></pre>
<pre><span class="lineno"><a href="#line_271" id="line_271">  271.</a></span><span class="count        ">     15</span><span>            }</span></pre>
<pre><span class="lineno"><a href="#line_272" id="line_272">  272.</a></span><span class="count        ">     15</span><span>            // coverage-hack</span></pre>
<pre><span class="lineno"><a href="#line_273" id="line_273">  273.</a></span><span class="count        ">     15</span><span>            if (npm_config_mode_test) {</span></pre>
<pre><span class="lineno"><a href="#line_274" id="line_274">  274.</a></span><span class="count        ">     15</span><span>                resolve = resolve0;</span></pre>
<pre><span class="lineno"><a href="#line_275" id="line_275">  275.</a></span><span class="count        ">     15</span><span>            }</span></pre>
<pre><span class="lineno"><a href="#line_276" id="line_276">  276.</a></span><span class="count        ">     30</span><span>            [stdout, stderr] = bufList.slice(1).map(function (buf) {</span></pre>
<pre><span class="lineno"><a href="#line_277" id="line_277">  277.</a></span><span class="count        ">     30</span><span>                return (</span></pre>
<pre><span class="lineno"><a href="#line_278" id="line_278">  278.</a></span><span class="count        ">     30</span><span>                    typeof modeCapture === "string"</span></pre>
<pre><span class="lineno"><a href="#line_279" id="line_279">  279.</a></span><span class="count        ">      2</span><span>                    ? Buffer.concat(buf).toString(modeCapture)</span></pre>
<pre><span class="lineno"><a href="#line_280" id="line_280">  280.</a></span><span class="count        ">     28</span><span>                    : Buffer.concat(buf)</span></pre>
<pre><span class="lineno"><a href="#line_281" id="line_281">  281.</a></span><span class="count        ">     30</span><span>                );</span></pre>
<pre><span class="lineno"><a href="#line_282" id="line_282">  282.</a></span><span class="count        ">     30</span><span>            });</span></pre>
<pre><span class="lineno"><a href="#line_283" id="line_283">  283.</a></span><span class="count        ">     15</span><span>            resolve({exitCode, stderr, stdout});</span></pre>
<pre><span class="lineno"><a href="#line_284" id="line_284">  284.</a></span><span class="count        ">     15</span><span>        });</span></pre>
<pre><span class="lineno"><a href="#line_285" id="line_285">  285.</a></span><span class="count        ">     15</span><span>    });</span></pre>
<pre><span class="lineno"><a href="#line_286" id="line_286">  286.</a></span><span class="count        ">     15</span><span></span></pre>
<pre><span class="lineno"><a href="#line_287" id="line_287">  287.</a></span><span class="count        ">     15</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_288" id="line_288">  288.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_289" id="line_289">  289.</a></span><span class="count        ">      7</span><span>async function ciBuildExt({</span></pre>
<pre><span class="lineno"><a href="#line_290" id="line_290">  290.</a></span><span class="count        ">      7</span><span>    modeSkip,</span></pre>
<pre><span class="lineno"><a href="#line_291" id="line_291">  291.</a></span><span class="count        ">      7</span><span>    process</span></pre>
<pre><span class="lineno"><a href="#line_292" id="line_292">  292.</a></span><span class="count        ">      7</span><span>}) {</span></pre>
<pre><span class="lineno"><a href="#line_293" id="line_293">  293.</a></span><span class="count        ">      7</span><span></span></pre>
<pre><span class="lineno"><a href="#line_294" id="line_294">  294.</a></span><span class="count        ">      7</span><span>// This function will build sqlmath from c.</span></pre>
<pre><span class="lineno"><a href="#line_295" id="line_295">  295.</a></span><span class="count        ">      7</span><span></span></pre>
<pre><span class="lineno"><a href="#line_296" id="line_296">  296.</a></span><span class="count        ">      7</span><span>    let option;</span></pre>
<pre><span class="lineno"><a href="#line_297" id="line_297">  297.</a></span><span class="count        ">      7</span><span>    option = {</span></pre>
<pre><span class="lineno"><a href="#line_298" id="line_298">  298.</a></span><span class="count        ">      7</span><span>        binNodegyp: modulePath.resolve(</span></pre>
<pre><span class="lineno"><a href="#line_299" id="line_299">  299.</a></span><span class="count        ">      7</span><span>            modulePath.dirname(process.execPath || ""),</span></pre>
<pre><span class="lineno"><a href="#line_300" id="line_300">  300.</a></span><span class="count        ">      7</span><span>            "node_modules/npm/node_modules/node-gyp/bin/node-gyp.js"</span></pre>
<pre><span class="lineno"><a href="#line_301" id="line_301">  301.</a></span><span class="count        ">      7</span><span>        ).replace("/bin/node_modules/", "/lib/node_modules/"),</span></pre>
<pre><span class="lineno"><a href="#line_302" id="line_302">  302.</a></span><span class="count        ">      7</span><span>        isWin32: process.platform === "win32",</span></pre>
<pre><span class="lineno"><a href="#line_303" id="line_303">  303.</a></span><span class="count        ">      7</span><span>        modeDebug: npm_config_mode_debug,</span></pre>
<pre><span class="lineno"><a href="#line_304" id="line_304">  304.</a></span><span class="count        ">      7</span><span>        modeSkip,</span></pre>
<pre><span class="lineno"><a href="#line_305" id="line_305">  305.</a></span><span class="count        ">      7</span><span>        process</span></pre>
<pre><span class="lineno"><a href="#line_306" id="line_306">  306.</a></span><span class="count        ">      7</span><span>    };</span></pre>
<pre><span class="lineno"><a href="#line_307" id="line_307">  307.</a></span><span class="count        ">      7</span><span>    await ciBuildExt2NodejsBuild(option);</span></pre>
<pre><span class="lineno"><a href="#line_308" id="line_308">  308.</a></span><span class="count        ">      7</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_309" id="line_309">  309.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_310" id="line_310">  310.</a></span><span class="count        ">      7</span><span>async function ciBuildExt1NodejsConfigure({</span></pre>
<pre><span class="lineno"><a href="#line_311" id="line_311">  311.</a></span><span class="count        ">      7</span><span>    binNodegyp,</span></pre>
<pre><span class="lineno"><a href="#line_312" id="line_312">  312.</a></span><span class="count        ">      7</span><span>    modeDebug</span></pre>
<pre><span class="lineno"><a href="#line_313" id="line_313">  313.</a></span><span class="count        ">      7</span><span>}) {</span></pre>
<pre><span class="lineno"><a href="#line_314" id="line_314">  314.</a></span><span class="count        ">      7</span><span></span></pre>
<pre><span class="lineno"><a href="#line_315" id="line_315">  315.</a></span><span class="count        ">      7</span><span>// This function will setup posix/win32 env for building c-extension.</span></pre>
<pre><span class="lineno"><a href="#line_316" id="line_316">  316.</a></span><span class="count        ">      7</span><span></span></pre>
<pre><span class="lineno"><a href="#line_317" id="line_317">  317.</a></span><span class="count        ">      7</span><span>    let cflagsNowarning = [</span></pre>
<pre><span class="lineno"><a href="#line_318" id="line_318">  318.</a></span><span class="count        ">      7</span><span>        "-Wno-all",</span></pre>
<pre><span class="lineno"><a href="#line_319" id="line_319">  319.</a></span><span class="count        ">      7</span><span>        "-Wno-extra",</span></pre>
<pre><span class="lineno"><a href="#line_320" id="line_320">  320.</a></span><span class="count        ">      7</span><span>        "-Wno-implicit-fallthrough",</span></pre>
<pre><span class="lineno"><a href="#line_321" id="line_321">  321.</a></span><span class="count        ">      7</span><span>        "-Wno-incompatible-pointer-types",</span></pre>
<pre><span class="lineno"><a href="#line_322" id="line_322">  322.</a></span><span class="count        ">      7</span><span>        "-Wno-int-conversion",</span></pre>
<pre><span class="lineno"><a href="#line_323" id="line_323">  323.</a></span><span class="count        ">      7</span><span>        "-Wno-unreachable-code",</span></pre>
<pre><span class="lineno"><a href="#line_324" id="line_324">  324.</a></span><span class="count        ">      7</span><span>        "-Wno-unused-function",</span></pre>
<pre><span class="lineno"><a href="#line_325" id="line_325">  325.</a></span><span class="count        ">      7</span><span>        "-Wno-unused-parameter"</span></pre>
<pre><span class="lineno"><a href="#line_326" id="line_326">  326.</a></span><span class="count        ">      7</span><span>    ];</span></pre>
<pre><span class="lineno"><a href="#line_327" id="line_327">  327.</a></span><span class="count        ">      7</span><span>    consoleError(`ciBuildExt1Nodejs - configure binding.gyp`);</span></pre>
<pre><span class="lineno"><a href="#line_328" id="line_328">  328.</a></span><span class="count        ">      7</span><span>    await fsWriteFileUnlessTest("binding.gyp", JSON.stringify({</span></pre>
<pre><span class="lineno"><a href="#line_329" id="line_329">  329.</a></span><span class="count        ">      7</span><span>        "target_defaults": {</span></pre>
<pre><span class="lineno"><a href="#line_330" id="line_330">  330.</a></span><span class="count        ">      7</span><span>            "cflags": [</span></pre>
<pre><span class="lineno"><a href="#line_331" id="line_331">  331.</a></span><span class="count        ">      7</span><span>                "-Wextra",</span></pre>
<pre><span class="lineno"><a href="#line_332" id="line_332">  332.</a></span><span class="count        ">      7</span><span>                "-std=c11"</span></pre>
<pre><span class="lineno"><a href="#line_333" id="line_333">  333.</a></span><span class="count        ">      7</span><span>            ],</span></pre>
<pre><span class="lineno"><a href="#line_334" id="line_334">  334.</a></span><span class="count        ">      7</span><span>// https://github.com/nodejs/node-gyp/blob/v9.3.1/gyp/pylib/gyp/MSVSSettings.py</span></pre>
<pre><span class="lineno"><a href="#line_335" id="line_335">  335.</a></span><span class="count        ">      7</span><span>            "msvs_settings": {</span></pre>
<pre><span class="lineno"><a href="#line_336" id="line_336">  336.</a></span><span class="count        ">      7</span><span>                "VCCLCompilerTool": {</span></pre>
<pre><span class="lineno"><a href="#line_337" id="line_337">  337.</a></span><span class="count        ">      7</span><span>                    "WarningLevel": 3</span></pre>
<pre><span class="lineno"><a href="#line_338" id="line_338">  338.</a></span><span class="count        ">      7</span><span>                }</span></pre>
<pre><span class="lineno"><a href="#line_339" id="line_339">  339.</a></span><span class="count        ">      7</span><span>            },</span></pre>
<pre><span class="lineno"><a href="#line_340" id="line_340">  340.</a></span><span class="count        ">      7</span><span>            "xcode_settings": {</span></pre>
<pre><span class="lineno"><a href="#line_341" id="line_341">  341.</a></span><span class="count        ">      7</span><span>                "OTHER_CFLAGS": [</span></pre>
<pre><span class="lineno"><a href="#line_342" id="line_342">  342.</a></span><span class="count        ">      7</span><span>                    "-Wextra",</span></pre>
<pre><span class="lineno"><a href="#line_343" id="line_343">  343.</a></span><span class="count        ">      7</span><span>                    "-std=c11"</span></pre>
<pre><span class="lineno"><a href="#line_344" id="line_344">  344.</a></span><span class="count        ">      7</span><span>                ]</span></pre>
<pre><span class="lineno"><a href="#line_345" id="line_345">  345.</a></span><span class="count        ">      7</span><span>            }</span></pre>
<pre><span class="lineno"><a href="#line_346" id="line_346">  346.</a></span><span class="count        ">      7</span><span>        },</span></pre>
<pre><span class="lineno"><a href="#line_347" id="line_347">  347.</a></span><span class="count        ">      7</span><span>        "targets": [</span></pre>
<pre><span class="lineno"><a href="#line_348" id="line_348">  348.</a></span><span class="count        ">      7</span><span>            {</span></pre>
<pre><span class="lineno"><a href="#line_349" id="line_349">  349.</a></span><span class="count        ">      7</span><span>                "cflags": cflagsNowarning,</span></pre>
<pre><span class="lineno"><a href="#line_350" id="line_350">  350.</a></span><span class="count        ">      7</span><span>                "defines": [</span></pre>
<pre><span class="lineno"><a href="#line_351" id="line_351">  351.</a></span><span class="count        ">      7</span><span>                    "SRC_SQLITE_BASE_C2"</span></pre>
<pre><span class="lineno"><a href="#line_352" id="line_352">  352.</a></span><span class="count        ">      7</span><span>                ],</span></pre>
<pre><span class="lineno"><a href="#line_353" id="line_353">  353.</a></span><span class="count        ">      7</span><span>                "sources": [</span></pre>
<pre><span class="lineno"><a href="#line_354" id="line_354">  354.</a></span><span class="count        ">      7</span><span>                    "sqlmath_base.c",</span></pre>
<pre><span class="lineno"><a href="#line_355" id="line_355">  355.</a></span><span class="count        ">      7</span><span>                    "sqlmath_external_sqlite.c",</span></pre>
<pre><span class="lineno"><a href="#line_356" id="line_356">  356.</a></span><span class="count        ">      7</span><span>                    "sqlmath_external_zlib.c"</span></pre>
<pre><span class="lineno"><a href="#line_357" id="line_357">  357.</a></span><span class="count        ">      7</span><span>                ],</span></pre>
<pre><span class="lineno"><a href="#line_358" id="line_358">  358.</a></span><span class="count        ">      7</span><span>                "target_name": "SRC_SQLITE_BASE",</span></pre>
<pre><span class="lineno"><a href="#line_359" id="line_359">  359.</a></span><span class="count        ">      7</span><span>                "type": "static_library",</span></pre>
<pre><span class="lineno"><a href="#line_360" id="line_360">  360.</a></span><span class="count        ">      7</span><span>                "xcode_settings": {</span></pre>
<pre><span class="lineno"><a href="#line_361" id="line_361">  361.</a></span><span class="count        ">      7</span><span>                    "OTHER_CFLAGS": cflagsNowarning</span></pre>
<pre><span class="lineno"><a href="#line_362" id="line_362">  362.</a></span><span class="count        ">      7</span><span>                }</span></pre>
<pre><span class="lineno"><a href="#line_363" id="line_363">  363.</a></span><span class="count        ">      7</span><span>            },</span></pre>
<pre><span class="lineno"><a href="#line_364" id="line_364">  364.</a></span><span class="count        ">      7</span><span>            {</span></pre>
<pre><span class="lineno"><a href="#line_365" id="line_365">  365.</a></span><span class="count        ">      7</span><span>                "defines": [</span></pre>
<pre><span class="lineno"><a href="#line_366" id="line_366">  366.</a></span><span class="count        ">      7</span><span>                    "SQLMATH_CUSTOM"</span></pre>
<pre><span class="lineno"><a href="#line_367" id="line_367">  367.</a></span><span class="count        ">      7</span><span>                ],</span></pre>
<pre><span class="lineno"><a href="#line_368" id="line_368">  368.</a></span><span class="count        ">      7</span><span>                "sources": [</span></pre>
<pre><span class="lineno"><a href="#line_369" id="line_369">  369.</a></span><span class="count        ">      7</span><span>                    "sqlmath_custom.c"</span></pre>
<pre><span class="lineno"><a href="#line_370" id="line_370">  370.</a></span><span class="count        ">      7</span><span>                ],</span></pre>
<pre><span class="lineno"><a href="#line_371" id="line_371">  371.</a></span><span class="count        ">      7</span><span>                "target_name": "SQLMATH_CUSTOM",</span></pre>
<pre><span class="lineno"><a href="#line_372" id="line_372">  372.</a></span><span class="count        ">      7</span><span>                "type": "static_library"</span></pre>
<pre><span class="lineno"><a href="#line_373" id="line_373">  373.</a></span><span class="count        ">      7</span><span>            },</span></pre>
<pre><span class="lineno"><a href="#line_374" id="line_374">  374.</a></span><span class="count        ">      7</span><span>            {</span></pre>
<pre><span class="lineno"><a href="#line_375" id="line_375">  375.</a></span><span class="count        ">      7</span><span>                "defines": [</span></pre>
<pre><span class="lineno"><a href="#line_376" id="line_376">  376.</a></span><span class="count        ">      7</span><span>                    "SQLMATH_NODEJS_C2"</span></pre>
<pre><span class="lineno"><a href="#line_377" id="line_377">  377.</a></span><span class="count        ">      7</span><span>                ],</span></pre>
<pre><span class="lineno"><a href="#line_378" id="line_378">  378.</a></span><span class="count        ">      7</span><span>                "dependencies": [</span></pre>
<pre><span class="lineno"><a href="#line_379" id="line_379">  379.</a></span><span class="count        ">      7</span><span>                    "SQLMATH_CUSTOM",</span></pre>
<pre><span class="lineno"><a href="#line_380" id="line_380">  380.</a></span><span class="count        ">      7</span><span>                    "SRC_SQLITE_BASE"</span></pre>
<pre><span class="lineno"><a href="#line_381" id="line_381">  381.</a></span><span class="count        ">      7</span><span>                ],</span></pre>
<pre><span class="lineno"><a href="#line_382" id="line_382">  382.</a></span><span class="count        ">      7</span><span>                "sources": [</span></pre>
<pre><span class="lineno"><a href="#line_383" id="line_383">  383.</a></span><span class="count        ">      7</span><span>                    "sqlmath_base.c"</span></pre>
<pre><span class="lineno"><a href="#line_384" id="line_384">  384.</a></span><span class="count        ">      7</span><span>                ],</span></pre>
<pre><span class="lineno"><a href="#line_385" id="line_385">  385.</a></span><span class="count        ">      7</span><span>                "target_name": "binding"</span></pre>
<pre><span class="lineno"><a href="#line_386" id="line_386">  386.</a></span><span class="count        ">      7</span><span>            },</span></pre>
<pre><span class="lineno"><a href="#line_387" id="line_387">  387.</a></span><span class="count        ">      7</span><span>            {</span></pre>
<pre><span class="lineno"><a href="#line_388" id="line_388">  388.</a></span><span class="count        ">      7</span><span>                "cflags": cflagsNowarning,</span></pre>
<pre><span class="lineno"><a href="#line_389" id="line_389">  389.</a></span><span class="count        ">      7</span><span>                "defines": [</span></pre>
<pre><span class="lineno"><a href="#line_390" id="line_390">  390.</a></span><span class="count        ">      7</span><span>                    "SRC_SQLITE_SHELL_C2"</span></pre>
<pre><span class="lineno"><a href="#line_391" id="line_391">  391.</a></span><span class="count        ">      7</span><span>                ],</span></pre>
<pre><span class="lineno"><a href="#line_392" id="line_392">  392.</a></span><span class="count        ">      7</span><span>                "dependencies": [</span></pre>
<pre><span class="lineno"><a href="#line_393" id="line_393">  393.</a></span><span class="count        ">      7</span><span>                    "SQLMATH_CUSTOM",</span></pre>
<pre><span class="lineno"><a href="#line_394" id="line_394">  394.</a></span><span class="count        ">      7</span><span>                    "SRC_SQLITE_BASE"</span></pre>
<pre><span class="lineno"><a href="#line_395" id="line_395">  395.</a></span><span class="count        ">      7</span><span>                ],</span></pre>
<pre><span class="lineno"><a href="#line_396" id="line_396">  396.</a></span><span class="count        ">      7</span><span>                "sources": [</span></pre>
<pre><span class="lineno"><a href="#line_397" id="line_397">  397.</a></span><span class="count        ">      7</span><span>                    "sqlmath_external_sqlite.c"</span></pre>
<pre><span class="lineno"><a href="#line_398" id="line_398">  398.</a></span><span class="count        ">      7</span><span>                ],</span></pre>
<pre><span class="lineno"><a href="#line_399" id="line_399">  399.</a></span><span class="count        ">      7</span><span>                "target_name": "shell",</span></pre>
<pre><span class="lineno"><a href="#line_400" id="line_400">  400.</a></span><span class="count        ">      7</span><span>                "type": "executable",</span></pre>
<pre><span class="lineno"><a href="#line_401" id="line_401">  401.</a></span><span class="count        ">      7</span><span>                "xcode_settings": {</span></pre>
<pre><span class="lineno"><a href="#line_402" id="line_402">  402.</a></span><span class="count        ">      7</span><span>                    "OTHER_CFLAGS": cflagsNowarning</span></pre>
<pre><span class="lineno"><a href="#line_403" id="line_403">  403.</a></span><span class="count        ">      7</span><span>                }</span></pre>
<pre><span class="lineno"><a href="#line_404" id="line_404">  404.</a></span><span class="count        ">      7</span><span>            }</span></pre>
<pre><span class="lineno"><a href="#line_405" id="line_405">  405.</a></span><span class="count        ">      7</span><span>        ]</span></pre>
<pre><span class="lineno"><a href="#line_406" id="line_406">  406.</a></span><span class="count        ">      7</span><span>    }, undefined, 4) + "\n");</span></pre>
<pre><span class="lineno"><a href="#line_407" id="line_407">  407.</a></span><span class="count        ">      7</span><span>    await childProcessSpawn2(</span></pre>
<pre><span class="lineno"><a href="#line_408" id="line_408">  408.</a></span><span class="count        ">      7</span><span>        "sh",</span></pre>
<pre><span class="lineno"><a href="#line_409" id="line_409">  409.</a></span><span class="count        ">      7</span><span>        [</span></pre>
<pre><span class="lineno"><a href="#line_410" id="line_410">  410.</a></span><span class="count        ">      7</span><span>            "-c",</span></pre>
<pre><span class="lineno"><a href="#line_411" id="line_411">  411.</a></span><span class="count        ">      7</span><span>            (`</span></pre>
<pre><span class="lineno"><a href="#line_412" id="line_412">  412.</a></span><span class="count        ">      7</span><span>(set -e</span></pre>
<pre><span class="lineno"><a href="#line_413" id="line_413">  413.</a></span><span class="count        ">      7</span><span>    # node "${binNodegyp}" clean</span></pre>
<pre><span class="lineno"><a href="#line_414" id="line_414">  414.</a></span><span class="count        ">      7</span><span>    node "${binNodegyp}" configure</span></pre>
<pre><span class="lineno"><a href="#line_415" id="line_415">  415.</a></span><span class="count        ">      7</span><span>)</span></pre>
<pre><span class="lineno"><a href="#line_416" id="line_416">  416.</a></span><span class="count        ">      7</span><span>            `)</span></pre>
<pre><span class="lineno"><a href="#line_417" id="line_417">  417.</a></span><span class="count        ">      7</span><span>        ],</span></pre>
<pre><span class="lineno"><a href="#line_418" id="line_418">  418.</a></span><span class="count        ">      7</span><span>        {modeDebug, stdio: ["ignore", 1, 2]}</span></pre>
<pre><span class="lineno"><a href="#line_419" id="line_419">  419.</a></span><span class="count        ">      7</span><span>    );</span></pre>
<pre><span class="lineno"><a href="#line_420" id="line_420">  420.</a></span><span class="count        ">      7</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_421" id="line_421">  421.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_422" id="line_422">  422.</a></span><span class="count        ">      7</span><span>async function ciBuildExt2NodejsBuild({</span></pre>
<pre><span class="lineno"><a href="#line_423" id="line_423">  423.</a></span><span class="count        ">      7</span><span>    binNodegyp,</span></pre>
<pre><span class="lineno"><a href="#line_424" id="line_424">  424.</a></span><span class="count        ">      7</span><span>    modeDebug</span></pre>
<pre><span class="lineno"><a href="#line_425" id="line_425">  425.</a></span><span class="count        ">      7</span><span>}) {</span></pre>
<pre><span class="lineno"><a href="#line_426" id="line_426">  426.</a></span><span class="count        ">      7</span><span></span></pre>
<pre><span class="lineno"><a href="#line_427" id="line_427">  427.</a></span><span class="count        ">      7</span><span>// This function will archive &lt;fileObj&gt; into &lt;fileLib&gt;</span></pre>
<pre><span class="lineno"><a href="#line_428" id="line_428">  428.</a></span><span class="count        ">      7</span><span></span></pre>
<pre><span class="lineno"><a href="#line_429" id="line_429">  429.</a></span><span class="count        ">      7</span><span>    if (!noop(</span></pre>
<pre><span class="lineno"><a href="#line_430" id="line_430">  430.</a></span><span class="count        ">      7</span><span>        await fsExistsUnlessTest(cModulePath)</span></pre>
<pre><span class="lineno"><a href="#line_431" id="line_431">  431.</a></span><span class="count        ">      7</span><span>    )) {</span></pre>
<pre><span class="lineno"><a href="#line_432" id="line_432">  432.</a></span><span class="count        ">      7</span><span>        await ciBuildExt1NodejsConfigure({</span></pre>
<pre><span class="lineno"><a href="#line_433" id="line_433">  433.</a></span><span class="count        ">      7</span><span>            binNodegyp,</span></pre>
<pre><span class="lineno"><a href="#line_434" id="line_434">  434.</a></span><span class="count        ">      7</span><span>            modeDebug</span></pre>
<pre><span class="lineno"><a href="#line_435" id="line_435">  435.</a></span><span class="count        ">      7</span><span>        });</span></pre>
<pre><span class="lineno"><a href="#line_436" id="line_436">  436.</a></span><span class="count        ">      7</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_437" id="line_437">  437.</a></span><span class="count        ">      7</span><span>    consoleError(</span></pre>
<pre><span class="lineno"><a href="#line_438" id="line_438">  438.</a></span><span class="count        ">      7</span><span>        `ciBuildExt2Nodejs - linking lib ${modulePath.resolve(cModulePath)}`</span></pre>
<pre><span class="lineno"><a href="#line_439" id="line_439">  439.</a></span><span class="count        ">      7</span><span>    );</span></pre>
<pre><span class="lineno"><a href="#line_440" id="line_440">  440.</a></span><span class="count        ">      7</span><span>    await childProcessSpawn2(</span></pre>
<pre><span class="lineno"><a href="#line_441" id="line_441">  441.</a></span><span class="count        ">      7</span><span>        "sh",</span></pre>
<pre><span class="lineno"><a href="#line_442" id="line_442">  442.</a></span><span class="count        ">      7</span><span>        [</span></pre>
<pre><span class="lineno"><a href="#line_443" id="line_443">  443.</a></span><span class="count        ">      7</span><span>            "-c",</span></pre>
<pre><span class="lineno"><a href="#line_444" id="line_444">  444.</a></span><span class="count        ">      7</span><span>            (`</span></pre>
<pre><span class="lineno"><a href="#line_445" id="line_445">  445.</a></span><span class="count        ">      7</span><span>(set -e</span></pre>
<pre><span class="lineno"><a href="#line_446" id="line_446">  446.</a></span><span class="count        ">      7</span><span>    # rebuild binding</span></pre>
<pre><span class="lineno"><a href="#line_447" id="line_447">  447.</a></span><span class="count        ">      7</span><span>    rm -rf build/Release/obj/SQLMATH_CUSTOM/</span></pre>
<pre><span class="lineno"><a href="#line_448" id="line_448">  448.</a></span><span class="count        ">      7</span><span>    node "${binNodegyp}" build --release</span></pre>
<pre><span class="lineno"><a href="#line_449" id="line_449">  449.</a></span><span class="count        ">      7</span><span>    mv build/Release/binding.node "${cModulePath}"</span></pre>
<pre><span class="lineno"><a href="#line_450" id="line_450">  450.</a></span><span class="count        ">      7</span><span>    if [ "${process.platform}" = "win32" ]</span></pre>
<pre><span class="lineno"><a href="#line_451" id="line_451">  451.</a></span><span class="count        ">      7</span><span>    then</span></pre>
<pre><span class="lineno"><a href="#line_452" id="line_452">  452.</a></span><span class="count        ">      7</span><span>        mv build/Release/shell \</span></pre>
<pre><span class="lineno"><a href="#line_453" id="line_453">  453.</a></span><span class="count        ">      7</span><span>            "_sqlmath.shell_${process.platform}_${process.arch}.exe"</span></pre>
<pre><span class="lineno"><a href="#line_454" id="line_454">  454.</a></span><span class="count        ">      7</span><span>    else</span></pre>
<pre><span class="lineno"><a href="#line_455" id="line_455">  455.</a></span><span class="count        ">      7</span><span>        mv build/Release/shell \</span></pre>
<pre><span class="lineno"><a href="#line_456" id="line_456">  456.</a></span><span class="count        ">      7</span><span>            "_sqlmath.shell_${process.platform}_${process.arch}"</span></pre>
<pre><span class="lineno"><a href="#line_457" id="line_457">  457.</a></span><span class="count        ">      7</span><span>    fi</span></pre>
<pre><span class="lineno"><a href="#line_458" id="line_458">  458.</a></span><span class="count        ">      7</span><span>)</span></pre>
<pre><span class="lineno"><a href="#line_459" id="line_459">  459.</a></span><span class="count        ">      7</span><span>            `)</span></pre>
<pre><span class="lineno"><a href="#line_460" id="line_460">  460.</a></span><span class="count        ">      7</span><span>        ],</span></pre>
<pre><span class="lineno"><a href="#line_461" id="line_461">  461.</a></span><span class="count        ">      7</span><span>        {modeDebug, stdio: ["ignore", 1, 2]}</span></pre>
<pre><span class="lineno"><a href="#line_462" id="line_462">  462.</a></span><span class="count        ">      7</span><span>    );</span></pre>
<pre><span class="lineno"><a href="#line_463" id="line_463">  463.</a></span><span class="count        ">      7</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_464" id="line_464">  464.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_465" id="line_465">  465.</a></span><span class="count        ">   3979</span><span>async function dbCallAsync(baton, argList, mode) {</span></pre>
<pre><span class="lineno"><a href="#line_466" id="line_466">  466.</a></span><span class="count        ">   3979</span><span></span></pre>
<pre><span class="lineno"><a href="#line_467" id="line_467">  467.</a></span><span class="count        ">   3979</span><span>// This function will call c-function dbXxx() with given &lt;funcname&gt;</span></pre>
<pre><span class="lineno"><a href="#line_468" id="line_468">  468.</a></span><span class="count        ">   3979</span><span>// and return [&lt;baton&gt;, ...argList].</span></pre>
<pre><span class="lineno"><a href="#line_469" id="line_469">  469.</a></span><span class="count        ">   3979</span><span></span></pre>
<pre><span class="lineno"><a href="#line_470" id="line_470">  470.</a></span><span class="count        ">   3979</span><span>    let db;</span></pre>
<pre><span class="lineno"><a href="#line_471" id="line_471">  471.</a></span><span class="count        ">   3979</span><span>    let errStack;</span></pre>
<pre><span class="lineno"><a href="#line_472" id="line_472">  472.</a></span><span class="count        ">   3979</span><span>    let funcname;</span></pre>
<pre><span class="lineno"><a href="#line_473" id="line_473">  473.</a></span><span class="count        ">   3979</span><span>    let id;</span></pre>
<pre><span class="lineno"><a href="#line_474" id="line_474">  474.</a></span><span class="count        ">   3979</span><span>    let result;</span></pre>
<pre><span class="lineno"><a href="#line_475" id="line_475">  475.</a></span><span class="count        ">   3979</span><span>    let timeElapsed;</span></pre>
<pre><span class="lineno"><a href="#line_476" id="line_476">  476.</a></span><span class="count        ">   3979</span><span>    // If argList contains &lt;db&gt;, then mark it as busy.</span></pre>
<pre><span class="lineno"><a href="#line_477" id="line_477">  477.</a></span><span class="count        ">   1931</span><span>    if (mode === "modeDb") {</span></pre>
<pre><span class="lineno"><a href="#line_478" id="line_478">  478.</a></span><span class="count        ">   1931</span><span>        // init db</span></pre>
<pre><span class="lineno"><a href="#line_479" id="line_479">  479.</a></span><span class="count        ">   1931</span><span>        db = argList[0];</span></pre>
<pre><span class="lineno"><a href="#line_480" id="line_480">  480.</a></span><span class="count        ">   1931</span><span>        assertOrThrow(</span></pre>
<pre><span class="lineno"><a href="#line_481" id="line_481">  481.</a></span><span class="count        ">   1931</span><span>            db.busy &gt;= 0,</span></pre>
<pre><span class="lineno"><a href="#line_482" id="line_482">  482.</a></span><span class="count        ">   1931</span><span>            `dbCallAsync - invalid db.busy = ${db.busy}`</span></pre>
<pre><span class="lineno"><a href="#line_483" id="line_483">  483.</a></span><span class="count        ">   1931</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_484" id="line_484">  484.</a></span><span class="count        ">   1931</span><span>        db.ii = (db.ii + 1) % db.connPool.length;</span></pre>
<pre><span class="lineno"><a href="#line_485" id="line_485">  485.</a></span><span class="count        ">   1931</span><span>        db.ptr = db.connPool[db.ii][0];</span></pre>
<pre><span class="lineno"><a href="#line_486" id="line_486">  486.</a></span><span class="count        ">   1931</span><span>        // increment db.busy</span></pre>
<pre><span class="lineno"><a href="#line_487" id="line_487">  487.</a></span><span class="count        ">   1931</span><span>        db.busy += 1;</span></pre>
<pre><span class="lineno"><a href="#line_488" id="line_488">  488.</a></span><span class="count        ">   1931</span><span>        try {</span></pre>
<pre><span class="lineno"><a href="#line_489" id="line_489">  489.</a></span><span class="count        ">   1931</span><span>            return await dbCallAsync(baton, [db.ptr, ...argList.slice(1)]);</span></pre>
<pre><span class="lineno"><a href="#line_490" id="line_490">  490.</a></span><span class="count        ">   1931</span><span>        } finally {</span></pre>
<pre><span class="lineno"><a href="#line_491" id="line_491">  491.</a></span><span class="count        ">   1931</span><span>            // decrement db.busy</span></pre>
<pre><span class="lineno"><a href="#line_492" id="line_492">  492.</a></span><span class="count        ">   1931</span><span>            db.busy -= 1;</span></pre>
<pre><span class="lineno"><a href="#line_493" id="line_493">  493.</a></span><span class="count        ">   1931</span><span>            assertOrThrow(</span></pre>
<pre><span class="lineno"><a href="#line_494" id="line_494">  494.</a></span><span class="count        ">   1931</span><span>                db.busy &gt;= 0,</span></pre>
<pre><span class="lineno"><a href="#line_495" id="line_495">  495.</a></span><span class="count        ">   1931</span><span>                `dbCallAsync - invalid db.busy = ${db.busy}`</span></pre>
<pre><span class="lineno"><a href="#line_496" id="line_496">  496.</a></span><span class="count        ">   1931</span><span>            );</span></pre>
<pre><span class="lineno"><a href="#line_497" id="line_497">  497.</a></span><span class="count        ">   1931</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_498" id="line_498">  498.</a></span><span class="count        ">   2048</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_499" id="line_499">  499.</a></span><span class="count        ">   2048</span><span>    // copy argList to avoid side-effect</span></pre>
<pre><span class="lineno"><a href="#line_500" id="line_500">  500.</a></span><span class="count        ">   2048</span><span>    argList = [...argList];</span></pre>
<pre><span class="lineno"><a href="#line_501" id="line_501">  501.</a></span><span class="count        ">   2048</span><span>    assertOrThrow(</span></pre>
<pre><span class="lineno"><a href="#line_502" id="line_502">  502.</a></span><span class="count        ">   2048</span><span>        argList.length &lt;= JSBATON_ARGC,</span></pre>
<pre><span class="lineno"><a href="#line_503" id="line_503">  503.</a></span><span class="count        ">   2048</span><span>        `dbCallAsync - argList.length must be less than than ${JSBATON_ARGC}`</span></pre>
<pre><span class="lineno"><a href="#line_504" id="line_504">  504.</a></span><span class="count        ">   2048</span><span>    );</span></pre>
<pre><span class="lineno"><a href="#line_505" id="line_505">  505.</a></span><span class="count        ">   2048</span><span>    // pad argList to length JSBATON_ARGC</span></pre>
<pre><span class="lineno"><a href="#line_506" id="line_506">  506.</a></span><span class="count        ">   6375</span><span>    while (argList.length &lt; JSBATON_ARGC) {</span></pre>
<pre><span class="lineno"><a href="#line_507" id="line_507">  507.</a></span><span class="count        ">   6375</span><span>        argList.push(0n);</span></pre>
<pre><span class="lineno"><a href="#line_508" id="line_508">  508.</a></span><span class="count        ">   6375</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_509" id="line_509">  509.</a></span><span class="count        ">   2048</span><span>    // serialize js-value to c-value</span></pre>
<pre><span class="lineno"><a href="#line_510" id="line_510">  510.</a></span><span class="count        ">  16246</span><span>    argList = argList.map(function (val, argi) {</span></pre>
<pre><span class="lineno"><a href="#line_511" id="line_511">  511.</a></span><span class="count        ">  16245</span><span>        if (val === null || val === undefined) {</span></pre>
<pre><span class="lineno"><a href="#line_512" id="line_512">  512.</a></span><span class="count        ">   2048</span><span>            val = 0;</span></pre>
<pre><span class="lineno"><a href="#line_513" id="line_513">  513.</a></span><span class="count        ">   2048</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_514" id="line_514">  514.</a></span><span class="count        ">  16246</span><span>        switch (typeof val) {</span></pre>
<pre><span class="lineno"><a href="#line_515" id="line_515">  515.</a></span><span class="count        ">   8232</span><span>        case "bigint":</span></pre>
<pre><span class="lineno"><a href="#line_516" id="line_516">  516.</a></span><span class="count        ">  10151</span><span>        case "boolean":</span></pre>
<pre><span class="lineno"><a href="#line_517" id="line_517">  517.</a></span><span class="count        ">  14260</span><span>        case "number":</span></pre>
<pre><span class="lineno"><a href="#line_518" id="line_518">  518.</a></span><span class="count        ">  14260</span><span>            // check for min/max safe-integer</span></pre>
<pre><span class="lineno"><a href="#line_519" id="line_519">  519.</a></span><span class="count        ">  14260</span><span>            assertOrThrow(</span></pre>
<pre><span class="lineno"><a href="#line_520" id="line_520">  520.</a></span><span class="count        ">  14260</span><span>                (</span></pre>
<pre><span class="lineno"><a href="#line_521" id="line_521">  521.</a></span><span class="count        ">  14260</span><span>                    (JS_MIN_SAFE_INTEGER &lt;= val &amp;&amp; val &lt;= JS_MAX_SAFE_INTEGER)</span></pre>
<pre><span class="lineno"><a href="#line_522" id="line_522">  522.</a></span><span class="count        ">  14260</span><span>                    || typeof val === "bigint"</span></pre>
<pre><span class="lineno"><a href="#line_523" id="line_523">  523.</a></span><span class="count        ">  14260</span><span>                ),</span></pre>
<pre><span class="lineno"><a href="#line_524" id="line_524">  524.</a></span><span class="count        ">  14260</span><span>                (</span></pre>
<pre><span class="lineno"><a href="#line_525" id="line_525">  525.</a></span><span class="count        ">  14260</span><span>                    "dbCallAsync - "</span></pre>
<pre><span class="lineno"><a href="#line_526" id="line_526">  526.</a></span><span class="count        ">  14260</span><span>                    + "non-bigint-integer must be within inclusive-range"</span></pre>
<pre><span class="lineno"><a href="#line_527" id="line_527">  527.</a></span><span class="count        ">  14260</span><span>                    + ` ${JS_MIN_SAFE_INTEGER} to ${JS_MAX_SAFE_INTEGER}`</span></pre>
<pre><span class="lineno"><a href="#line_528" id="line_528">  528.</a></span><span class="count        ">  14260</span><span>                )</span></pre>
<pre><span class="lineno"><a href="#line_529" id="line_529">  529.</a></span><span class="count        ">  14260</span><span>            );</span></pre>
<pre><span class="lineno"><a href="#line_530" id="line_530">  530.</a></span><span class="count        ">  14260</span><span>            val = BigInt(val);</span></pre>
<pre><span class="lineno"><a href="#line_531" id="line_531">  531.</a></span><span class="count        ">  14260</span><span>            assertInt64(val);</span></pre>
<pre><span class="lineno"><a href="#line_532" id="line_532">  532.</a></span><span class="count        ">  14260</span><span>            baton.setBigInt64(JSBATON_OFFSET_ARGV + argi * 8, val, true);</span></pre>
<pre><span class="lineno"><a href="#line_533" id="line_533">  533.</a></span><span class="count        ">  14260</span><span>            return val;</span></pre>
<pre><span class="lineno"><a href="#line_534" id="line_534">  534.</a></span><span class="count        ">  16246</span><span>        // case "object":</span></pre>
<pre><span class="lineno"><a href="#line_535" id="line_535">  535.</a></span><span class="count        ">  16246</span><span>        //     break;</span></pre>
<pre><span class="lineno"><a href="#line_536" id="line_536">  536.</a></span><span class="count        ">   2048</span><span>        case "string":</span></pre>
<pre><span class="lineno"><a href="#line_537" id="line_537">  537.</a></span><span class="count        ">   2048</span><span>            baton = jsbatonSetValue(baton, argi, (</span></pre>
<pre><span class="lineno"><a href="#line_538" id="line_538">  538.</a></span><span class="count        ">   2048</span><span>                val.endsWith("\u0000")</span></pre>
<pre><span class="lineno"><a href="#line_539" id="line_539">  539.</a></span><span class="count        ">   2048</span><span>                ? val</span></pre>
<pre><span class="lineno"><a href="#line_540" id="line_540">  540.</a></span><span class="count        ">   2048</span><span>                // append null-terminator to string</span></pre>
<pre><span class="lineno"><a href="#line_541" id="line_541">  541.</a></span><span class="count        ">   2048</span><span>                : val + "\u0000"</span></pre>
<pre><span class="lineno"><a href="#line_542" id="line_542">  542.</a></span><span class="count        ">   2048</span><span>            ));</span></pre>
<pre><span class="lineno"><a href="#line_543" id="line_543">  543.</a></span><span class="count        ">   2048</span><span>            return;</span></pre>
<pre><span class="lineno"><a href="#line_544" id="line_544">  544.</a></span><span class="count        ">   2048</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_545" id="line_545">  545.</a></span><span class="count        ">   2048</span><span>        assertOrThrow(</span></pre>
<pre><span class="lineno"><a href="#line_546" id="line_546">  546.</a></span><span class="count        ">   2048</span><span>            !ArrayBuffer.isView(val) || val.byteOffset === 0,</span></pre>
<pre><span class="lineno"><a href="#line_547" id="line_547">  547.</a></span><span class="count        ">  16246</span><span>            (</span></pre>
<pre><span class="lineno"><a href="#line_548" id="line_548">  548.</a></span><span class="count        ">  16246</span><span>                "dbCallAsync - argList cannot contain arraybuffer-views"</span></pre>
<pre><span class="lineno"><a href="#line_549" id="line_549">  549.</a></span><span class="count        ">  16246</span><span>                + " with non-zero byteOffset"</span></pre>
<pre><span class="lineno"><a href="#line_550" id="line_550">  550.</a></span><span class="count        ">  16246</span><span>            )</span></pre>
<pre><span class="lineno"><a href="#line_551" id="line_551">  551.</a></span><span class="count        ">  16246</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_552" id="line_552">  552.</a></span><span class="count        ">   2048</span><span>        if (isExternalBuffer(val)) {</span></pre>
<pre><span class="lineno"><a href="#line_553" id="line_553">  553.</a></span><span class="count        ">   2048</span><span>            return val;</span></pre>
<pre><span class="lineno"><a href="#line_554" id="line_554">  554.</a></span><span class="count        ">   2048</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_555" id="line_555">  555.</a></span><span class="count        ">   2048</span><span>        throw new Error(`dbCallAsync - invalid arg-type "${typeof val}"`);</span></pre>
<pre><span class="lineno"><a href="#line_556" id="line_556">  556.</a></span><span class="count        ">   2048</span><span>    });</span></pre>
<pre><span class="lineno"><a href="#line_557" id="line_557">  557.</a></span><span class="count        ">   2048</span><span>    // assert byteOffset === 0</span></pre>
<pre><span class="lineno"><a href="#line_558" id="line_558">  558.</a></span><span class="count        ">  18225</span><span>    [baton, ...argList].forEach(function (arg) {</span></pre>
<pre><span class="lineno"><a href="#line_559" id="line_559">  559.</a></span><span class="count        ">   2048</span><span>        assertOrThrow(!ArrayBuffer.isView(arg) || arg.byteOffset === 0, arg);</span></pre>
<pre><span class="lineno"><a href="#line_560" id="line_560">  560.</a></span><span class="count        ">  18225</span><span>    });</span></pre>
<pre><span class="lineno"><a href="#line_561" id="line_561">  561.</a></span><span class="count        ">   2048</span><span>    // extract funcname</span></pre>
<pre><span class="lineno"><a href="#line_562" id="line_562">  562.</a></span><span class="count        ">   2048</span><span>    funcname = new TextDecoder().decode(</span></pre>
<pre><span class="lineno"><a href="#line_563" id="line_563">  563.</a></span><span class="count        ">   2048</span><span>        new DataView(baton.buffer, JSBATON_OFFSET_FUNCNAME, SIZEOF_FUNCNAME)</span></pre>
<pre><span class="lineno"><a href="#line_564" id="line_564">  564.</a></span><span class="count        ">   2048</span><span>    ).replace((/\u0000/g), "");</span></pre>
<pre><span class="lineno"><a href="#line_565" id="line_565">  565.</a></span><span class="count        ">   2048</span><span>    // preserve stack-trace</span></pre>
<pre><span class="lineno"><a href="#line_566" id="line_566">  566.</a></span><span class="count        ">   2048</span><span>    errStack = new Error().stack.replace((/.*$/m), "");</span></pre>
<pre><span class="lineno"><a href="#line_567" id="line_567">  567.</a></span><span class="count        ">   2048</span><span>    try {</span></pre>
<pre><span class="lineno"><a href="#line_568" id="line_568">  568.</a></span><span class="count        ">   2048</span><span></span></pre>
<pre><span class="lineno"><a href="#line_569" id="line_569">  569.</a></span><span class="count        ">   2048</span><span>// Dispatch to nodejs-napi.</span></pre>
<pre><span class="lineno"><a href="#line_570" id="line_570">  570.</a></span><span class="count        ">   2048</span><span></span></pre>
<pre><span class="lineno"><a href="#line_571" id="line_571">  571.</a></span><span class="count        ">   2048</span><span>        if (!IS_BROWSER) {</span></pre>
<pre><span class="lineno"><a href="#line_572" id="line_572">  572.</a></span><span class="count        ">   2023</span><span>            await cModule._jspromiseCreate(baton.buffer, argList, funcname);</span></pre>
<pre><span class="lineno"><a href="#line_573" id="line_573">  573.</a></span><span class="count        ">   2023</span><span>            // prepend baton to argList</span></pre>
<pre><span class="lineno"><a href="#line_574" id="line_574">  574.</a></span><span class="count        ">   2023</span><span>            return [baton, ...argList];</span></pre>
<pre><span class="lineno"><a href="#line_575" id="line_575">  575.</a></span><span class="count        ">   2023</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_576" id="line_576">  576.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_577" id="line_577">  577.</a></span><span class="count        ">      2</span><span>// Dispatch to web-worker.</span></pre>
<pre><span class="lineno"><a href="#line_578" id="line_578">  578.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_579" id="line_579">  579.</a></span><span class="count        ">      2</span><span>        // increment sqlMessageId</span></pre>
<pre><span class="lineno"><a href="#line_580" id="line_580">  580.</a></span><span class="count        ">      2</span><span>        sqlMessageId += 1;</span></pre>
<pre><span class="lineno"><a href="#line_581" id="line_581">  581.</a></span><span class="count        ">      2</span><span>        id = sqlMessageId;</span></pre>
<pre><span class="lineno"><a href="#line_582" id="line_582">  582.</a></span><span class="count        ">      2</span><span>        // postMessage to web-worker</span></pre>
<pre><span class="lineno"><a href="#line_583" id="line_583">  583.</a></span><span class="count        ">      2</span><span>        sqlWorker.postMessage(</span></pre>
<pre><span class="lineno"><a href="#line_584" id="line_584">  584.</a></span><span class="count        ">      2</span><span>            {</span></pre>
<pre><span class="lineno"><a href="#line_585" id="line_585">  585.</a></span><span class="count        ">      2</span><span>                FILENAME_DBTMP,</span></pre>
<pre><span class="lineno"><a href="#line_586" id="line_586">  586.</a></span><span class="count        ">      2</span><span>                JSBATON_OFFSET_ALL,</span></pre>
<pre><span class="lineno"><a href="#line_587" id="line_587">  587.</a></span><span class="count        ">      2</span><span>                JSBATON_OFFSET_BUFV,</span></pre>
<pre><span class="lineno"><a href="#line_588" id="line_588">  588.</a></span><span class="count        ">      2</span><span>                argList,</span></pre>
<pre><span class="lineno"><a href="#line_589" id="line_589">  589.</a></span><span class="count        ">      2</span><span>                baton,</span></pre>
<pre><span class="lineno"><a href="#line_590" id="line_590">  590.</a></span><span class="count        ">      2</span><span>                funcname,</span></pre>
<pre><span class="lineno"><a href="#line_591" id="line_591">  591.</a></span><span class="count        ">      2</span><span>                id</span></pre>
<pre><span class="lineno"><a href="#line_592" id="line_592">  592.</a></span><span class="count        ">      2</span><span>            },</span></pre>
<pre><span class="lineno"><a href="#line_593" id="line_593">  593.</a></span><span class="count        ">      2</span><span>            // transfer arraybuffer without copying</span></pre>
<pre><span class="lineno"><a href="#line_594" id="line_594">  594.</a></span><span class="count        ">      2</span><span>            [baton.buffer, ...argList.filter(isExternalBuffer)]</span></pre>
<pre><span class="lineno"><a href="#line_595" id="line_595">  595.</a></span><span class="count        ">      2</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_596" id="line_596">  596.</a></span><span class="count        ">      2</span><span>        // init timeElapsed</span></pre>
<pre><span class="lineno"><a href="#line_597" id="line_597">  597.</a></span><span class="count        ">      2</span><span>        timeElapsed = Date.now();</span></pre>
<pre><span class="lineno"><a href="#line_598" id="line_598">  598.</a></span><span class="count        ">      2</span><span>        // await result from web-worker</span></pre>
<pre><span class="lineno"><a href="#line_599" id="line_599">  599.</a></span><span class="count        ">      2</span><span>        result = await new Promise(function (resolve) {</span></pre>
<pre><span class="lineno"><a href="#line_600" id="line_600">  600.</a></span><span class="count        ">      2</span><span>            sqlMessageDict[id] = resolve;</span></pre>
<pre><span class="lineno"><a href="#line_601" id="line_601">  601.</a></span><span class="count        ">      2</span><span>        });</span></pre>
<pre><span class="lineno"><a href="#line_602" id="line_602">  602.</a></span><span class="count        ">      2</span><span>        // cleanup sqlMessageDict</span></pre>
<pre><span class="lineno"><a href="#line_603" id="line_603">  603.</a></span><span class="count        ">      2</span><span>        delete sqlMessageDict[id];</span></pre>
<pre><span class="lineno"><a href="#line_604" id="line_604">  604.</a></span><span class="count        ">      2</span><span>        // debug slow postMessage</span></pre>
<pre><span class="lineno"><a href="#line_605" id="line_605">  605.</a></span><span class="count        ">      2</span><span>        timeElapsed = Date.now() - timeElapsed;</span></pre>
<pre><span class="lineno"><a href="#line_606" id="line_606">  606.</a></span><span class="count        ">      2</span><span>        if (timeElapsed &gt; 500 || funcname === "testTimeElapsed") {</span></pre>
<pre><span class="lineno"><a href="#line_607" id="line_607">  607.</a></span><span class="count        ">      1</span><span>            consoleError(</span></pre>
<pre><span class="lineno"><a href="#line_608" id="line_608">  608.</a></span><span class="count        ">      1</span><span>                "sqlMessagePost - "</span></pre>
<pre><span class="lineno"><a href="#line_609" id="line_609">  609.</a></span><span class="count        ">      1</span><span>                + JSON.stringify({funcname, timeElapsed})</span></pre>
<pre><span class="lineno"><a href="#line_610" id="line_610">  610.</a></span><span class="count        ">      1</span><span>                + errStack</span></pre>
<pre><span class="lineno"><a href="#line_611" id="line_611">  611.</a></span><span class="count        ">      1</span><span>            );</span></pre>
<pre><span class="lineno"><a href="#line_612" id="line_612">  612.</a></span><span class="count        ">      2</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_613" id="line_613">  613.</a></span><span class="count        ">      2</span><span>        assertOrThrow(!result.errmsg, result.errmsg);</span></pre>
<pre><span class="lineno"><a href="#line_614" id="line_614">  614.</a></span><span class="count        ">      2</span><span>        // prepend baton to argList</span></pre>
<pre><span class="lineno"><a href="#line_615" id="line_615">  615.</a></span><span class="count        ">      2</span><span>        return [result.baton, ...result.argList];</span></pre>
<pre><span class="lineno"><a href="#line_616" id="line_616">  616.</a></span><span class="count        ">     55</span><span>    } catch (err) {</span></pre>
<pre><span class="lineno"><a href="#line_617" id="line_617">  617.</a></span><span class="count        ">     55</span><span>        err.stack += errStack;</span></pre>
<pre><span class="lineno"><a href="#line_618" id="line_618">  618.</a></span><span class="count        ">     55</span><span>        assertOrThrow(undefined, err);</span></pre>
<pre><span class="lineno"><a href="#line_619" id="line_619">  619.</a></span><span class="count        ">     55</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_620" id="line_620">  620.</a></span><span class="count        ">   3979</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_621" id="line_621">  621.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_622" id="line_622">  622.</a></span><span class="count        ">      3</span><span>async function dbCloseAsync(db) {</span></pre>
<pre><span class="lineno"><a href="#line_623" id="line_623">  623.</a></span><span class="count        ">      3</span><span></span></pre>
<pre><span class="lineno"><a href="#line_624" id="line_624">  624.</a></span><span class="count        ">      3</span><span>// This function will close sqlite-database-connection &lt;db&gt;.</span></pre>
<pre><span class="lineno"><a href="#line_625" id="line_625">  625.</a></span><span class="count        ">      3</span><span></span></pre>
<pre><span class="lineno"><a href="#line_626" id="line_626">  626.</a></span><span class="count        ">      3</span><span>    // prevent segfault - do not close db if actions are pending</span></pre>
<pre><span class="lineno"><a href="#line_627" id="line_627">  627.</a></span><span class="count        ">      3</span><span>    assertOrThrow(</span></pre>
<pre><span class="lineno"><a href="#line_628" id="line_628">  628.</a></span><span class="count        ">      3</span><span>        db.busy === 0,</span></pre>
<pre><span class="lineno"><a href="#line_629" id="line_629">  629.</a></span><span class="count        ">      3</span><span>        `dbCloseAsync - cannot close db with ${db.busy} actions pending`</span></pre>
<pre><span class="lineno"><a href="#line_630" id="line_630">  630.</a></span><span class="count        ">      3</span><span>    );</span></pre>
<pre><span class="lineno"><a href="#line_631" id="line_631">  631.</a></span><span class="count        ">      3</span><span>    // cleanup connPool</span></pre>
<pre><span class="lineno"><a href="#line_632" id="line_632">  632.</a></span><span class="count        ">      1</span><span>    await Promise.all(db.connPool.map(async function (ptr) {</span></pre>
<pre><span class="lineno"><a href="#line_633" id="line_633">  633.</a></span><span class="count        ">      1</span><span>        let val = ptr[0];</span></pre>
<pre><span class="lineno"><a href="#line_634" id="line_634">  634.</a></span><span class="count        ">      1</span><span>        ptr[0] = 0n;</span></pre>
<pre><span class="lineno"><a href="#line_635" id="line_635">  635.</a></span><span class="count        ">      1</span><span>        await dbCallAsync(jsbatonCreate("_dbClose"), [val, db.filename]);</span></pre>
<pre><span class="lineno"><a href="#line_636" id="line_636">  636.</a></span><span class="count        ">      1</span><span>    }));</span></pre>
<pre><span class="lineno"><a href="#line_637" id="line_637">  637.</a></span><span class="count        ">      1</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_638" id="line_638">  638.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_639" id="line_639">  639.</a></span><span class="count        ">     58</span><span>function dbExecAndReturnLastBlob({</span></pre>
<pre><span class="lineno"><a href="#line_640" id="line_640">  640.</a></span><span class="count        ">     58</span><span>    bindList = [],</span></pre>
<pre><span class="lineno"><a href="#line_641" id="line_641">  641.</a></span><span class="count        ">     58</span><span>    db,</span></pre>
<pre><span class="lineno"><a href="#line_642" id="line_642">  642.</a></span><span class="count        ">     58</span><span>    sql</span></pre>
<pre><span class="lineno"><a href="#line_643" id="line_643">  643.</a></span><span class="count        ">     58</span><span>}) {</span></pre>
<pre><span class="lineno"><a href="#line_644" id="line_644">  644.</a></span><span class="count        ">     58</span><span></span></pre>
<pre><span class="lineno"><a href="#line_645" id="line_645">  645.</a></span><span class="count        ">     58</span><span>// This function will exec &lt;sql&gt; in &lt;db&gt;,</span></pre>
<pre><span class="lineno"><a href="#line_646" id="line_646">  646.</a></span><span class="count        ">     58</span><span>// and return last-value retrieved from execution as raw blob/buffer.</span></pre>
<pre><span class="lineno"><a href="#line_647" id="line_647">  647.</a></span><span class="count        ">     58</span><span></span></pre>
<pre><span class="lineno"><a href="#line_648" id="line_648">  648.</a></span><span class="count        ">     58</span><span>    return dbExecAsync({</span></pre>
<pre><span class="lineno"><a href="#line_649" id="line_649">  649.</a></span><span class="count        ">     58</span><span>        bindList,</span></pre>
<pre><span class="lineno"><a href="#line_650" id="line_650">  650.</a></span><span class="count        ">     58</span><span>        db,</span></pre>
<pre><span class="lineno"><a href="#line_651" id="line_651">  651.</a></span><span class="count        ">     58</span><span>        responseType: "lastblob",</span></pre>
<pre><span class="lineno"><a href="#line_652" id="line_652">  652.</a></span><span class="count        ">     58</span><span>        sql</span></pre>
<pre><span class="lineno"><a href="#line_653" id="line_653">  653.</a></span><span class="count        ">     58</span><span>    });</span></pre>
<pre><span class="lineno"><a href="#line_654" id="line_654">  654.</a></span><span class="count        ">     58</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_655" id="line_655">  655.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_656" id="line_656">  656.</a></span><span class="count        ">    115</span><span>async function dbExecAndReturnLastRow({</span></pre>
<pre><span class="lineno"><a href="#line_657" id="line_657">  657.</a></span><span class="count        ">    115</span><span>    bindList = [],</span></pre>
<pre><span class="lineno"><a href="#line_658" id="line_658">  658.</a></span><span class="count        ">    115</span><span>    db,</span></pre>
<pre><span class="lineno"><a href="#line_659" id="line_659">  659.</a></span><span class="count        ">    115</span><span>    sql</span></pre>
<pre><span class="lineno"><a href="#line_660" id="line_660">  660.</a></span><span class="count        ">    115</span><span>}) {</span></pre>
<pre><span class="lineno"><a href="#line_661" id="line_661">  661.</a></span><span class="count        ">    115</span><span></span></pre>
<pre><span class="lineno"><a href="#line_662" id="line_662">  662.</a></span><span class="count        ">    115</span><span>// This function will exec &lt;sql&gt; in &lt;db&gt;,</span></pre>
<pre><span class="lineno"><a href="#line_663" id="line_663">  663.</a></span><span class="count        ">    115</span><span>// and return last-row or empty-object.</span></pre>
<pre><span class="lineno"><a href="#line_664" id="line_664">  664.</a></span><span class="count        ">    115</span><span></span></pre>
<pre><span class="lineno"><a href="#line_665" id="line_665">  665.</a></span><span class="count        ">    101</span><span>    let result = await dbExecAsync({bindList, db, sql});</span></pre>
<pre><span class="lineno"><a href="#line_666" id="line_666">  666.</a></span><span class="count        ">    101</span><span>    result = result[result.length - 1] || [];</span></pre>
<pre><span class="lineno"><a href="#line_667" id="line_667">  667.</a></span><span class="count        ">      1</span><span>    result = result[result.length - 1] || {};</span></pre>
<pre><span class="lineno"><a href="#line_668" id="line_668">  668.</a></span><span class="count        ">    115</span><span>    return result;</span></pre>
<pre><span class="lineno"><a href="#line_669" id="line_669">  669.</a></span><span class="count        ">    115</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_670" id="line_670">  670.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_671" id="line_671">  671.</a></span><span class="count        ">     65</span><span>async function dbExecAndReturnLastTable({</span></pre>
<pre><span class="lineno"><a href="#line_672" id="line_672">  672.</a></span><span class="count        ">     65</span><span>    bindList = [],</span></pre>
<pre><span class="lineno"><a href="#line_673" id="line_673">  673.</a></span><span class="count        ">     65</span><span>    db,</span></pre>
<pre><span class="lineno"><a href="#line_674" id="line_674">  674.</a></span><span class="count        ">     65</span><span>    sql</span></pre>
<pre><span class="lineno"><a href="#line_675" id="line_675">  675.</a></span><span class="count        ">     65</span><span>}) {</span></pre>
<pre><span class="lineno"><a href="#line_676" id="line_676">  676.</a></span><span class="count        ">     65</span><span></span></pre>
<pre><span class="lineno"><a href="#line_677" id="line_677">  677.</a></span><span class="count        ">     65</span><span>// This function will exec &lt;sql&gt; in &lt;db&gt;,</span></pre>
<pre><span class="lineno"><a href="#line_678" id="line_678">  678.</a></span><span class="count        ">     65</span><span>// and return last-table or empty-list.</span></pre>
<pre><span class="lineno"><a href="#line_679" id="line_679">  679.</a></span><span class="count        ">     65</span><span></span></pre>
<pre><span class="lineno"><a href="#line_680" id="line_680">  680.</a></span><span class="count        ">     65</span><span>    let result = await dbExecAsync({bindList, db, sql});</span></pre>
<pre><span class="lineno"><a href="#line_681" id="line_681">  681.</a></span><span class="count        ">      1</span><span>    result = result[result.length - 1] || [];</span></pre>
<pre><span class="lineno"><a href="#line_682" id="line_682">  682.</a></span><span class="count        ">     65</span><span>    return result;</span></pre>
<pre><span class="lineno"><a href="#line_683" id="line_683">  683.</a></span><span class="count        ">     65</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_684" id="line_684">  684.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_685" id="line_685">  685.</a></span><span class="count        ">   1184</span><span>function dbExecAndReturnLastValue({</span></pre>
<pre><span class="lineno"><a href="#line_686" id="line_686">  686.</a></span><span class="count        ">   1184</span><span>    bindList = [],</span></pre>
<pre><span class="lineno"><a href="#line_687" id="line_687">  687.</a></span><span class="count        ">   1184</span><span>    db,</span></pre>
<pre><span class="lineno"><a href="#line_688" id="line_688">  688.</a></span><span class="count        ">   1184</span><span>    sql</span></pre>
<pre><span class="lineno"><a href="#line_689" id="line_689">  689.</a></span><span class="count        ">   1184</span><span>}) {</span></pre>
<pre><span class="lineno"><a href="#line_690" id="line_690">  690.</a></span><span class="count        ">   1184</span><span></span></pre>
<pre><span class="lineno"><a href="#line_691" id="line_691">  691.</a></span><span class="count        ">   1184</span><span>// This function will exec &lt;sql&gt; in &lt;db&gt;,</span></pre>
<pre><span class="lineno"><a href="#line_692" id="line_692">  692.</a></span><span class="count        ">   1184</span><span>// and return last-json-value.</span></pre>
<pre><span class="lineno"><a href="#line_693" id="line_693">  693.</a></span><span class="count        ">   1184</span><span></span></pre>
<pre><span class="lineno"><a href="#line_694" id="line_694">  694.</a></span><span class="count        ">   1184</span><span>    return dbExecAsync({</span></pre>
<pre><span class="lineno"><a href="#line_695" id="line_695">  695.</a></span><span class="count        ">   1184</span><span>        bindList,</span></pre>
<pre><span class="lineno"><a href="#line_696" id="line_696">  696.</a></span><span class="count        ">   1184</span><span>        db,</span></pre>
<pre><span class="lineno"><a href="#line_697" id="line_697">  697.</a></span><span class="count        ">   1184</span><span>        responseType: "lastvalue",</span></pre>
<pre><span class="lineno"><a href="#line_698" id="line_698">  698.</a></span><span class="count        ">   1184</span><span>        sql</span></pre>
<pre><span class="lineno"><a href="#line_699" id="line_699">  699.</a></span><span class="count        ">   1184</span><span>    });</span></pre>
<pre><span class="lineno"><a href="#line_700" id="line_700">  700.</a></span><span class="count        ">   1184</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_701" id="line_701">  701.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_702" id="line_702">  702.</a></span><span class="count        ">   1928</span><span>async function dbExecAsync({</span></pre>
<pre><span class="lineno"><a href="#line_703" id="line_703">  703.</a></span><span class="count        ">   1928</span><span>    bindList = [],</span></pre>
<pre><span class="lineno"><a href="#line_704" id="line_704">  704.</a></span><span class="count        ">   1928</span><span>    db,</span></pre>
<pre><span class="lineno"><a href="#line_705" id="line_705">  705.</a></span><span class="count        ">   1928</span><span>    responseType,</span></pre>
<pre><span class="lineno"><a href="#line_706" id="line_706">  706.</a></span><span class="count        ">   1928</span><span>    sql</span></pre>
<pre><span class="lineno"><a href="#line_707" id="line_707">  707.</a></span><span class="count        ">   1928</span><span>}) {</span></pre>
<pre><span class="lineno"><a href="#line_708" id="line_708">  708.</a></span><span class="count        ">   1928</span><span></span></pre>
<pre><span class="lineno"><a href="#line_709" id="line_709">  709.</a></span><span class="count        ">   1928</span><span>// This function will exec &lt;sql&gt; in &lt;db&gt; and return &lt;result&gt;.</span></pre>
<pre><span class="lineno"><a href="#line_710" id="line_710">  710.</a></span><span class="count        ">   1928</span><span></span></pre>
<pre><span class="lineno"><a href="#line_711" id="line_711">  711.</a></span><span class="count        ">   1928</span><span>    let baton = jsbatonCreate("_dbExec");</span></pre>
<pre><span class="lineno"><a href="#line_712" id="line_712">  712.</a></span><span class="count        ">   1928</span><span>    let bindByKey = !Array.isArray(bindList);</span></pre>
<pre><span class="lineno"><a href="#line_713" id="line_713">  713.</a></span><span class="count        ">   1928</span><span>    let bufi = [0];</span></pre>
<pre><span class="lineno"><a href="#line_714" id="line_714">  714.</a></span><span class="count        ">   1928</span><span>    let referenceList = [];</span></pre>
<pre><span class="lineno"><a href="#line_715" id="line_715">  715.</a></span><span class="count        ">   1928</span><span>    let result;</span></pre>
<pre><span class="lineno"><a href="#line_716" id="line_716">  716.</a></span><span class="count        ">   1235</span><span>    if (bindByKey) {</span></pre>
<pre><span class="lineno"><a href="#line_717" id="line_717">  717.</a></span><span class="count        ">   1347</span><span>        Object.entries(bindList).forEach(function ([key, val]) {</span></pre>
<pre><span class="lineno"><a href="#line_718" id="line_718">  718.</a></span><span class="count        ">   1347</span><span>            baton = jsbatonSetValue(baton, undefined, `:${key}\u0000`);</span></pre>
<pre><span class="lineno"><a href="#line_719" id="line_719">  719.</a></span><span class="count        ">   1347</span><span>            baton = jsbatonSetValue(</span></pre>
<pre><span class="lineno"><a href="#line_720" id="line_720">  720.</a></span><span class="count        ">   1347</span><span>                baton,</span></pre>
<pre><span class="lineno"><a href="#line_721" id="line_721">  721.</a></span><span class="count        ">   1347</span><span>                undefined,</span></pre>
<pre><span class="lineno"><a href="#line_722" id="line_722">  722.</a></span><span class="count        ">   1347</span><span>                val,</span></pre>
<pre><span class="lineno"><a href="#line_723" id="line_723">  723.</a></span><span class="count        ">   1347</span><span>                bufi,</span></pre>
<pre><span class="lineno"><a href="#line_724" id="line_724">  724.</a></span><span class="count        ">   1347</span><span>                referenceList</span></pre>
<pre><span class="lineno"><a href="#line_725" id="line_725">  725.</a></span><span class="count        ">   1347</span><span>            );</span></pre>
<pre><span class="lineno"><a href="#line_726" id="line_726">  726.</a></span><span class="count        ">   1347</span><span>        });</span></pre>
<pre><span class="lineno"><a href="#line_727" id="line_727">  727.</a></span><span class="count        ">   1235</span><span>    } else {</span></pre>
<pre><span class="lineno"><a href="#line_728" id="line_728">  728.</a></span><span class="count        ">    693</span><span>        bindList.forEach(function (val) {</span></pre>
<pre><span class="lineno"><a href="#line_729" id="line_729">  729.</a></span><span class="count        ">    693</span><span>            baton = jsbatonSetValue(</span></pre>
<pre><span class="lineno"><a href="#line_730" id="line_730">  730.</a></span><span class="count        ">    693</span><span>                baton,</span></pre>
<pre><span class="lineno"><a href="#line_731" id="line_731">  731.</a></span><span class="count        ">    693</span><span>                undefined,</span></pre>
<pre><span class="lineno"><a href="#line_732" id="line_732">  732.</a></span><span class="count        ">    693</span><span>                val,</span></pre>
<pre><span class="lineno"><a href="#line_733" id="line_733">  733.</a></span><span class="count        ">    693</span><span>                bufi,</span></pre>
<pre><span class="lineno"><a href="#line_734" id="line_734">  734.</a></span><span class="count        ">    693</span><span>                referenceList</span></pre>
<pre><span class="lineno"><a href="#line_735" id="line_735">  735.</a></span><span class="count        ">    693</span><span>            );</span></pre>
<pre><span class="lineno"><a href="#line_736" id="line_736">  736.</a></span><span class="count        ">    693</span><span>        });</span></pre>
<pre><span class="lineno"><a href="#line_737" id="line_737">  737.</a></span><span class="count        ">   1916</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_738" id="line_738">  738.</a></span><span class="count        ">   1916</span><span>    [baton, ...result] = await dbCallAsync(</span></pre>
<pre><span class="lineno"><a href="#line_739" id="line_739">  739.</a></span><span class="count        ">   1916</span><span>        baton,</span></pre>
<pre><span class="lineno"><a href="#line_740" id="line_740">  740.</a></span><span class="count        ">   1916</span><span>        [</span></pre>
<pre><span class="lineno"><a href="#line_741" id="line_741">  741.</a></span><span class="count        ">   1916</span><span>            // 0. db</span></pre>
<pre><span class="lineno"><a href="#line_742" id="line_742">  742.</a></span><span class="count        ">   1916</span><span>            db,</span></pre>
<pre><span class="lineno"><a href="#line_743" id="line_743">  743.</a></span><span class="count        ">   1916</span><span>            // 1. sql</span></pre>
<pre><span class="lineno"><a href="#line_744" id="line_744">  744.</a></span><span class="count        ">   1916</span><span>            String(sql) + "\n;\nPRAGMA noop",</span></pre>
<pre><span class="lineno"><a href="#line_745" id="line_745">  745.</a></span><span class="count        ">   1916</span><span>            // 2. bindList.length</span></pre>
<pre><span class="lineno"><a href="#line_746" id="line_746">  746.</a></span><span class="count        ">   1916</span><span>            (</span></pre>
<pre><span class="lineno"><a href="#line_747" id="line_747">  747.</a></span><span class="count        ">   1916</span><span>                bindByKey</span></pre>
<pre><span class="lineno"><a href="#line_748" id="line_748">  748.</a></span><span class="count        ">   1916</span><span>                ? Object.keys(bindList).length</span></pre>
<pre><span class="lineno"><a href="#line_749" id="line_749">  749.</a></span><span class="count        ">    681</span><span>                : bindList.length</span></pre>
<pre><span class="lineno"><a href="#line_750" id="line_750">  750.</a></span><span class="count        ">   1928</span><span>            ),</span></pre>
<pre><span class="lineno"><a href="#line_751" id="line_751">  751.</a></span><span class="count        ">   1928</span><span>            // 3. bindByKey</span></pre>
<pre><span class="lineno"><a href="#line_752" id="line_752">  752.</a></span><span class="count        ">   1928</span><span>            bindByKey,</span></pre>
<pre><span class="lineno"><a href="#line_753" id="line_753">  753.</a></span><span class="count        ">   1928</span><span>            // 4. responseType</span></pre>
<pre><span class="lineno"><a href="#line_754" id="line_754">  754.</a></span><span class="count        ">   1928</span><span>            (</span></pre>
<pre><span class="lineno"><a href="#line_755" id="line_755">  755.</a></span><span class="count        ">   1928</span><span>                responseType === "lastblob"</span></pre>
<pre><span class="lineno"><a href="#line_756" id="line_756">  756.</a></span><span class="count        ">     56</span><span>                ? SQLITE_RESPONSETYPE_LASTBLOB</span></pre>
<pre><span class="lineno"><a href="#line_757" id="line_757">  757.</a></span><span class="count        ">   1860</span><span>                : responseType === "lastvalue"</span></pre>
<pre><span class="lineno"><a href="#line_758" id="line_758">  758.</a></span><span class="count        ">   1860</span><span>                ? SQLITE_RESPONSETYPE_LASTVALUE</span></pre>
<pre><span class="lineno"><a href="#line_759" id="line_759">  759.</a></span><span class="count        ">   1860</span><span>                : 0</span></pre>
<pre><span class="lineno"><a href="#line_760" id="line_760">  760.</a></span><span class="count        ">   1928</span><span>            )</span></pre>
<pre><span class="lineno"><a href="#line_761" id="line_761">  761.</a></span><span class="count        ">   1928</span><span>        ],</span></pre>
<pre><span class="lineno"><a href="#line_762" id="line_762">  762.</a></span><span class="count        ">   1928</span><span>        "modeDb"</span></pre>
<pre><span class="lineno"><a href="#line_763" id="line_763">  763.</a></span><span class="count        ">   1861</span><span>    );</span></pre>
<pre><span class="lineno"><a href="#line_764" id="line_764">  764.</a></span><span class="count        ">   1861</span><span>    result = result[0];</span></pre>
<pre><span class="lineno"><a href="#line_765" id="line_765">  765.</a></span><span class="count        ">   1861</span><span>    if (!IS_BROWSER) {</span></pre>
<pre><span class="lineno"><a href="#line_766" id="line_766">  766.</a></span><span class="count        ">   1861</span><span>        result = cModule._jsbatonStealCbuffer(</span></pre>
<pre><span class="lineno"><a href="#line_767" id="line_767">  767.</a></span><span class="count        ">   1861</span><span>            baton.buffer,</span></pre>
<pre><span class="lineno"><a href="#line_768" id="line_768">  768.</a></span><span class="count        ">   1861</span><span>            0,</span></pre>
<pre><span class="lineno"><a href="#line_769" id="line_769">  769.</a></span><span class="count        ">   1861</span><span>            Number(</span></pre>
<pre><span class="lineno"><a href="#line_770" id="line_770">  770.</a></span><span class="count        ">   1861</span><span>                responseType !== "arraybuffer" &amp;&amp; responseType !== "lastblob"</span></pre>
<pre><span class="lineno"><a href="#line_771" id="line_771">  771.</a></span><span class="count        ">   1861</span><span>            )</span></pre>
<pre><span class="lineno"><a href="#line_772" id="line_772">  772.</a></span><span class="count        ">   1861</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_773" id="line_773">  773.</a></span><span class="count        ">   1861</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_774" id="line_774">  774.</a></span><span class="count        ">   1861</span><span>    switch (responseType) {</span></pre>
<pre><span class="lineno"><a href="#line_775" id="line_775">  775.</a></span><span class="count        ">   1861</span><span>    case "arraybuffer":</span></pre>
<pre><span class="lineno"><a href="#line_776" id="line_776">  776.</a></span><span class="count        ">    110</span><span>    case "lastblob":</span></pre>
<pre><span class="lineno"><a href="#line_777" id="line_777">  777.</a></span><span class="count        ">    110</span><span>        return result;</span></pre>
<pre><span class="lineno"><a href="#line_778" id="line_778">  778.</a></span><span class="count        ">   1236</span><span>    case "lastvalue":</span></pre>
<pre><span class="lineno"><a href="#line_779" id="line_779">  779.</a></span><span class="count        ">   1403</span><span>    case "list":</span></pre>
<pre><span class="lineno"><a href="#line_780" id="line_780">  780.</a></span><span class="count        ">   1403</span><span>        return jsonParseArraybuffer(result);</span></pre>
<pre><span class="lineno"><a href="#line_781" id="line_781">  781.</a></span><span class="count        ">    348</span><span>    default:</span></pre>
<pre><span class="lineno"><a href="#line_782" id="line_782">  782.</a></span><span class="count        ">    374</span><span>        return jsonParseArraybuffer(result).map(function (table) {</span></pre>
<pre><span class="lineno"><a href="#line_783" id="line_783">  783.</a></span><span class="count        ">    374</span><span>            let colList = table.shift();</span></pre>
<pre><span class="lineno"><a href="#line_784" id="line_784">  784.</a></span><span class="count        ">  13942</span><span>            return table.map(function (row) {</span></pre>
<pre><span class="lineno"><a href="#line_785" id="line_785">  785.</a></span><span class="count        ">  13942</span><span>                let dict = {};</span></pre>
<pre><span class="lineno"><a href="#line_786" id="line_786">  786.</a></span><span class="count        ">  40235</span><span>                colList.forEach(function (key, ii) {</span></pre>
<pre><span class="lineno"><a href="#line_787" id="line_787">  787.</a></span><span class="count        ">  40235</span><span>                    dict[key] = row[ii];</span></pre>
<pre><span class="lineno"><a href="#line_788" id="line_788">  788.</a></span><span class="count        ">  40235</span><span>                });</span></pre>
<pre><span class="lineno"><a href="#line_789" id="line_789">  789.</a></span><span class="count        ">  13942</span><span>                return dict;</span></pre>
<pre><span class="lineno"><a href="#line_790" id="line_790">  790.</a></span><span class="count        ">  13942</span><span>            });</span></pre>
<pre><span class="lineno"><a href="#line_791" id="line_791">  791.</a></span><span class="count        ">    374</span><span>        });</span></pre>
<pre><span class="lineno"><a href="#line_792" id="line_792">  792.</a></span><span class="count        ">   1928</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_793" id="line_793">  793.</a></span><span class="count        ">   1928</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_794" id="line_794">  794.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_795" id="line_795">  795.</a></span><span class="count        ">     18</span><span>async function dbFileLoadAsync({</span></pre>
<pre><span class="lineno"><a href="#line_796" id="line_796">  796.</a></span><span class="count        ">     18</span><span>    db,</span></pre>
<pre><span class="lineno"><a href="#line_797" id="line_797">  797.</a></span><span class="count        ">     18</span><span>    dbData,</span></pre>
<pre><span class="lineno"><a href="#line_798" id="line_798">  798.</a></span><span class="count        ">     18</span><span>    filename,</span></pre>
<pre><span class="lineno"><a href="#line_799" id="line_799">  799.</a></span><span class="count        ">     18</span><span>    modeNoop,</span></pre>
<pre><span class="lineno"><a href="#line_800" id="line_800">  800.</a></span><span class="count        ">     18</span><span>    modeSave = 0</span></pre>
<pre><span class="lineno"><a href="#line_801" id="line_801">  801.</a></span><span class="count        ">     18</span><span>}) {</span></pre>
<pre><span class="lineno"><a href="#line_802" id="line_802">  802.</a></span><span class="count        ">     18</span><span></span></pre>
<pre><span class="lineno"><a href="#line_803" id="line_803">  803.</a></span><span class="count        ">     18</span><span>// This function will load &lt;filename&gt; to &lt;db&gt;.</span></pre>
<pre><span class="lineno"><a href="#line_804" id="line_804">  804.</a></span><span class="count        ">     18</span><span></span></pre>
<pre><span class="lineno"><a href="#line_805" id="line_805">  805.</a></span><span class="count        ">     18</span><span>    let filename2;</span></pre>
<pre><span class="lineno"><a href="#line_806" id="line_806">  806.</a></span><span class="count        ">     15</span><span>    async function _dbFileLoad() {</span></pre>
<pre><span class="lineno"><a href="#line_807" id="line_807">  807.</a></span><span class="count        ">     15</span><span>        dbData = await dbCallAsync(</span></pre>
<pre><span class="lineno"><a href="#line_808" id="line_808">  808.</a></span><span class="count        ">     15</span><span>            jsbatonCreate("_dbFileLoad"),</span></pre>
<pre><span class="lineno"><a href="#line_809" id="line_809">  809.</a></span><span class="count        ">     15</span><span>            [</span></pre>
<pre><span class="lineno"><a href="#line_810" id="line_810">  810.</a></span><span class="count        ">     15</span><span>                // 0. sqlite3 * pInMemory</span></pre>
<pre><span class="lineno"><a href="#line_811" id="line_811">  811.</a></span><span class="count        ">     15</span><span>                db,</span></pre>
<pre><span class="lineno"><a href="#line_812" id="line_812">  812.</a></span><span class="count        ">     15</span><span>                // 1. char *zFilename</span></pre>
<pre><span class="lineno"><a href="#line_813" id="line_813">  813.</a></span><span class="count        ">     15</span><span>                filename,</span></pre>
<pre><span class="lineno"><a href="#line_814" id="line_814">  814.</a></span><span class="count        ">     15</span><span>                // 2. const int isSave</span></pre>
<pre><span class="lineno"><a href="#line_815" id="line_815">  815.</a></span><span class="count        ">     15</span><span>                modeSave,</span></pre>
<pre><span class="lineno"><a href="#line_816" id="line_816">  816.</a></span><span class="count        ">     15</span><span>                // 3. undefined</span></pre>
<pre><span class="lineno"><a href="#line_817" id="line_817">  817.</a></span><span class="count        ">     15</span><span>                undefined,</span></pre>
<pre><span class="lineno"><a href="#line_818" id="line_818">  818.</a></span><span class="count        ">     15</span><span>                // 4. dbData - same position as dbOpenAsync</span></pre>
<pre><span class="lineno"><a href="#line_819" id="line_819">  819.</a></span><span class="count        ">     15</span><span>                dbData</span></pre>
<pre><span class="lineno"><a href="#line_820" id="line_820">  820.</a></span><span class="count        ">     15</span><span>            ],</span></pre>
<pre><span class="lineno"><a href="#line_821" id="line_821">  821.</a></span><span class="count        ">     15</span><span>            "modeDb"</span></pre>
<pre><span class="lineno"><a href="#line_822" id="line_822">  822.</a></span><span class="count        ">     15</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_823" id="line_823">  823.</a></span><span class="count        ">     15</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_824" id="line_824">  824.</a></span><span class="count        ">      1</span><span>    if (modeNoop) {</span></pre>
<pre><span class="lineno"><a href="#line_825" id="line_825">  825.</a></span><span class="count        ">      1</span><span>        return;</span></pre>
<pre><span class="lineno"><a href="#line_826" id="line_826">  826.</a></span><span class="count        ">     17</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_827" id="line_827">  827.</a></span><span class="count        ">     17</span><span>    if (IS_BROWSER) {</span></pre>
<pre><span class="lineno"><a href="#line_828" id="line_828">  828.</a></span><span class="count        ">      1</span><span>        filename = FILENAME_DBTMP;</span></pre>
<pre><span class="lineno"><a href="#line_829" id="line_829">  829.</a></span><span class="count        ">     17</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_830" id="line_830">  830.</a></span><span class="count        ">     17</span><span>    assertOrThrow(</span></pre>
<pre><span class="lineno"><a href="#line_831" id="line_831">  831.</a></span><span class="count        ">     17</span><span>        typeof filename === "string" &amp;&amp; filename,</span></pre>
<pre><span class="lineno"><a href="#line_832" id="line_832">  832.</a></span><span class="count        ">     18</span><span>        `invalid filename ${filename}`</span></pre>
<pre><span class="lineno"><a href="#line_833" id="line_833">  833.</a></span><span class="count        ">     18</span><span>    );</span></pre>
<pre><span class="lineno"><a href="#line_834" id="line_834">  834.</a></span><span class="count        ">     18</span><span>    // Save to tmpfile and then atomically-rename to actual-filename.</span></pre>
<pre><span class="lineno"><a href="#line_835" id="line_835">  835.</a></span><span class="count        ">     15</span><span>    if (moduleFs &amp;&amp; modeSave) {</span></pre>
<pre><span class="lineno"><a href="#line_836" id="line_836">  836.</a></span><span class="count        ">     13</span><span>        filename2 = filename;</span></pre>
<pre><span class="lineno"><a href="#line_837" id="line_837">  837.</a></span><span class="count        ">     13</span><span>        filename = modulePath.join(</span></pre>
<pre><span class="lineno"><a href="#line_838" id="line_838">  838.</a></span><span class="count        ">     13</span><span>            modulePath.dirname(filename),</span></pre>
<pre><span class="lineno"><a href="#line_839" id="line_839">  839.</a></span><span class="count        ">     13</span><span>            `.dbFileSaveAsync.${moduleCrypto.randomUUID()}`</span></pre>
<pre><span class="lineno"><a href="#line_840" id="line_840">  840.</a></span><span class="count        ">     13</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_841" id="line_841">  841.</a></span><span class="count        ">     13</span><span>        try {</span></pre>
<pre><span class="lineno"><a href="#line_842" id="line_842">  842.</a></span><span class="count        ">     13</span><span>            await _dbFileLoad();</span></pre>
<pre><span class="lineno"><a href="#line_843" id="line_843">  843.</a></span><span class="count        ">     13</span><span>            await moduleFs.promises.rename(filename, filename2);</span></pre>
<pre><span class="lineno"><a href="#line_844" id="line_844">  844.</a></span><span class="count        ">     13</span><span>        } finally {</span></pre>
<pre><span class="lineno"><a href="#line_845" id="line_845">  845.</a></span><span class="count        ">     13</span><span>            await moduleFs.promises.unlink(filename).catch(noop);</span></pre>
<pre><span class="lineno"><a href="#line_846" id="line_846">  846.</a></span><span class="count        ">     13</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_847" id="line_847">  847.</a></span><span class="count        ">     13</span><span>    } else {</span></pre>
<pre><span class="lineno"><a href="#line_848" id="line_848">  848.</a></span><span class="count        ">      2</span><span>        await _dbFileLoad();</span></pre>
<pre><span class="lineno"><a href="#line_849" id="line_849">  849.</a></span><span class="count        ">     15</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_850" id="line_850">  850.</a></span><span class="count        ">     15</span><span>    return dbData[1 + 0];</span></pre>
<pre><span class="lineno"><a href="#line_851" id="line_851">  851.</a></span><span class="count        ">     15</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_852" id="line_852">  852.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_853" id="line_853">  853.</a></span><span class="count        ">     14</span><span>async function dbFileSaveAsync({</span></pre>
<pre><span class="lineno"><a href="#line_854" id="line_854">  854.</a></span><span class="count        ">     14</span><span>    db,</span></pre>
<pre><span class="lineno"><a href="#line_855" id="line_855">  855.</a></span><span class="count        ">     14</span><span>    dbData,</span></pre>
<pre><span class="lineno"><a href="#line_856" id="line_856">  856.</a></span><span class="count        ">     14</span><span>    filename,</span></pre>
<pre><span class="lineno"><a href="#line_857" id="line_857">  857.</a></span><span class="count        ">     14</span><span>    modeNoop</span></pre>
<pre><span class="lineno"><a href="#line_858" id="line_858">  858.</a></span><span class="count        ">     14</span><span>}) {</span></pre>
<pre><span class="lineno"><a href="#line_859" id="line_859">  859.</a></span><span class="count        ">     14</span><span></span></pre>
<pre><span class="lineno"><a href="#line_860" id="line_860">  860.</a></span><span class="count        ">     14</span><span>// This function will save &lt;db&gt; to &lt;filename&gt;.</span></pre>
<pre><span class="lineno"><a href="#line_861" id="line_861">  861.</a></span><span class="count        ">     14</span><span></span></pre>
<pre><span class="lineno"><a href="#line_862" id="line_862">  862.</a></span><span class="count        ">     14</span><span>    return await dbFileLoadAsync({</span></pre>
<pre><span class="lineno"><a href="#line_863" id="line_863">  863.</a></span><span class="count        ">     14</span><span>        db,</span></pre>
<pre><span class="lineno"><a href="#line_864" id="line_864">  864.</a></span><span class="count        ">     14</span><span>        dbData,</span></pre>
<pre><span class="lineno"><a href="#line_865" id="line_865">  865.</a></span><span class="count        ">     14</span><span>        filename,</span></pre>
<pre><span class="lineno"><a href="#line_866" id="line_866">  866.</a></span><span class="count        ">     14</span><span>        modeNoop,</span></pre>
<pre><span class="lineno"><a href="#line_867" id="line_867">  867.</a></span><span class="count        ">     14</span><span>        modeSave: 1</span></pre>
<pre><span class="lineno"><a href="#line_868" id="line_868">  868.</a></span><span class="count        ">     14</span><span>    });</span></pre>
<pre><span class="lineno"><a href="#line_869" id="line_869">  869.</a></span><span class="count        ">     14</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_870" id="line_870">  870.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_871" id="line_871">  871.</a></span><span class="count        ">     56</span><span>async function dbNoopAsync(...argList) {</span></pre>
<pre><span class="lineno"><a href="#line_872" id="line_872">  872.</a></span><span class="count        ">     56</span><span></span></pre>
<pre><span class="lineno"><a href="#line_873" id="line_873">  873.</a></span><span class="count        ">     56</span><span>// This function will do nothing except return &lt;argList&gt;.</span></pre>
<pre><span class="lineno"><a href="#line_874" id="line_874">  874.</a></span><span class="count        ">     56</span><span></span></pre>
<pre><span class="lineno"><a href="#line_875" id="line_875">  875.</a></span><span class="count        ">     56</span><span>    return await dbCallAsync(jsbatonCreate("_dbNoop"), argList);</span></pre>
<pre><span class="lineno"><a href="#line_876" id="line_876">  876.</a></span><span class="count        ">     56</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_877" id="line_877">  877.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_878" id="line_878">  878.</a></span><span class="count        ">     32</span><span>async function dbOpenAsync({</span></pre>
<pre><span class="lineno"><a href="#line_879" id="line_879">  879.</a></span><span class="count        ">     32</span><span>    afterFinalization,</span></pre>
<pre><span class="lineno"><a href="#line_880" id="line_880">  880.</a></span><span class="count        ">     32</span><span>    dbData,</span></pre>
<pre><span class="lineno"><a href="#line_881" id="line_881">  881.</a></span><span class="count        ">     32</span><span>    filename,</span></pre>
<pre><span class="lineno"><a href="#line_882" id="line_882">  882.</a></span><span class="count        ">     32</span><span>    flags,</span></pre>
<pre><span class="lineno"><a href="#line_883" id="line_883">  883.</a></span><span class="count        ">     32</span><span>    threadCount = 1</span></pre>
<pre><span class="lineno"><a href="#line_884" id="line_884">  884.</a></span><span class="count        ">     32</span><span>}) {</span></pre>
<pre><span class="lineno"><a href="#line_885" id="line_885">  885.</a></span><span class="count        ">     32</span><span></span></pre>
<pre><span class="lineno"><a href="#line_886" id="line_886">  886.</a></span><span class="count        ">     32</span><span>// This function will open and return sqlite-database-connection &lt;db&gt;.</span></pre>
<pre><span class="lineno"><a href="#line_887" id="line_887">  887.</a></span><span class="count        ">     32</span><span></span></pre>
<pre><span class="lineno"><a href="#line_888" id="line_888">  888.</a></span><span class="count        ">     32</span><span>// int sqlite3_open_v2(</span></pre>
<pre><span class="lineno"><a href="#line_889" id="line_889">  889.</a></span><span class="count        ">     32</span><span>//   const char *filename,   /* Database filename (UTF-8) */</span></pre>
<pre><span class="lineno"><a href="#line_890" id="line_890">  890.</a></span><span class="count        ">     32</span><span>//   sqlite3 **ppDb,         /* OUT: SQLite db handle */</span></pre>
<pre><span class="lineno"><a href="#line_891" id="line_891">  891.</a></span><span class="count        ">     32</span><span>//   int flags,              /* Flags */</span></pre>
<pre><span class="lineno"><a href="#line_892" id="line_892">  892.</a></span><span class="count        ">     32</span><span>//   const char *zVfs        /* Name of VFS module to use */</span></pre>
<pre><span class="lineno"><a href="#line_893" id="line_893">  893.</a></span><span class="count        ">     32</span><span>// );</span></pre>
<pre><span class="lineno"><a href="#line_894" id="line_894">  894.</a></span><span class="count        ">     32</span><span>    let connPool;</span></pre>
<pre><span class="lineno"><a href="#line_895" id="line_895">  895.</a></span><span class="count        ">     32</span><span>    let db = {busy: 0, filename, ii: 0};</span></pre>
<pre><span class="lineno"><a href="#line_896" id="line_896">  896.</a></span><span class="count        ">     32</span><span>    let fileLgbm;</span></pre>
<pre><span class="lineno"><a href="#line_897" id="line_897">  897.</a></span><span class="count        ">     32</span><span>    assertOrThrow(typeof filename === "string", `invalid filename ${filename}`);</span></pre>
<pre><span class="lineno"><a href="#line_898" id="line_898">  898.</a></span><span class="count        ">     32</span><span>    assertOrThrow(</span></pre>
<pre><span class="lineno"><a href="#line_899" id="line_899">  899.</a></span><span class="count        ">      1</span><span>        !dbData || isExternalBuffer(dbData),</span></pre>
<pre><span class="lineno"><a href="#line_900" id="line_900">  900.</a></span><span class="count        ">     32</span><span>        "dbData must be ArrayBuffer"</span></pre>
<pre><span class="lineno"><a href="#line_901" id="line_901">  901.</a></span><span class="count        ">     32</span><span>    );</span></pre>
<pre><span class="lineno"><a href="#line_902" id="line_902">  902.</a></span><span class="count        ">     32</span><span>    connPool = await Promise.all(Array.from(new Array(</span></pre>
<pre><span class="lineno"><a href="#line_903" id="line_903">  903.</a></span><span class="count        ">     32</span><span>        threadCount</span></pre>
<pre><span class="lineno"><a href="#line_904" id="line_904">  904.</a></span><span class="count        ">     31</span><span>    ), async function () {</span></pre>
<pre><span class="lineno"><a href="#line_905" id="line_905">  905.</a></span><span class="count        ">     31</span><span>        let [ptr] = await dbCallAsync(</span></pre>
<pre><span class="lineno"><a href="#line_906" id="line_906">  906.</a></span><span class="count        ">     31</span><span>            jsbatonCreate("_dbOpen"),</span></pre>
<pre><span class="lineno"><a href="#line_907" id="line_907">  907.</a></span><span class="count        ">     31</span><span>            [</span></pre>
<pre><span class="lineno"><a href="#line_908" id="line_908">  908.</a></span><span class="count        ">     31</span><span>                // 0. const char *filename,   Database filename (UTF-8)</span></pre>
<pre><span class="lineno"><a href="#line_909" id="line_909">  909.</a></span><span class="count        ">     31</span><span>                filename,</span></pre>
<pre><span class="lineno"><a href="#line_910" id="line_910">  910.</a></span><span class="count        ">     31</span><span>                // 1. sqlite3 **ppDb,         OUT: SQLite db handle</span></pre>
<pre><span class="lineno"><a href="#line_911" id="line_911">  911.</a></span><span class="count        ">     31</span><span>                undefined,</span></pre>
<pre><span class="lineno"><a href="#line_912" id="line_912">  912.</a></span><span class="count        ">     31</span><span>                // 2. int flags,              Flags</span></pre>
<pre><span class="lineno"><a href="#line_913" id="line_913">  913.</a></span><span class="count        ">     31</span><span>                flags ?? (</span></pre>
<pre><span class="lineno"><a href="#line_914" id="line_914">  914.</a></span><span class="count        ">     31</span><span>                    SQLITE_OPEN_CREATE | SQLITE_OPEN_READWRITE | SQLITE_OPEN_URI</span></pre>
<pre><span class="lineno"><a href="#line_915" id="line_915">  915.</a></span><span class="count        ">     31</span><span>                ),</span></pre>
<pre><span class="lineno"><a href="#line_916" id="line_916">  916.</a></span><span class="count        ">     31</span><span>                // 3. const char *zVfs        Name of VFS module to use</span></pre>
<pre><span class="lineno"><a href="#line_917" id="line_917">  917.</a></span><span class="count        ">     31</span><span>                undefined,</span></pre>
<pre><span class="lineno"><a href="#line_918" id="line_918">  918.</a></span><span class="count        ">     31</span><span>                // 4. wasm-only - arraybuffer of raw sqlite-database</span></pre>
<pre><span class="lineno"><a href="#line_919" id="line_919">  919.</a></span><span class="count        ">     31</span><span>                dbData</span></pre>
<pre><span class="lineno"><a href="#line_920" id="line_920">  920.</a></span><span class="count        ">     31</span><span>            ]</span></pre>
<pre><span class="lineno"><a href="#line_921" id="line_921">  921.</a></span><span class="count        ">     31</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_922" id="line_922">  922.</a></span><span class="count        ">     31</span><span>        ptr = [ptr.getBigInt64(JSBATON_OFFSET_ARGV + 0, true)];</span></pre>
<pre><span class="lineno"><a href="#line_923" id="line_923">  923.</a></span><span class="count        ">     31</span><span>        dbFinalizationRegistry.register(db, {afterFinalization, ptr});</span></pre>
<pre><span class="lineno"><a href="#line_924" id="line_924">  924.</a></span><span class="count        ">     31</span><span>        return ptr;</span></pre>
<pre><span class="lineno"><a href="#line_925" id="line_925">  925.</a></span><span class="count        ">     31</span><span>    }));</span></pre>
<pre><span class="lineno"><a href="#line_926" id="line_926">  926.</a></span><span class="count        ">     31</span><span>    db.connPool = connPool;</span></pre>
<pre><span class="lineno"><a href="#line_927" id="line_927">  927.</a></span><span class="count        ">     31</span><span>    // init lightgbm</span></pre>
<pre><span class="lineno"><a href="#line_928" id="line_928">  928.</a></span><span class="count        ">     31</span><span>    if (!IS_BROWSER) {</span></pre>
<pre><span class="lineno"><a href="#line_929" id="line_929">  929.</a></span><span class="count        ">     31</span><span>        fileLgbm = process.platform;</span></pre>
<pre><span class="lineno"><a href="#line_930" id="line_930">  930.</a></span><span class="count        ">     31</span><span>        fileLgbm = fileLgbm.replace("darwin", "lib_lightgbm.dylib");</span></pre>
<pre><span class="lineno"><a href="#line_931" id="line_931">  931.</a></span><span class="count        ">     31</span><span>        fileLgbm = fileLgbm.replace("win32", "lib_lightgbm.dll");</span></pre>
<pre><span class="lineno"><a href="#line_932" id="line_932">  932.</a></span><span class="count        ">     31</span><span>        fileLgbm = fileLgbm.replace(process.platform, "lib_lightgbm.so");</span></pre>
<pre><span class="lineno"><a href="#line_933" id="line_933">  933.</a></span><span class="count        ">     31</span><span>        fileLgbm = `${import.meta.dirname}/sqlmath/${fileLgbm}`;</span></pre>
<pre><span class="lineno"><a href="#line_934" id="line_934">  934.</a></span><span class="count        ">     31</span><span>        await moduleFs.promises.access(fileLgbm).then(async function () {</span></pre>
<pre><span class="lineno"><a href="#line_935" id="line_935">  935.</a></span><span class="count        ">     31</span><span>            await dbExecAsync({</span></pre>
<pre><span class="lineno"><a href="#line_936" id="line_936">  936.</a></span><span class="count        ">     31</span><span>                db,</span></pre>
<pre><span class="lineno"><a href="#line_937" id="line_937">  937.</a></span><span class="count        ">     31</span><span>                sql: `SELECT lgbm_dlopen('${fileLgbm}');`</span></pre>
<pre><span class="lineno"><a href="#line_938" id="line_938">  938.</a></span><span class="count        ">     31</span><span>            });</span></pre>
<pre><span class="lineno"><a href="#line_939" id="line_939">  939.</a></span><span class="count        ">     31</span><span>        }).catch(noop);</span></pre>
<pre><span class="lineno"><a href="#line_940" id="line_940">  940.</a></span><span class="count        ">     31</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_941" id="line_941">  941.</a></span><span class="count        ">     31</span><span>    return db;</span></pre>
<pre><span class="lineno"><a href="#line_942" id="line_942">  942.</a></span><span class="count        ">     31</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_943" id="line_943">  943.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_944" id="line_944">  944.</a></span><span class="count        ">     47</span><span>async function dbTableImportAsync({</span></pre>
<pre><span class="lineno"><a href="#line_945" id="line_945">  945.</a></span><span class="count        ">     47</span><span>    db,</span></pre>
<pre><span class="lineno"><a href="#line_946" id="line_946">  946.</a></span><span class="count        ">     47</span><span>    filename,</span></pre>
<pre><span class="lineno"><a href="#line_947" id="line_947">  947.</a></span><span class="count        ">     47</span><span>    headerMissing,</span></pre>
<pre><span class="lineno"><a href="#line_948" id="line_948">  948.</a></span><span class="count        ">     47</span><span>    mode,</span></pre>
<pre><span class="lineno"><a href="#line_949" id="line_949">  949.</a></span><span class="count        ">     47</span><span>    tableName,</span></pre>
<pre><span class="lineno"><a href="#line_950" id="line_950">  950.</a></span><span class="count        ">     47</span><span>    textData</span></pre>
<pre><span class="lineno"><a href="#line_951" id="line_951">  951.</a></span><span class="count        ">     47</span><span>}) {</span></pre>
<pre><span class="lineno"><a href="#line_952" id="line_952">  952.</a></span><span class="count        ">     47</span><span>// this function will create table from imported csv/json &lt;textData&gt;</span></pre>
<pre><span class="lineno"><a href="#line_953" id="line_953">  953.</a></span><span class="count        ">     47</span><span>    let colList;</span></pre>
<pre><span class="lineno"><a href="#line_954" id="line_954">  954.</a></span><span class="count        ">     47</span><span>    let rowList;</span></pre>
<pre><span class="lineno"><a href="#line_955" id="line_955">  955.</a></span><span class="count        ">     47</span><span>    let rowidList;</span></pre>
<pre><span class="lineno"><a href="#line_956" id="line_956">  956.</a></span><span class="count        ">     47</span><span>    let tmp;</span></pre>
<pre><span class="lineno"><a href="#line_957" id="line_957">  957.</a></span><span class="count        ">     42</span><span>    if (filename) {</span></pre>
<pre><span class="lineno"><a href="#line_958" id="line_958">  958.</a></span><span class="count        ">     42</span><span>        textData = await moduleFs.promises.readFile(filename, "utf8");</span></pre>
<pre><span class="lineno"><a href="#line_959" id="line_959">  959.</a></span><span class="count        ">     42</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_960" id="line_960">  960.</a></span><span class="count        ">     47</span><span>    switch (mode) {</span></pre>
<pre><span class="lineno"><a href="#line_961" id="line_961">  961.</a></span><span class="count        ">      2</span><span>    case "csv":</span></pre>
<pre><span class="lineno"><a href="#line_962" id="line_962">  962.</a></span><span class="count        ">      2</span><span>        rowList = jsonRowListFromCsv({</span></pre>
<pre><span class="lineno"><a href="#line_963" id="line_963">  963.</a></span><span class="count        ">      2</span><span>            csv: textData</span></pre>
<pre><span class="lineno"><a href="#line_964" id="line_964">  964.</a></span><span class="count        ">      2</span><span>        });</span></pre>
<pre><span class="lineno"><a href="#line_965" id="line_965">  965.</a></span><span class="count        ">      2</span><span>        break;</span></pre>
<pre><span class="lineno"><a href="#line_966" id="line_966">  966.</a></span><span class="count        ">     43</span><span>    case "tsv":</span></pre>
<pre><span class="lineno"><a href="#line_967" id="line_967">  967.</a></span><span class="count        ">     43</span><span>        rowList = [];</span></pre>
<pre><span class="lineno"><a href="#line_968" id="line_968">  968.</a></span><span class="count        ">  99001</span><span>        textData.trimEnd().replace((/.+/g), function (line) {</span></pre>
<pre><span class="lineno"><a href="#line_969" id="line_969">  969.</a></span><span class="count        ">  99001</span><span>            rowList.push(line.split("\t"));</span></pre>
<pre><span class="lineno"><a href="#line_970" id="line_970">  970.</a></span><span class="count        ">  99001</span><span>        });</span></pre>
<pre><span class="lineno"><a href="#line_971" id="line_971">  971.</a></span><span class="count        ">     43</span><span>        break;</span></pre>
<pre><span class="lineno"><a href="#line_972" id="line_972">  972.</a></span><span class="count        ">     47</span><span>    // case "json":</span></pre>
<pre><span class="lineno"><a href="#line_973" id="line_973">  973.</a></span><span class="count        ">      2</span><span>    default:</span></pre>
<pre><span class="lineno"><a href="#line_974" id="line_974">  974.</a></span><span class="count        ">      2</span><span>        rowList = JSON.parse(textData);</span></pre>
<pre><span class="lineno"><a href="#line_975" id="line_975">  975.</a></span><span class="count        ">     47</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_976" id="line_976">  976.</a></span><span class="count        ">      1</span><span>    if (!(typeof rowList === "object" &amp;&amp; rowList)) {</span></pre>
<pre><span class="lineno"><a href="#line_977" id="line_977">  977.</a></span><span class="count        ">      1</span><span>        rowList = [];</span></pre>
<pre><span class="lineno"><a href="#line_978" id="line_978">  978.</a></span><span class="count        ">      1</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_979" id="line_979">  979.</a></span><span class="count        ">     47</span><span>    // normalize rowList to list</span></pre>
<pre><span class="lineno"><a href="#line_980" id="line_980">  980.</a></span><span class="count        ">      1</span><span>    if (!Array.isArray(rowList)) {</span></pre>
<pre><span class="lineno"><a href="#line_981" id="line_981">  981.</a></span><span class="count        ">      1</span><span>        rowidList = [];</span></pre>
<pre><span class="lineno"><a href="#line_982" id="line_982">  982.</a></span><span class="count        ">      2</span><span>        rowList = Object.entries(rowList).map(function ([</span></pre>
<pre><span class="lineno"><a href="#line_983" id="line_983">  983.</a></span><span class="count        ">      2</span><span>            key, val</span></pre>
<pre><span class="lineno"><a href="#line_984" id="line_984">  984.</a></span><span class="count        ">      2</span><span>        ]) {</span></pre>
<pre><span class="lineno"><a href="#line_985" id="line_985">  985.</a></span><span class="count        ">      2</span><span>            rowidList.push(key);</span></pre>
<pre><span class="lineno"><a href="#line_986" id="line_986">  986.</a></span><span class="count        ">      2</span><span>            return val;</span></pre>
<pre><span class="lineno"><a href="#line_987" id="line_987">  987.</a></span><span class="count        ">      2</span><span>        });</span></pre>
<pre><span class="lineno"><a href="#line_988" id="line_988">  988.</a></span><span class="count        ">      1</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_989" id="line_989">  989.</a></span><span class="count        ">     47</span><span>    // headerMissing</span></pre>
<pre><span class="lineno"><a href="#line_990" id="line_990">  990.</a></span><span class="count        ">     42</span><span>    if (headerMissing &amp;&amp; (rowList.length &gt; 0 &amp;&amp; Array.isArray(rowList[0]))) {</span></pre>
<pre><span class="lineno"><a href="#line_991" id="line_991">  991.</a></span><span class="count        ">    714</span><span>        rowList.unshift(Array.from(rowList[0]).map(function (ignore, ii) {</span></pre>
<pre><span class="lineno"><a href="#line_992" id="line_992">  992.</a></span><span class="count        ">    714</span><span>            return String(ii + 1);</span></pre>
<pre><span class="lineno"><a href="#line_993" id="line_993">  993.</a></span><span class="count        ">    714</span><span>        }));</span></pre>
<pre><span class="lineno"><a href="#line_994" id="line_994">  994.</a></span><span class="count        ">     42</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_995" id="line_995">  995.</a></span><span class="count        ">     47</span><span>    // normalize rowList[ii] to list</span></pre>
<pre><span class="lineno"><a href="#line_996" id="line_996">  996.</a></span><span class="count        ">      1</span><span>    if (rowList.length === 0) {</span></pre>
<pre><span class="lineno"><a href="#line_997" id="line_997">  997.</a></span><span class="count        ">      1</span><span>        rowList.push([</span></pre>
<pre><span class="lineno"><a href="#line_998" id="line_998">  998.</a></span><span class="count        ">      1</span><span>            "undefined"</span></pre>
<pre><span class="lineno"><a href="#line_999" id="line_999">  999.</a></span><span class="count        ">      1</span><span>        ]);</span></pre>
<pre><span class="lineno"><a href="#line_1000" id="line_1000"> 1000.</a></span><span class="count        ">      1</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1001" id="line_1001"> 1001.</a></span><span class="count        ">      1</span><span>    if (!Array.isArray(rowList[0])) {</span></pre>
<pre><span class="lineno"><a href="#line_1002" id="line_1002"> 1002.</a></span><span class="count        ">      1</span><span>        colList = Array.from(</span></pre>
<pre><span class="lineno"><a href="#line_1003" id="line_1003"> 1003.</a></span><span class="count        ">      1</span><span>            new Set(</span></pre>
<pre><span class="lineno"><a href="#line_1004" id="line_1004"> 1004.</a></span><span class="count        ">      2</span><span>                rowList.map(function (obj) {</span></pre>
<pre><span class="lineno"><a href="#line_1005" id="line_1005"> 1005.</a></span><span class="count        ">      2</span><span>                    return Object.keys(obj);</span></pre>
<pre><span class="lineno"><a href="#line_1006" id="line_1006"> 1006.</a></span><span class="count        ">      2</span><span>                }).flat()</span></pre>
<pre><span class="lineno"><a href="#line_1007" id="line_1007"> 1007.</a></span><span class="count        ">      1</span><span>            )</span></pre>
<pre><span class="lineno"><a href="#line_1008" id="line_1008"> 1008.</a></span><span class="count        ">      1</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_1009" id="line_1009"> 1009.</a></span><span class="count        ">      2</span><span>        rowList = rowList.map(function (obj) {</span></pre>
<pre><span class="lineno"><a href="#line_1010" id="line_1010"> 1010.</a></span><span class="count        ">      4</span><span>            return colList.map(function (key) {</span></pre>
<pre><span class="lineno"><a href="#line_1011" id="line_1011"> 1011.</a></span><span class="count        ">      4</span><span>                return obj[key];</span></pre>
<pre><span class="lineno"><a href="#line_1012" id="line_1012"> 1012.</a></span><span class="count        ">      4</span><span>            });</span></pre>
<pre><span class="lineno"><a href="#line_1013" id="line_1013"> 1013.</a></span><span class="count        ">      2</span><span>        });</span></pre>
<pre><span class="lineno"><a href="#line_1014" id="line_1014"> 1014.</a></span><span class="count        ">      1</span><span>        rowList.unshift(colList);</span></pre>
<pre><span class="lineno"><a href="#line_1015" id="line_1015"> 1015.</a></span><span class="count        ">      1</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1016" id="line_1016"> 1016.</a></span><span class="count        ">     47</span><span>    // init colList</span></pre>
<pre><span class="lineno"><a href="#line_1017" id="line_1017"> 1017.</a></span><span class="count        ">     47</span><span>    colList = rowList.shift();</span></pre>
<pre><span class="lineno"><a href="#line_1018" id="line_1018"> 1018.</a></span><span class="count        ">     47</span><span>    // preserve rowid</span></pre>
<pre><span class="lineno"><a href="#line_1019" id="line_1019"> 1019.</a></span><span class="count        ">      1</span><span>    if (rowidList) {</span></pre>
<pre><span class="lineno"><a href="#line_1020" id="line_1020"> 1020.</a></span><span class="count        ">      1</span><span>        colList.unshift("rowid");</span></pre>
<pre><span class="lineno"><a href="#line_1021" id="line_1021"> 1021.</a></span><span class="count        ">      2</span><span>        rowList.forEach(function (row, ii) {</span></pre>
<pre><span class="lineno"><a href="#line_1022" id="line_1022"> 1022.</a></span><span class="count        ">      2</span><span>            row.unshift(rowidList[ii]);</span></pre>
<pre><span class="lineno"><a href="#line_1023" id="line_1023"> 1023.</a></span><span class="count        ">      2</span><span>        });</span></pre>
<pre><span class="lineno"><a href="#line_1024" id="line_1024"> 1024.</a></span><span class="count        ">      1</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1025" id="line_1025"> 1025.</a></span><span class="count        ">     47</span><span>    // normalize colList</span></pre>
<pre><span class="lineno"><a href="#line_1026" id="line_1026"> 1026.</a></span><span class="count        ">     47</span><span>    tmp = new Set();</span></pre>
<pre><span class="lineno"><a href="#line_1027" id="line_1027"> 1027.</a></span><span class="count        ">    723</span><span>    colList = colList.map(function (colName) {</span></pre>
<pre><span class="lineno"><a href="#line_1028" id="line_1028"> 1028.</a></span><span class="count        ">    723</span><span>        let colName2;</span></pre>
<pre><span class="lineno"><a href="#line_1029" id="line_1029"> 1029.</a></span><span class="count        ">    723</span><span>        let duplicate = 0;</span></pre>
<pre><span class="lineno"><a href="#line_1030" id="line_1030"> 1030.</a></span><span class="count        ">    723</span><span>        colName = colName.trim();</span></pre>
<pre><span class="lineno"><a href="#line_1031" id="line_1031"> 1031.</a></span><span class="count        ">    723</span><span>        colName = colName.replace((/\W/g), "_");</span></pre>
<pre><span class="lineno"><a href="#line_1032" id="line_1032"> 1032.</a></span><span class="count        ">    723</span><span>        colName = colName.replace((/^[^A-Z_a-z]|^$/gm), "_$&amp;");</span></pre>
<pre><span class="lineno"><a href="#line_1033" id="line_1033"> 1033.</a></span><span class="count        ">    724</span><span>        while (true) {</span></pre>
<pre><span class="lineno"><a href="#line_1034" id="line_1034"> 1034.</a></span><span class="count        ">    724</span><span>            duplicate += 1;</span></pre>
<pre><span class="lineno"><a href="#line_1035" id="line_1035"> 1035.</a></span><span class="count        ">    724</span><span>            colName2 = (</span></pre>
<pre><span class="lineno"><a href="#line_1036" id="line_1036"> 1036.</a></span><span class="count        ">    724</span><span>                duplicate === 1</span></pre>
<pre><span class="lineno"><a href="#line_1037" id="line_1037"> 1037.</a></span><span class="count        ">    724</span><span>                ? colName</span></pre>
<pre><span class="lineno"><a href="#line_1038" id="line_1038"> 1038.</a></span><span class="count        ">    724</span><span>                : colName + "_" + duplicate</span></pre>
<pre><span class="lineno"><a href="#line_1039" id="line_1039"> 1039.</a></span><span class="count        ">    724</span><span>            );</span></pre>
<pre><span class="lineno"><a href="#line_1040" id="line_1040"> 1040.</a></span><span class="count        ">    724</span><span>            if (!tmp.has(colName2)) {</span></pre>
<pre><span class="lineno"><a href="#line_1041" id="line_1041"> 1041.</a></span><span class="count        ">    724</span><span>                tmp.add(colName2);</span></pre>
<pre><span class="lineno"><a href="#line_1042" id="line_1042"> 1042.</a></span><span class="count        ">    724</span><span>                return colName2;</span></pre>
<pre><span class="lineno"><a href="#line_1043" id="line_1043"> 1043.</a></span><span class="count        ">    724</span><span>            }</span></pre>
<pre><span class="lineno"><a href="#line_1044" id="line_1044"> 1044.</a></span><span class="count        ">    724</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_1045" id="line_1045"> 1045.</a></span><span class="count        ">    723</span><span>    });</span></pre>
<pre><span class="lineno"><a href="#line_1046" id="line_1046"> 1046.</a></span><span class="count        ">     47</span><span>    // create dbtable from rowList</span></pre>
<pre><span class="lineno"><a href="#line_1047" id="line_1047"> 1047.</a></span><span class="count        ">     47</span><span>    await dbExecAsync({</span></pre>
<pre><span class="lineno"><a href="#line_1048" id="line_1048"> 1048.</a></span><span class="count        ">     47</span><span>        bindList: {</span></pre>
<pre><span class="lineno"><a href="#line_1049" id="line_1049"> 1049.</a></span><span class="count        ">     47</span><span>            rowList: JSON.stringify(rowList)</span></pre>
<pre><span class="lineno"><a href="#line_1050" id="line_1050"> 1050.</a></span><span class="count        ">     47</span><span>        },</span></pre>
<pre><span class="lineno"><a href="#line_1051" id="line_1051"> 1051.</a></span><span class="count        ">     47</span><span>        db,</span></pre>
<pre><span class="lineno"><a href="#line_1052" id="line_1052"> 1052.</a></span><span class="count        ">     47</span><span>        sql: (</span></pre>
<pre><span class="lineno"><a href="#line_1053" id="line_1053"> 1053.</a></span><span class="count        ">     47</span><span>            rowList.length === 0</span></pre>
<pre><span class="lineno"><a href="#line_1054" id="line_1054"> 1054.</a></span><span class="count        ">      3</span><span>            ? `CREATE TABLE ${tableName} (${colList.join(",")});`</span></pre>
<pre><span class="lineno"><a href="#line_1055" id="line_1055"> 1055.</a></span><span class="count        ">     44</span><span>            : (</span></pre>
<pre><span class="lineno"><a href="#line_1056" id="line_1056"> 1056.</a></span><span class="count        ">     44</span><span>                `CREATE TABLE ${tableName} AS SELECT `</span></pre>
<pre><span class="lineno"><a href="#line_1057" id="line_1057"> 1057.</a></span><span class="count        ">    719</span><span>                + colList.map(function (colName, ii) {</span></pre>
<pre><span class="lineno"><a href="#line_1058" id="line_1058"> 1058.</a></span><span class="count        ">    719</span><span>                    return "value-&gt;&gt;" + ii + " AS " + colName;</span></pre>
<pre><span class="lineno"><a href="#line_1059" id="line_1059"> 1059.</a></span><span class="count        ">    719</span><span>                }).join(",")</span></pre>
<pre><span class="lineno"><a href="#line_1060" id="line_1060"> 1060.</a></span><span class="count        ">     44</span><span>                + " FROM JSON_EACH($rowList);"</span></pre>
<pre><span class="lineno"><a href="#line_1061" id="line_1061"> 1061.</a></span><span class="count        ">     44</span><span>            )</span></pre>
<pre><span class="lineno"><a href="#line_1062" id="line_1062"> 1062.</a></span><span class="count        ">     47</span><span>        )</span></pre>
<pre><span class="lineno"><a href="#line_1063" id="line_1063"> 1063.</a></span><span class="count        ">     47</span><span>    });</span></pre>
<pre><span class="lineno"><a href="#line_1064" id="line_1064"> 1064.</a></span><span class="count        ">     47</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1065" id="line_1065"> 1065.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1066" id="line_1066"> 1066.</a></span><span class="count        ">      2</span><span>async function fsCopyFileUnlessTest(file1, file2, mode) {</span></pre>
<pre><span class="lineno"><a href="#line_1067" id="line_1067"> 1067.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1068" id="line_1068"> 1068.</a></span><span class="count        ">      2</span><span>// This function will copy &lt;file1&gt; to &lt;file2&gt; unless &lt;npm_config_mode_test&gt; = 1.</span></pre>
<pre><span class="lineno"><a href="#line_1069" id="line_1069"> 1069.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1070" id="line_1070"> 1070.</a></span><span class="count        ">      1</span><span>    if (npm_config_mode_test &amp;&amp; mode !== "force") {</span></pre>
<pre><span class="lineno"><a href="#line_1071" id="line_1071"> 1071.</a></span><span class="count        ">      1</span><span>        return;</span></pre>
<pre><span class="lineno"><a href="#line_1072" id="line_1072"> 1072.</a></span><span class="count        ">      1</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1073" id="line_1073"> 1073.</a></span><span class="count        ">      1</span><span>    await moduleFs.promises.copyFile(file1, file2, mode | 0);</span></pre>
<pre><span class="lineno"><a href="#line_1074" id="line_1074"> 1074.</a></span><span class="count        ">      1</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1075" id="line_1075"> 1075.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1076" id="line_1076"> 1076.</a></span><span class="count        ">     10</span><span>async function fsExistsUnlessTest(file, mode) {</span></pre>
<pre><span class="lineno"><a href="#line_1077" id="line_1077"> 1077.</a></span><span class="count        ">     10</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1078" id="line_1078"> 1078.</a></span><span class="count        ">     10</span><span>// This function will test if &lt;file&gt; exists unless &lt;npm_config_mode_test&gt; = 1.</span></pre>
<pre><span class="lineno"><a href="#line_1079" id="line_1079"> 1079.</a></span><span class="count        ">     10</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1080" id="line_1080"> 1080.</a></span><span class="count        ">      8</span><span>    if (npm_config_mode_test &amp;&amp; mode !== "force") {</span></pre>
<pre><span class="lineno"><a href="#line_1081" id="line_1081"> 1081.</a></span><span class="count        ">      8</span><span>        return false;</span></pre>
<pre><span class="lineno"><a href="#line_1082" id="line_1082"> 1082.</a></span><span class="count        ">      8</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1083" id="line_1083"> 1083.</a></span><span class="count        ">      2</span><span>    try {</span></pre>
<pre><span class="lineno"><a href="#line_1084" id="line_1084"> 1084.</a></span><span class="count        ">      2</span><span>        await moduleFs.promises.access(file);</span></pre>
<pre><span class="lineno"><a href="#line_1085" id="line_1085"> 1085.</a></span><span class="count        ">      1</span><span>        return true;</span></pre>
<pre><span class="lineno"><a href="#line_1086" id="line_1086"> 1086.</a></span><span class="count        ">      1</span><span>    } catch (ignore) {</span></pre>
<pre><span class="lineno"><a href="#line_1087" id="line_1087"> 1087.</a></span><span class="count        ">      1</span><span>        return false;</span></pre>
<pre><span class="lineno"><a href="#line_1088" id="line_1088"> 1088.</a></span><span class="count        ">      1</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1089" id="line_1089"> 1089.</a></span><span class="count        ">     10</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1090" id="line_1090"> 1090.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1091" id="line_1091"> 1091.</a></span><span class="count        ">     15</span><span>async function fsReadFileUnlessTest(file, mode, defaultData) {</span></pre>
<pre><span class="lineno"><a href="#line_1092" id="line_1092"> 1092.</a></span><span class="count        ">     15</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1093" id="line_1093"> 1093.</a></span><span class="count        ">     15</span><span>// This function will read &lt;data&gt; from &lt;file&gt; unless &lt;npm_config_mode_test&gt; = 1.</span></pre>
<pre><span class="lineno"><a href="#line_1094" id="line_1094"> 1094.</a></span><span class="count        ">     15</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1095" id="line_1095"> 1095.</a></span><span class="count        ">      1</span><span>    if (npm_config_mode_test &amp;&amp; mode !== "force") {</span></pre>
<pre><span class="lineno"><a href="#line_1096" id="line_1096"> 1096.</a></span><span class="count        ">      1</span><span>        return defaultData;</span></pre>
<pre><span class="lineno"><a href="#line_1097" id="line_1097"> 1097.</a></span><span class="count        ">     14</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1098" id="line_1098"> 1098.</a></span><span class="count        ">     14</span><span>    return await moduleFs.promises.readFile(</span></pre>
<pre><span class="lineno"><a href="#line_1099" id="line_1099"> 1099.</a></span><span class="count        ">     14</span><span>        file,</span></pre>
<pre><span class="lineno"><a href="#line_1100" id="line_1100"> 1100.</a></span><span class="count        ">     14</span><span>        mode &amp;&amp; mode.replace("force", "utf8")</span></pre>
<pre><span class="lineno"><a href="#line_1101" id="line_1101"> 1101.</a></span><span class="count        ">     15</span><span>    );</span></pre>
<pre><span class="lineno"><a href="#line_1102" id="line_1102"> 1102.</a></span><span class="count        ">     15</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1103" id="line_1103"> 1103.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1104" id="line_1104"> 1104.</a></span><span class="count        ">     10</span><span>async function fsWriteFileUnlessTest(file, data, mode) {</span></pre>
<pre><span class="lineno"><a href="#line_1105" id="line_1105"> 1105.</a></span><span class="count        ">     10</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1106" id="line_1106"> 1106.</a></span><span class="count        ">     10</span><span>// This function will write &lt;data&gt; to &lt;file&gt; unless &lt;npm_config_mode_test&gt; = 1.</span></pre>
<pre><span class="lineno"><a href="#line_1107" id="line_1107"> 1107.</a></span><span class="count        ">     10</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1108" id="line_1108"> 1108.</a></span><span class="count        ">      9</span><span>    if (npm_config_mode_test &amp;&amp; mode !== "force") {</span></pre>
<pre><span class="lineno"><a href="#line_1109" id="line_1109"> 1109.</a></span><span class="count        ">      9</span><span>        return;</span></pre>
<pre><span class="lineno"><a href="#line_1110" id="line_1110"> 1110.</a></span><span class="count        ">      9</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1111" id="line_1111"> 1111.</a></span><span class="count        ">      1</span><span>    await moduleFs.promises.writeFile(file, data);</span></pre>
<pre><span class="lineno"><a href="#line_1112" id="line_1112"> 1112.</a></span><span class="count        ">      1</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1113" id="line_1113"> 1113.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1114" id="line_1114"> 1114.</a></span><span class="count        ">     31</span><span>function isExternalBuffer(buf) {</span></pre>
<pre><span class="lineno"><a href="#line_1115" id="line_1115"> 1115.</a></span><span class="count        ">     31</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1116" id="line_1116"> 1116.</a></span><span class="count        ">     31</span><span>// This function will check if &lt;buf&gt; is ArrayBuffer.</span></pre>
<pre><span class="lineno"><a href="#line_1117" id="line_1117"> 1117.</a></span><span class="count        ">     31</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1118" id="line_1118"> 1118.</a></span><span class="count        ">     17</span><span>    return buf &amp;&amp; buf.constructor === ArrayBuffer;</span></pre>
<pre><span class="lineno"><a href="#line_1119" id="line_1119"> 1119.</a></span><span class="count        ">     31</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1120" id="line_1120"> 1120.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1121" id="line_1121"> 1121.</a></span><span class="count        ">   2060</span><span>function jsbatonCreate(funcname) {</span></pre>
<pre><span class="lineno"><a href="#line_1122" id="line_1122"> 1122.</a></span><span class="count        ">   2060</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1123" id="line_1123"> 1123.</a></span><span class="count        ">   2060</span><span>// This function will create buffer &lt;baton&gt;.</span></pre>
<pre><span class="lineno"><a href="#line_1124" id="line_1124"> 1124.</a></span><span class="count        ">   2060</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1125" id="line_1125"> 1125.</a></span><span class="count        ">   2060</span><span>    let baton = new DataView(new ArrayBuffer(JSBATON_OFFSET_ALL));</span></pre>
<pre><span class="lineno"><a href="#line_1126" id="line_1126"> 1126.</a></span><span class="count        ">   2060</span><span>    // init nallc, nused</span></pre>
<pre><span class="lineno"><a href="#line_1127" id="line_1127"> 1127.</a></span><span class="count        ">   2060</span><span>    baton.setInt32(4, JSBATON_OFFSET_ALL, true);</span></pre>
<pre><span class="lineno"><a href="#line_1128" id="line_1128"> 1128.</a></span><span class="count        ">   2060</span><span>    // copy funcname into baton</span></pre>
<pre><span class="lineno"><a href="#line_1129" id="line_1129"> 1129.</a></span><span class="count        ">   2060</span><span>    new Uint8Array(</span></pre>
<pre><span class="lineno"><a href="#line_1130" id="line_1130"> 1130.</a></span><span class="count        ">   2060</span><span>        baton.buffer,</span></pre>
<pre><span class="lineno"><a href="#line_1131" id="line_1131"> 1131.</a></span><span class="count        ">   2060</span><span>        baton.byteOffset + JSBATON_OFFSET_FUNCNAME,</span></pre>
<pre><span class="lineno"><a href="#line_1132" id="line_1132"> 1132.</a></span><span class="count        ">   2060</span><span>        SIZEOF_FUNCNAME - 1</span></pre>
<pre><span class="lineno"><a href="#line_1133" id="line_1133"> 1133.</a></span><span class="count        ">   2060</span><span>    ).set(new TextEncoder().encode(funcname));</span></pre>
<pre><span class="lineno"><a href="#line_1134" id="line_1134"> 1134.</a></span><span class="count        ">   2060</span><span>    return baton;</span></pre>
<pre><span class="lineno"><a href="#line_1135" id="line_1135"> 1135.</a></span><span class="count        ">   2060</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1136" id="line_1136"> 1136.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1137" id="line_1137"> 1137.</a></span><span class="count        ">     24</span><span>function jsbatonGetInt64(baton, argi) {</span></pre>
<pre><span class="lineno"><a href="#line_1138" id="line_1138"> 1138.</a></span><span class="count        ">     24</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1139" id="line_1139"> 1139.</a></span><span class="count        ">     24</span><span>// This function will return int64-value from &lt;baton&gt; at &lt;argi&gt;.</span></pre>
<pre><span class="lineno"><a href="#line_1140" id="line_1140"> 1140.</a></span><span class="count        ">     24</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1141" id="line_1141"> 1141.</a></span><span class="count        ">     24</span><span>    return baton.getBigInt64(JSBATON_OFFSET_ARGV + argi * 8, true);</span></pre>
<pre><span class="lineno"><a href="#line_1142" id="line_1142"> 1142.</a></span><span class="count        ">     24</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1143" id="line_1143"> 1143.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1144" id="line_1144"> 1144.</a></span><span class="count        ">      9</span><span>function jsbatonGetString(baton, argi) {</span></pre>
<pre><span class="lineno"><a href="#line_1145" id="line_1145"> 1145.</a></span><span class="count        ">      9</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1146" id="line_1146"> 1146.</a></span><span class="count        ">      9</span><span>// This function will return string-value from &lt;baton&gt; at &lt;argi&gt;.</span></pre>
<pre><span class="lineno"><a href="#line_1147" id="line_1147"> 1147.</a></span><span class="count        ">      9</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1148" id="line_1148"> 1148.</a></span><span class="count        ">      9</span><span>    let offset = baton.getInt32(JSBATON_OFFSET_ARGV + argi * 8, true);</span></pre>
<pre><span class="lineno"><a href="#line_1149" id="line_1149"> 1149.</a></span><span class="count        ">      9</span><span>    return new TextDecoder().decode(new Uint8Array(</span></pre>
<pre><span class="lineno"><a href="#line_1150" id="line_1150"> 1150.</a></span><span class="count        ">      9</span><span>        baton.buffer,</span></pre>
<pre><span class="lineno"><a href="#line_1151" id="line_1151"> 1151.</a></span><span class="count        ">      9</span><span>        baton.byteOffset + offset + 1 + 4,</span></pre>
<pre><span class="lineno"><a href="#line_1152" id="line_1152"> 1152.</a></span><span class="count        ">      9</span><span>        // remove null-terminator from string</span></pre>
<pre><span class="lineno"><a href="#line_1153" id="line_1153"> 1153.</a></span><span class="count        ">      9</span><span>        baton.getInt32(offset + 1, true) - 1</span></pre>
<pre><span class="lineno"><a href="#line_1154" id="line_1154"> 1154.</a></span><span class="count        ">      9</span><span>    ));</span></pre>
<pre><span class="lineno"><a href="#line_1155" id="line_1155"> 1155.</a></span><span class="count        ">      9</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1156" id="line_1156"> 1156.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1157" id="line_1157"> 1157.</a></span><span class="count        ">   5182</span><span>function jsbatonSetValue(baton, argi, val, bufi, referenceList) {</span></pre>
<pre><span class="lineno"><a href="#line_1158" id="line_1158"> 1158.</a></span><span class="count        ">   5182</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1159" id="line_1159"> 1159.</a></span><span class="count        ">   5182</span><span>// This function will set &lt;val&gt; to buffer &lt;baton&gt;.</span></pre>
<pre><span class="lineno"><a href="#line_1160" id="line_1160"> 1160.</a></span><span class="count        ">   5182</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1161" id="line_1161"> 1161.</a></span><span class="count        ">   5182</span><span>    let nn;</span></pre>
<pre><span class="lineno"><a href="#line_1162" id="line_1162"> 1162.</a></span><span class="count        ">   5182</span><span>    let nused;</span></pre>
<pre><span class="lineno"><a href="#line_1163" id="line_1163"> 1163.</a></span><span class="count        ">   5182</span><span>    let tmp;</span></pre>
<pre><span class="lineno"><a href="#line_1164" id="line_1164"> 1164.</a></span><span class="count        ">   5182</span><span>    let vsize;</span></pre>
<pre><span class="lineno"><a href="#line_1165" id="line_1165"> 1165.</a></span><span class="count        ">   5182</span><span>    let vtype;</span></pre>
<pre><span class="lineno"><a href="#line_1166" id="line_1166"> 1166.</a></span><span class="count        ">   5182</span><span>/*</span></pre>
<pre><span class="lineno"><a href="#line_1167" id="line_1167"> 1167.</a></span><span class="count        ">   5182</span><span>#define SQLITE_DATATYPE_BLOB            0x04</span></pre>
<pre><span class="lineno"><a href="#line_1168" id="line_1168"> 1168.</a></span><span class="count        ">   5182</span><span>#define SQLITE_DATATYPE_EXTERNALBUFFER          0x71</span></pre>
<pre><span class="lineno"><a href="#line_1169" id="line_1169"> 1169.</a></span><span class="count        ">   5182</span><span>#define SQLITE_DATATYPE_FLOAT           0x02</span></pre>
<pre><span class="lineno"><a href="#line_1170" id="line_1170"> 1170.</a></span><span class="count        ">   5182</span><span>#define SQLITE_DATATYPE_INTEGER         0x01</span></pre>
<pre><span class="lineno"><a href="#line_1171" id="line_1171"> 1171.</a></span><span class="count        ">   5182</span><span>#define SQLITE_DATATYPE_INTEGER_0       0x00</span></pre>
<pre><span class="lineno"><a href="#line_1172" id="line_1172"> 1172.</a></span><span class="count        ">   5182</span><span>#define SQLITE_DATATYPE_INTEGER_1       0x21</span></pre>
<pre><span class="lineno"><a href="#line_1173" id="line_1173"> 1173.</a></span><span class="count        ">   5182</span><span>#define SQLITE_DATATYPE_NULL            0x05</span></pre>
<pre><span class="lineno"><a href="#line_1174" id="line_1174"> 1174.</a></span><span class="count        ">   5182</span><span>#define SQLITE_DATATYPE_TEXT            0x03</span></pre>
<pre><span class="lineno"><a href="#line_1175" id="line_1175"> 1175.</a></span><span class="count        ">   5182</span><span>#define SQLITE_DATATYPE_TEXT_0          0x13</span></pre>
<pre><span class="lineno"><a href="#line_1176" id="line_1176"> 1176.</a></span><span class="count        ">   5182</span><span>    //  1. 0.bigint</span></pre>
<pre><span class="lineno"><a href="#line_1177" id="line_1177"> 1177.</a></span><span class="count        ">   5182</span><span>    //  2. 0.boolean</span></pre>
<pre><span class="lineno"><a href="#line_1178" id="line_1178"> 1178.</a></span><span class="count        ">   5182</span><span>    //  3. 0.function</span></pre>
<pre><span class="lineno"><a href="#line_1179" id="line_1179"> 1179.</a></span><span class="count        ">   5182</span><span>    //  4. 0.number</span></pre>
<pre><span class="lineno"><a href="#line_1180" id="line_1180"> 1180.</a></span><span class="count        ">   5182</span><span>    //  5. 0.object</span></pre>
<pre><span class="lineno"><a href="#line_1181" id="line_1181"> 1181.</a></span><span class="count        ">   5182</span><span>    //  6. 0.string</span></pre>
<pre><span class="lineno"><a href="#line_1182" id="line_1182"> 1182.</a></span><span class="count        ">   5182</span><span>    //  7. 0.symbol</span></pre>
<pre><span class="lineno"><a href="#line_1183" id="line_1183"> 1183.</a></span><span class="count        ">   5182</span><span>    //  8. 0.undefined</span></pre>
<pre><span class="lineno"><a href="#line_1184" id="line_1184"> 1184.</a></span><span class="count        ">   5182</span><span>    //  9. 1.bigint</span></pre>
<pre><span class="lineno"><a href="#line_1185" id="line_1185"> 1185.</a></span><span class="count        ">   5182</span><span>    // 10. 1.boolean</span></pre>
<pre><span class="lineno"><a href="#line_1186" id="line_1186"> 1186.</a></span><span class="count        ">   5182</span><span>    // 11. 1.function</span></pre>
<pre><span class="lineno"><a href="#line_1187" id="line_1187"> 1187.</a></span><span class="count        ">   5182</span><span>    // 12. 1.number</span></pre>
<pre><span class="lineno"><a href="#line_1188" id="line_1188"> 1188.</a></span><span class="count        ">   5182</span><span>    // 13. 1.object</span></pre>
<pre><span class="lineno"><a href="#line_1189" id="line_1189"> 1189.</a></span><span class="count        ">   5182</span><span>    // 14. 1.string</span></pre>
<pre><span class="lineno"><a href="#line_1190" id="line_1190"> 1190.</a></span><span class="count        ">   5182</span><span>    // 15. 1.symbol</span></pre>
<pre><span class="lineno"><a href="#line_1191" id="line_1191"> 1191.</a></span><span class="count        ">   5182</span><span>    // 16. 1.undefined</span></pre>
<pre><span class="lineno"><a href="#line_1192" id="line_1192"> 1192.</a></span><span class="count        ">   5182</span><span>    // 17. 1.buffer</span></pre>
<pre><span class="lineno"><a href="#line_1193" id="line_1193"> 1193.</a></span><span class="count        ">   5182</span><span>    // 18. 1.externalbuffer</span></pre>
<pre><span class="lineno"><a href="#line_1194" id="line_1194"> 1194.</a></span><span class="count        ">   5182</span><span>*/</span></pre>
<pre><span class="lineno"><a href="#line_1195" id="line_1195"> 1195.</a></span><span class="count        ">   5182</span><span>    // 10. 1.boolean</span></pre>
<pre><span class="lineno"><a href="#line_1196" id="line_1196"> 1196.</a></span><span class="count        ">   5158</span><span>    if (val === 1 || val === 1n) {</span></pre>
<pre><span class="lineno"><a href="#line_1197" id="line_1197"> 1197.</a></span><span class="count        ">     30</span><span>        val = true;</span></pre>
<pre><span class="lineno"><a href="#line_1198" id="line_1198"> 1198.</a></span><span class="count        ">     30</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1199" id="line_1199"> 1199.</a></span><span class="count        ">   5182</span><span>    switch (</span></pre>
<pre><span class="lineno"><a href="#line_1200" id="line_1200"> 1200.</a></span><span class="count        ">   5182</span><span>        val</span></pre>
<pre><span class="lineno"><a href="#line_1201" id="line_1201"> 1201.</a></span><span class="count        ">   4801</span><span>        ? "1." + typeof(val)</span></pre>
<pre><span class="lineno"><a href="#line_1202" id="line_1202"> 1202.</a></span><span class="count        ">    381</span><span>        : "0." + typeof(val)</span></pre>
<pre><span class="lineno"><a href="#line_1203" id="line_1203"> 1203.</a></span><span class="count        ">   5182</span><span>    ) {</span></pre>
<pre><span class="lineno"><a href="#line_1204" id="line_1204"> 1204.</a></span><span class="count        ">   5182</span><span>    //  1. 0.bigint</span></pre>
<pre><span class="lineno"><a href="#line_1205" id="line_1205"> 1205.</a></span><span class="count        ">     24</span><span>    case "0.bigint":</span></pre>
<pre><span class="lineno"><a href="#line_1206" id="line_1206"> 1206.</a></span><span class="count        ">   5182</span><span>    //  2. 0.boolean</span></pre>
<pre><span class="lineno"><a href="#line_1207" id="line_1207"> 1207.</a></span><span class="count        ">     30</span><span>    case "0.boolean":</span></pre>
<pre><span class="lineno"><a href="#line_1208" id="line_1208"> 1208.</a></span><span class="count        ">   5182</span><span>    //  4. 0.number</span></pre>
<pre><span class="lineno"><a href="#line_1209" id="line_1209"> 1209.</a></span><span class="count        ">    250</span><span>    case "0.number":</span></pre>
<pre><span class="lineno"><a href="#line_1210" id="line_1210"> 1210.</a></span><span class="count        ">    250</span><span>        if (Number.isNaN(val)) {</span></pre>
<pre><span class="lineno"><a href="#line_1211" id="line_1211"> 1211.</a></span><span class="count        ">    250</span><span>            vtype = SQLITE_DATATYPE_NULL;</span></pre>
<pre><span class="lineno"><a href="#line_1212" id="line_1212"> 1212.</a></span><span class="count        ">    250</span><span>            vsize = 0;</span></pre>
<pre><span class="lineno"><a href="#line_1213" id="line_1213"> 1213.</a></span><span class="count        ">    250</span><span>            break;</span></pre>
<pre><span class="lineno"><a href="#line_1214" id="line_1214"> 1214.</a></span><span class="count        ">    250</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_1215" id="line_1215"> 1215.</a></span><span class="count        ">    250</span><span>        vtype = SQLITE_DATATYPE_INTEGER_0;</span></pre>
<pre><span class="lineno"><a href="#line_1216" id="line_1216"> 1216.</a></span><span class="count        ">    250</span><span>        vsize = 0;</span></pre>
<pre><span class="lineno"><a href="#line_1217" id="line_1217"> 1217.</a></span><span class="count        ">    250</span><span>        break;</span></pre>
<pre><span class="lineno"><a href="#line_1218" id="line_1218"> 1218.</a></span><span class="count        ">   5182</span><span>    //  3. 0.function</span></pre>
<pre><span class="lineno"><a href="#line_1219" id="line_1219"> 1219.</a></span><span class="count        ">   5182</span><span>    // case "0.function":</span></pre>
<pre><span class="lineno"><a href="#line_1220" id="line_1220"> 1220.</a></span><span class="count        ">   5182</span><span>    //  5. 0.object</span></pre>
<pre><span class="lineno"><a href="#line_1221" id="line_1221"> 1221.</a></span><span class="count        ">     98</span><span>    case "0.object":</span></pre>
<pre><span class="lineno"><a href="#line_1222" id="line_1222"> 1222.</a></span><span class="count        ">   5182</span><span>    //  7. 0.symbol</span></pre>
<pre><span class="lineno"><a href="#line_1223" id="line_1223"> 1223.</a></span><span class="count        ">     98</span><span>    case "0.symbol":</span></pre>
<pre><span class="lineno"><a href="#line_1224" id="line_1224"> 1224.</a></span><span class="count        ">   5182</span><span>    //  8. 0.undefined</span></pre>
<pre><span class="lineno"><a href="#line_1225" id="line_1225"> 1225.</a></span><span class="count        ">    105</span><span>    case "0.undefined":</span></pre>
<pre><span class="lineno"><a href="#line_1226" id="line_1226"> 1226.</a></span><span class="count        ">   5182</span><span>    // 11. 1.function</span></pre>
<pre><span class="lineno"><a href="#line_1227" id="line_1227"> 1227.</a></span><span class="count        ">    119</span><span>    case "1.function":</span></pre>
<pre><span class="lineno"><a href="#line_1228" id="line_1228"> 1228.</a></span><span class="count        ">   5182</span><span>    // 15. 1.symbol</span></pre>
<pre><span class="lineno"><a href="#line_1229" id="line_1229"> 1229.</a></span><span class="count        ">    125</span><span>    case "1.symbol":</span></pre>
<pre><span class="lineno"><a href="#line_1230" id="line_1230"> 1230.</a></span><span class="count        ">    125</span><span>    // 16. 1.undefined</span></pre>
<pre><span class="lineno"><a href="#line_1231" id="line_1231"> 1231.</a></span><span class="count        ">    125</span><span>    // case "1.undefined":</span></pre>
<pre><span class="lineno"><a href="#line_1232" id="line_1232"> 1232.</a></span><span class="count        ">    125</span><span>        vtype = SQLITE_DATATYPE_NULL;</span></pre>
<pre><span class="lineno"><a href="#line_1233" id="line_1233"> 1233.</a></span><span class="count        ">    125</span><span>        vsize = 0;</span></pre>
<pre><span class="lineno"><a href="#line_1234" id="line_1234"> 1234.</a></span><span class="count        ">    125</span><span>        break;</span></pre>
<pre><span class="lineno"><a href="#line_1235" id="line_1235"> 1235.</a></span><span class="count        ">   5182</span><span>    //  6. 0.string</span></pre>
<pre><span class="lineno"><a href="#line_1236" id="line_1236"> 1236.</a></span><span class="count        ">     26</span><span>    case "0.string":</span></pre>
<pre><span class="lineno"><a href="#line_1237" id="line_1237"> 1237.</a></span><span class="count        ">     26</span><span>        vtype = SQLITE_DATATYPE_TEXT_0;</span></pre>
<pre><span class="lineno"><a href="#line_1238" id="line_1238"> 1238.</a></span><span class="count        ">     26</span><span>        vsize = 0;</span></pre>
<pre><span class="lineno"><a href="#line_1239" id="line_1239"> 1239.</a></span><span class="count        ">     26</span><span>        break;</span></pre>
<pre><span class="lineno"><a href="#line_1240" id="line_1240"> 1240.</a></span><span class="count        ">   5182</span><span>    //  9. 1.bigint</span></pre>
<pre><span class="lineno"><a href="#line_1241" id="line_1241"> 1241.</a></span><span class="count        ">     42</span><span>    case "1.bigint":</span></pre>
<pre><span class="lineno"><a href="#line_1242" id="line_1242"> 1242.</a></span><span class="count        ">     42</span><span>        vtype = SQLITE_DATATYPE_INTEGER;</span></pre>
<pre><span class="lineno"><a href="#line_1243" id="line_1243"> 1243.</a></span><span class="count        ">     42</span><span>        vsize = 8;</span></pre>
<pre><span class="lineno"><a href="#line_1244" id="line_1244"> 1244.</a></span><span class="count        ">     42</span><span>        break;</span></pre>
<pre><span class="lineno"><a href="#line_1245" id="line_1245"> 1245.</a></span><span class="count        ">   5182</span><span>    // 10. 1.boolean</span></pre>
<pre><span class="lineno"><a href="#line_1246" id="line_1246"> 1246.</a></span><span class="count        ">     36</span><span>    case "1.boolean":</span></pre>
<pre><span class="lineno"><a href="#line_1247" id="line_1247"> 1247.</a></span><span class="count        ">     36</span><span>        vtype = SQLITE_DATATYPE_INTEGER_1;</span></pre>
<pre><span class="lineno"><a href="#line_1248" id="line_1248"> 1248.</a></span><span class="count        ">     36</span><span>        vsize = 0;</span></pre>
<pre><span class="lineno"><a href="#line_1249" id="line_1249"> 1249.</a></span><span class="count        ">     36</span><span>        break;</span></pre>
<pre><span class="lineno"><a href="#line_1250" id="line_1250"> 1250.</a></span><span class="count        ">   5182</span><span>    // 12. 1.number</span></pre>
<pre><span class="lineno"><a href="#line_1251" id="line_1251"> 1251.</a></span><span class="count        ">    561</span><span>    case "1.number":</span></pre>
<pre><span class="lineno"><a href="#line_1252" id="line_1252"> 1252.</a></span><span class="count        ">    561</span><span>        vtype = SQLITE_DATATYPE_FLOAT;</span></pre>
<pre><span class="lineno"><a href="#line_1253" id="line_1253"> 1253.</a></span><span class="count        ">    561</span><span>        vsize = 8;</span></pre>
<pre><span class="lineno"><a href="#line_1254" id="line_1254"> 1254.</a></span><span class="count        ">    561</span><span>        break;</span></pre>
<pre><span class="lineno"><a href="#line_1255" id="line_1255"> 1255.</a></span><span class="count        ">   5182</span><span>    // 14. 1.string</span></pre>
<pre><span class="lineno"><a href="#line_1256" id="line_1256"> 1256.</a></span><span class="count        ">   4060</span><span>    case "1.string":</span></pre>
<pre><span class="lineno"><a href="#line_1257" id="line_1257"> 1257.</a></span><span class="count        ">   4060</span><span>        val = new TextEncoder().encode(val);</span></pre>
<pre><span class="lineno"><a href="#line_1258" id="line_1258"> 1258.</a></span><span class="count        ">   4060</span><span>        vtype = SQLITE_DATATYPE_TEXT;</span></pre>
<pre><span class="lineno"><a href="#line_1259" id="line_1259"> 1259.</a></span><span class="count        ">   4060</span><span>        vsize = 4 + val.byteLength;</span></pre>
<pre><span class="lineno"><a href="#line_1260" id="line_1260"> 1260.</a></span><span class="count        ">   4060</span><span>        break;</span></pre>
<pre><span class="lineno"><a href="#line_1261" id="line_1261"> 1261.</a></span><span class="count        ">   5182</span><span>    // 13. 1.object</span></pre>
<pre><span class="lineno"><a href="#line_1262" id="line_1262"> 1262.</a></span><span class="count        ">     82</span><span>    default:</span></pre>
<pre><span class="lineno"><a href="#line_1263" id="line_1263"> 1263.</a></span><span class="count        ">     82</span><span>        // 18. 1.externalbuffer</span></pre>
<pre><span class="lineno"><a href="#line_1264" id="line_1264"> 1264.</a></span><span class="count        ">     82</span><span>        if (val.constructor === ArrayBuffer) {</span></pre>
<pre><span class="lineno"><a href="#line_1265" id="line_1265"> 1265.</a></span><span class="count        ">     82</span><span>            assertOrThrow(</span></pre>
<pre><span class="lineno"><a href="#line_1266" id="line_1266"> 1266.</a></span><span class="count        ">     82</span><span>                !IS_BROWSER,</span></pre>
<pre><span class="lineno"><a href="#line_1267" id="line_1267"> 1267.</a></span><span class="count        ">     82</span><span>                "external ArrayBuffer cannot be passed directly to wasm"</span></pre>
<pre><span class="lineno"><a href="#line_1268" id="line_1268"> 1268.</a></span><span class="count        ">     82</span><span>            );</span></pre>
<pre><span class="lineno"><a href="#line_1269" id="line_1269"> 1269.</a></span><span class="count        ">     82</span><span>            vtype = SQLITE_DATATYPE_EXTERNALBUFFER;</span></pre>
<pre><span class="lineno"><a href="#line_1270" id="line_1270"> 1270.</a></span><span class="count        ">     82</span><span>            vsize = 4;</span></pre>
<pre><span class="lineno"><a href="#line_1271" id="line_1271"> 1271.</a></span><span class="count        ">     82</span><span>            break;</span></pre>
<pre><span class="lineno"><a href="#line_1272" id="line_1272"> 1272.</a></span><span class="count        ">     82</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_1273" id="line_1273"> 1273.</a></span><span class="count        ">     82</span><span>        // 17. 1.buffer</span></pre>
<pre><span class="lineno"><a href="#line_1274" id="line_1274"> 1274.</a></span><span class="count        ">     82</span><span>        if (ArrayBuffer.isView(val)) {</span></pre>
<pre><span class="lineno"><a href="#line_1275" id="line_1275"> 1275.</a></span><span class="count        ">     82</span><span>            if (val.byteLength === 0) {</span></pre>
<pre><span class="lineno"><a href="#line_1276" id="line_1276"> 1276.</a></span><span class="count        ">     82</span><span>                vtype = SQLITE_DATATYPE_NULL;</span></pre>
<pre><span class="lineno"><a href="#line_1277" id="line_1277"> 1277.</a></span><span class="count        ">     82</span><span>                vsize = 0;</span></pre>
<pre><span class="lineno"><a href="#line_1278" id="line_1278"> 1278.</a></span><span class="count        ">     82</span><span>                break;</span></pre>
<pre><span class="lineno"><a href="#line_1279" id="line_1279"> 1279.</a></span><span class="count        ">     82</span><span>            }</span></pre>
<pre><span class="lineno"><a href="#line_1280" id="line_1280"> 1280.</a></span><span class="count        ">     82</span><span>            vtype = SQLITE_DATATYPE_BLOB;</span></pre>
<pre><span class="lineno"><a href="#line_1281" id="line_1281"> 1281.</a></span><span class="count        ">     82</span><span>            vsize = 4 + val.byteLength;</span></pre>
<pre><span class="lineno"><a href="#line_1282" id="line_1282"> 1282.</a></span><span class="count        ">     82</span><span>            break;</span></pre>
<pre><span class="lineno"><a href="#line_1283" id="line_1283"> 1283.</a></span><span class="count        ">     82</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_1284" id="line_1284"> 1284.</a></span><span class="count        ">     82</span><span>        // 13. 1.object</span></pre>
<pre><span class="lineno"><a href="#line_1285" id="line_1285"> 1285.</a></span><span class="count        ">     82</span><span>        val = new TextEncoder().encode(</span></pre>
<pre><span class="lineno"><a href="#line_1286" id="line_1286"> 1286.</a></span><span class="count        ">     82</span><span>            typeof val.toJSON === "function"</span></pre>
<pre><span class="lineno"><a href="#line_1287" id="line_1287"> 1287.</a></span><span class="count        ">     82</span><span>            ? val.toJSON()</span></pre>
<pre><span class="lineno"><a href="#line_1288" id="line_1288"> 1288.</a></span><span class="count        ">     82</span><span>            : JSON.stringify(val)</span></pre>
<pre><span class="lineno"><a href="#line_1289" id="line_1289"> 1289.</a></span><span class="count        ">     82</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_1290" id="line_1290"> 1290.</a></span><span class="count        ">     82</span><span>        vtype = SQLITE_DATATYPE_TEXT;</span></pre>
<pre><span class="lineno"><a href="#line_1291" id="line_1291"> 1291.</a></span><span class="count        ">     82</span><span>        vsize = 4 + val.byteLength;</span></pre>
<pre><span class="lineno"><a href="#line_1292" id="line_1292"> 1292.</a></span><span class="count        ">   5182</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1293" id="line_1293"> 1293.</a></span><span class="count        ">   5182</span><span>    nused = baton.getInt32(4, true);</span></pre>
<pre><span class="lineno"><a href="#line_1294" id="line_1294"> 1294.</a></span><span class="count        ">   5182</span><span>    nn = nused + 1 + vsize;</span></pre>
<pre><span class="lineno"><a href="#line_1295" id="line_1295"> 1295.</a></span><span class="count        ">   5182</span><span>    assertOrThrow(</span></pre>
<pre><span class="lineno"><a href="#line_1296" id="line_1296"> 1296.</a></span><span class="count        ">   5182</span><span>        nn &lt;= 0xffff_ffff,</span></pre>
<pre><span class="lineno"><a href="#line_1297" id="line_1297"> 1297.</a></span><span class="count        ">   5182</span><span>        "jsbaton cannot exceed 0x7fff_ffff / 2,147,483,647 bytes"</span></pre>
<pre><span class="lineno"><a href="#line_1298" id="line_1298"> 1298.</a></span><span class="count        ">   5182</span><span>    );</span></pre>
<pre><span class="lineno"><a href="#line_1299" id="line_1299"> 1299.</a></span><span class="count        ">   5182</span><span>    // exponentially grow baton as needed</span></pre>
<pre><span class="lineno"><a href="#line_1300" id="line_1300"> 1300.</a></span><span class="count        ">   2164</span><span>    if (baton.byteLength &lt; nn) {</span></pre>
<pre><span class="lineno"><a href="#line_1301" id="line_1301"> 1301.</a></span><span class="count        ">   2164</span><span>        tmp = baton;</span></pre>
<pre><span class="lineno"><a href="#line_1302" id="line_1302"> 1302.</a></span><span class="count        ">   2164</span><span>        baton = new DataView(new ArrayBuffer(</span></pre>
<pre><span class="lineno"><a href="#line_1303" id="line_1303"> 1303.</a></span><span class="count        ">   2164</span><span>            Math.min(2 ** Math.ceil(Math.log2(nn)), 0x7fff_ffff)</span></pre>
<pre><span class="lineno"><a href="#line_1304" id="line_1304"> 1304.</a></span><span class="count        ">   2164</span><span>        ));</span></pre>
<pre><span class="lineno"><a href="#line_1305" id="line_1305"> 1305.</a></span><span class="count        ">   2164</span><span>        // update nallc</span></pre>
<pre><span class="lineno"><a href="#line_1306" id="line_1306"> 1306.</a></span><span class="count        ">   2164</span><span>        baton.setInt32(0, baton.byteLength, true);</span></pre>
<pre><span class="lineno"><a href="#line_1307" id="line_1307"> 1307.</a></span><span class="count        ">   2164</span><span>        // copy old-baton into new-baton</span></pre>
<pre><span class="lineno"><a href="#line_1308" id="line_1308"> 1308.</a></span><span class="count        ">   2164</span><span>        new Uint8Array(baton.buffer, baton.byteOffset, nused).set(</span></pre>
<pre><span class="lineno"><a href="#line_1309" id="line_1309"> 1309.</a></span><span class="count        ">   2164</span><span>            new Uint8Array(tmp.buffer, tmp.byteOffset, nused)</span></pre>
<pre><span class="lineno"><a href="#line_1310" id="line_1310"> 1310.</a></span><span class="count        ">   2164</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_1311" id="line_1311"> 1311.</a></span><span class="count        ">   2164</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1312" id="line_1312"> 1312.</a></span><span class="count        ">   5182</span><span>    // push vtype - 1-byte</span></pre>
<pre><span class="lineno"><a href="#line_1313" id="line_1313"> 1313.</a></span><span class="count        ">   5182</span><span>    baton.setUint8(nused, vtype);</span></pre>
<pre><span class="lineno"><a href="#line_1314" id="line_1314"> 1314.</a></span><span class="count        ">   5182</span><span>    // update nused</span></pre>
<pre><span class="lineno"><a href="#line_1315" id="line_1315"> 1315.</a></span><span class="count        ">   5182</span><span>    baton.setInt32(4, nused + 1 + vsize, true);</span></pre>
<pre><span class="lineno"><a href="#line_1316" id="line_1316"> 1316.</a></span><span class="count        ">   5182</span><span>    // handle blob-value</span></pre>
<pre><span class="lineno"><a href="#line_1317" id="line_1317"> 1317.</a></span><span class="count        ">   5182</span><span>    switch (vtype) {</span></pre>
<pre><span class="lineno"><a href="#line_1318" id="line_1318"> 1318.</a></span><span class="count        ">     30</span><span>    case SQLITE_DATATYPE_BLOB:</span></pre>
<pre><span class="lineno"><a href="#line_1319" id="line_1319"> 1319.</a></span><span class="count        ">   4118</span><span>    case SQLITE_DATATYPE_TEXT:</span></pre>
<pre><span class="lineno"><a href="#line_1320" id="line_1320"> 1320.</a></span><span class="count        ">   4118</span><span>        // set argv[ii] to blob/text location</span></pre>
<pre><span class="lineno"><a href="#line_1321" id="line_1321"> 1321.</a></span><span class="count        ">   4118</span><span>        if (argi !== undefined) {</span></pre>
<pre><span class="lineno"><a href="#line_1322" id="line_1322"> 1322.</a></span><span class="count        ">   4118</span><span>            baton.setInt32(JSBATON_OFFSET_ARGV + argi * 8, nused, true);</span></pre>
<pre><span class="lineno"><a href="#line_1323" id="line_1323"> 1323.</a></span><span class="count        ">   4118</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_1324" id="line_1324"> 1324.</a></span><span class="count        ">   4118</span><span>        vsize -= 4;</span></pre>
<pre><span class="lineno"><a href="#line_1325" id="line_1325"> 1325.</a></span><span class="count        ">   4118</span><span>        assertOrThrow(</span></pre>
<pre><span class="lineno"><a href="#line_1326" id="line_1326"> 1326.</a></span><span class="count        ">   4118</span><span>            0 &lt;= vsize &amp;&amp; vsize &lt;= SIZEOF_BLOB_MAX,</span></pre>
<pre><span class="lineno"><a href="#line_1327" id="line_1327"> 1327.</a></span><span class="count        ">   4118</span><span>            (</span></pre>
<pre><span class="lineno"><a href="#line_1328" id="line_1328"> 1328.</a></span><span class="count        ">   4118</span><span>                "sqlite-blob byte-length must be within inclusive-range"</span></pre>
<pre><span class="lineno"><a href="#line_1329" id="line_1329"> 1329.</a></span><span class="count        ">   4118</span><span>                + ` 0 to ${SIZEOF_BLOB_MAX}`</span></pre>
<pre><span class="lineno"><a href="#line_1330" id="line_1330"> 1330.</a></span><span class="count        ">   4118</span><span>            )</span></pre>
<pre><span class="lineno"><a href="#line_1331" id="line_1331"> 1331.</a></span><span class="count        ">   4118</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_1332" id="line_1332"> 1332.</a></span><span class="count        ">   4118</span><span>        // push vsize - 4-byte</span></pre>
<pre><span class="lineno"><a href="#line_1333" id="line_1333"> 1333.</a></span><span class="count        ">   4118</span><span>        baton.setInt32(nused + 1, vsize, true);</span></pre>
<pre><span class="lineno"><a href="#line_1334" id="line_1334"> 1334.</a></span><span class="count        ">   4118</span><span>        // push SQLITE-BLOB/TEXT - vsize-byte</span></pre>
<pre><span class="lineno"><a href="#line_1335" id="line_1335"> 1335.</a></span><span class="count        ">   4118</span><span>        new Uint8Array(</span></pre>
<pre><span class="lineno"><a href="#line_1336" id="line_1336"> 1336.</a></span><span class="count        ">   4118</span><span>            baton.buffer,</span></pre>
<pre><span class="lineno"><a href="#line_1337" id="line_1337"> 1337.</a></span><span class="count        ">   4118</span><span>            baton.byteOffset + nused + 1 + 4,</span></pre>
<pre><span class="lineno"><a href="#line_1338" id="line_1338"> 1338.</a></span><span class="count        ">   4118</span><span>            vsize</span></pre>
<pre><span class="lineno"><a href="#line_1339" id="line_1339"> 1339.</a></span><span class="count        ">   4118</span><span>        ).set(new Uint8Array(val.buffer, val.byteOffset, vsize));</span></pre>
<pre><span class="lineno"><a href="#line_1340" id="line_1340"> 1340.</a></span><span class="count        ">   4118</span><span>        break;</span></pre>
<pre><span class="lineno"><a href="#line_1341" id="line_1341"> 1341.</a></span><span class="count        ">     12</span><span>    case SQLITE_DATATYPE_EXTERNALBUFFER:</span></pre>
<pre><span class="lineno"><a href="#line_1342" id="line_1342"> 1342.</a></span><span class="count        ">     12</span><span>        vsize = val.byteLength;</span></pre>
<pre><span class="lineno"><a href="#line_1343" id="line_1343"> 1343.</a></span><span class="count        ">     12</span><span>        assertOrThrow(</span></pre>
<pre><span class="lineno"><a href="#line_1344" id="line_1344"> 1344.</a></span><span class="count        ">     12</span><span>            0 &lt;= vsize &amp;&amp; vsize &lt;= SIZEOF_BLOB_MAX,</span></pre>
<pre><span class="lineno"><a href="#line_1345" id="line_1345"> 1345.</a></span><span class="count        ">     12</span><span>            (</span></pre>
<pre><span class="lineno"><a href="#line_1346" id="line_1346"> 1346.</a></span><span class="count        ">     12</span><span>                "sqlite-blob byte-length must be within inclusive-range"</span></pre>
<pre><span class="lineno"><a href="#line_1347" id="line_1347"> 1347.</a></span><span class="count        ">     12</span><span>                + ` 0 to ${SIZEOF_BLOB_MAX}`</span></pre>
<pre><span class="lineno"><a href="#line_1348" id="line_1348"> 1348.</a></span><span class="count        ">     12</span><span>            )</span></pre>
<pre><span class="lineno"><a href="#line_1349" id="line_1349"> 1349.</a></span><span class="count        ">     12</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_1350" id="line_1350"> 1350.</a></span><span class="count        ">     12</span><span>        assertOrThrow(</span></pre>
<pre><span class="lineno"><a href="#line_1351" id="line_1351"> 1351.</a></span><span class="count        ">     12</span><span>            bufi[0] &lt; JSBATON_ARGC,</span></pre>
<pre><span class="lineno"><a href="#line_1352" id="line_1352"> 1352.</a></span><span class="count        ">     12</span><span>            `cannot pass more than ${JSBATON_ARGC} arraybuffers`</span></pre>
<pre><span class="lineno"><a href="#line_1353" id="line_1353"> 1353.</a></span><span class="count        ">     12</span><span>        );</span></pre>
<pre><span class="lineno"><a href="#line_1354" id="line_1354"> 1354.</a></span><span class="count        ">     12</span><span>        // push externalbuffer - 4-byte</span></pre>
<pre><span class="lineno"><a href="#line_1355" id="line_1355"> 1355.</a></span><span class="count        ">     12</span><span>        baton.setInt32(nused + 1, bufi[0], true);</span></pre>
<pre><span class="lineno"><a href="#line_1356" id="line_1356"> 1356.</a></span><span class="count        ">     12</span><span>        // set buffer</span></pre>
<pre><span class="lineno"><a href="#line_1357" id="line_1357"> 1357.</a></span><span class="count        ">     12</span><span>        cModule._jsbatonSetArraybuffer(baton.buffer, bufi[0], val);</span></pre>
<pre><span class="lineno"><a href="#line_1358" id="line_1358"> 1358.</a></span><span class="count        ">     12</span><span>        // increment bufi</span></pre>
<pre><span class="lineno"><a href="#line_1359" id="line_1359"> 1359.</a></span><span class="count        ">     12</span><span>        bufi[0] += 1;</span></pre>
<pre><span class="lineno"><a href="#line_1360" id="line_1360"> 1360.</a></span><span class="count        ">     12</span><span>        // add buffer to reference_list to prevent gc during db_call.</span></pre>
<pre><span class="lineno"><a href="#line_1361" id="line_1361"> 1361.</a></span><span class="count        ">     12</span><span>        referenceList.push(val);</span></pre>
<pre><span class="lineno"><a href="#line_1362" id="line_1362"> 1362.</a></span><span class="count        ">     12</span><span>        break;</span></pre>
<pre><span class="lineno"><a href="#line_1363" id="line_1363"> 1363.</a></span><span class="count        ">    561</span><span>    case SQLITE_DATATYPE_FLOAT:</span></pre>
<pre><span class="lineno"><a href="#line_1364" id="line_1364"> 1364.</a></span><span class="count        ">    561</span><span>        // push SQLITE-REAL - 8-byte</span></pre>
<pre><span class="lineno"><a href="#line_1365" id="line_1365"> 1365.</a></span><span class="count        ">    561</span><span>        baton.setFloat64(nused + 1, val, true);</span></pre>
<pre><span class="lineno"><a href="#line_1366" id="line_1366"> 1366.</a></span><span class="count        ">    561</span><span>        break;</span></pre>
<pre><span class="lineno"><a href="#line_1367" id="line_1367"> 1367.</a></span><span class="count        ">     42</span><span>    case SQLITE_DATATYPE_INTEGER:</span></pre>
<pre><span class="lineno"><a href="#line_1368" id="line_1368"> 1368.</a></span><span class="count        ">     42</span><span>        assertInt64(val);</span></pre>
<pre><span class="lineno"><a href="#line_1369" id="line_1369"> 1369.</a></span><span class="count        ">     42</span><span>        // push SQLITE-INTEGER - 8-byte</span></pre>
<pre><span class="lineno"><a href="#line_1370" id="line_1370"> 1370.</a></span><span class="count        ">     42</span><span>        baton.setBigInt64(nused + 1, val, true);</span></pre>
<pre><span class="lineno"><a href="#line_1371" id="line_1371"> 1371.</a></span><span class="count        ">     42</span><span>        break;</span></pre>
<pre><span class="lineno"><a href="#line_1372" id="line_1372"> 1372.</a></span><span class="count        ">   5170</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1373" id="line_1373"> 1373.</a></span><span class="count        ">   5170</span><span>    return baton;</span></pre>
<pre><span class="lineno"><a href="#line_1374" id="line_1374"> 1374.</a></span><span class="count        ">   5170</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1375" id="line_1375"> 1375.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1376" id="line_1376"> 1376.</a></span><span class="count        ">   1752</span><span>function jsonParseArraybuffer(buf) {</span></pre>
<pre><span class="lineno"><a href="#line_1377" id="line_1377"> 1377.</a></span><span class="count        ">   1752</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1378" id="line_1378"> 1378.</a></span><span class="count        ">   1752</span><span>// This function will JSON.parse arraybuffer &lt;buf&gt;.</span></pre>
<pre><span class="lineno"><a href="#line_1379" id="line_1379"> 1379.</a></span><span class="count        ">   1752</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1380" id="line_1380"> 1380.</a></span><span class="count        ">   1752</span><span>    return JSON.parse(</span></pre>
<pre><span class="lineno"><a href="#line_1381" id="line_1381"> 1381.</a></span><span class="count        ">   1752</span><span>        (</span></pre>
<pre><span class="lineno"><a href="#line_1382" id="line_1382"> 1382.</a></span><span class="count        ">   1752</span><span>            IS_BROWSER</span></pre>
<pre><span class="lineno"><a href="#line_1383" id="line_1383"> 1383.</a></span><span class="count        ">      1</span><span>            ? new TextDecoder().decode(buf)</span></pre>
<pre><span class="lineno"><a href="#line_1384" id="line_1384"> 1384.</a></span><span class="count        ">   1751</span><span>            : buf</span></pre>
<pre><span class="lineno"><a href="#line_1385" id="line_1385"> 1385.</a></span><span class="count        ">   1752</span><span>        )</span></pre>
<pre><span class="lineno"><a href="#line_1386" id="line_1386"> 1386.</a></span><span class="count        ">      1</span><span>        || "null"</span></pre>
<pre><span class="lineno"><a href="#line_1387" id="line_1387"> 1387.</a></span><span class="count        ">   1752</span><span>    );</span></pre>
<pre><span class="lineno"><a href="#line_1388" id="line_1388"> 1388.</a></span><span class="count        ">   1752</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1389" id="line_1389"> 1389.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1390" id="line_1390"> 1390.</a></span><span class="count        ">      2</span><span>function jsonRowListFromCsv({</span></pre>
<pre><span class="lineno"><a href="#line_1391" id="line_1391"> 1391.</a></span><span class="count        ">      2</span><span>    csv</span></pre>
<pre><span class="lineno"><a href="#line_1392" id="line_1392"> 1392.</a></span><span class="count        ">      2</span><span>}) {</span></pre>
<pre><span class="lineno"><a href="#line_1393" id="line_1393"> 1393.</a></span><span class="count        ">      2</span><span>// this function will convert &lt;csv&gt;-text to json list-of-list</span></pre>
<pre><span class="lineno"><a href="#line_1394" id="line_1394"> 1394.</a></span><span class="count        ">      2</span><span>//</span></pre>
<pre><span class="lineno"><a href="#line_1395" id="line_1395"> 1395.</a></span><span class="count        ">      2</span><span>// https://tools.ietf.org/html/rfc4180#section-2</span></pre>
<pre><span class="lineno"><a href="#line_1396" id="line_1396"> 1396.</a></span><span class="count        ">      2</span><span>// Definition of the CSV Format</span></pre>
<pre><span class="lineno"><a href="#line_1397" id="line_1397"> 1397.</a></span><span class="count        ">      2</span><span>// While there are various specifications and implementations for the</span></pre>
<pre><span class="lineno"><a href="#line_1398" id="line_1398"> 1398.</a></span><span class="count        ">      2</span><span>// CSV format (for ex. [4], [5], [6] and [7]), there is no formal</span></pre>
<pre><span class="lineno"><a href="#line_1399" id="line_1399"> 1399.</a></span><span class="count        ">      2</span><span>// specification in existence, which allows for a wide variety of</span></pre>
<pre><span class="lineno"><a href="#line_1400" id="line_1400"> 1400.</a></span><span class="count        ">      2</span><span>// interpretations of CSV files.  This section documents the format that</span></pre>
<pre><span class="lineno"><a href="#line_1401" id="line_1401"> 1401.</a></span><span class="count        ">      2</span><span>// seems to be followed by most implementations:</span></pre>
<pre><span class="lineno"><a href="#line_1402" id="line_1402"> 1402.</a></span><span class="count        ">      2</span><span>//</span></pre>
<pre><span class="lineno"><a href="#line_1403" id="line_1403"> 1403.</a></span><span class="count        ">      2</span><span>// 1.  Each record is located on a separate line, delimited by a line</span></pre>
<pre><span class="lineno"><a href="#line_1404" id="line_1404"> 1404.</a></span><span class="count        ">      2</span><span>//     break (CRLF).  For example:</span></pre>
<pre><span class="lineno"><a href="#line_1405" id="line_1405"> 1405.</a></span><span class="count        ">      2</span><span>//     aaa,bbb,ccc CRLF</span></pre>
<pre><span class="lineno"><a href="#line_1406" id="line_1406"> 1406.</a></span><span class="count        ">      2</span><span>//     zzz,yyy,xxx CRLF</span></pre>
<pre><span class="lineno"><a href="#line_1407" id="line_1407"> 1407.</a></span><span class="count        ">      2</span><span>//</span></pre>
<pre><span class="lineno"><a href="#line_1408" id="line_1408"> 1408.</a></span><span class="count        ">      2</span><span>// 2.  The last record in the file may or may not have an ending line</span></pre>
<pre><span class="lineno"><a href="#line_1409" id="line_1409"> 1409.</a></span><span class="count        ">      2</span><span>//     break.  For example:</span></pre>
<pre><span class="lineno"><a href="#line_1410" id="line_1410"> 1410.</a></span><span class="count        ">      2</span><span>//     aaa,bbb,ccc CRLF</span></pre>
<pre><span class="lineno"><a href="#line_1411" id="line_1411"> 1411.</a></span><span class="count        ">      2</span><span>//     zzz,yyy,xxx</span></pre>
<pre><span class="lineno"><a href="#line_1412" id="line_1412"> 1412.</a></span><span class="count        ">      2</span><span>//</span></pre>
<pre><span class="lineno"><a href="#line_1413" id="line_1413"> 1413.</a></span><span class="count        ">      2</span><span>// 3.  There maybe an optional header line appearing as the first line</span></pre>
<pre><span class="lineno"><a href="#line_1414" id="line_1414"> 1414.</a></span><span class="count        ">      2</span><span>//     of the file with the same format as normal record lines.  This</span></pre>
<pre><span class="lineno"><a href="#line_1415" id="line_1415"> 1415.</a></span><span class="count        ">      2</span><span>//     header will contain names corresponding to the fields in the file</span></pre>
<pre><span class="lineno"><a href="#line_1416" id="line_1416"> 1416.</a></span><span class="count        ">      2</span><span>//     and should contain the same number of fields as the records in</span></pre>
<pre><span class="lineno"><a href="#line_1417" id="line_1417"> 1417.</a></span><span class="count        ">      2</span><span>//     the rest of the file (the presence or absence of the header line</span></pre>
<pre><span class="lineno"><a href="#line_1418" id="line_1418"> 1418.</a></span><span class="count        ">      2</span><span>//     should be indicated via the optional "header" parameter of this</span></pre>
<pre><span class="lineno"><a href="#line_1419" id="line_1419"> 1419.</a></span><span class="count        ">      2</span><span>//     MIME type).  For example:</span></pre>
<pre><span class="lineno"><a href="#line_1420" id="line_1420"> 1420.</a></span><span class="count        ">      2</span><span>//     field_name,field_name,field_name CRLF</span></pre>
<pre><span class="lineno"><a href="#line_1421" id="line_1421"> 1421.</a></span><span class="count        ">      2</span><span>//     aaa,bbb,ccc CRLF</span></pre>
<pre><span class="lineno"><a href="#line_1422" id="line_1422"> 1422.</a></span><span class="count        ">      2</span><span>//     zzz,yyy,xxx CRLF</span></pre>
<pre><span class="lineno"><a href="#line_1423" id="line_1423"> 1423.</a></span><span class="count        ">      2</span><span>//</span></pre>
<pre><span class="lineno"><a href="#line_1424" id="line_1424"> 1424.</a></span><span class="count        ">      2</span><span>// 4.  Within the header and each record, there may be one or more</span></pre>
<pre><span class="lineno"><a href="#line_1425" id="line_1425"> 1425.</a></span><span class="count        ">      2</span><span>//     fields, separated by commas.  Each line should contain the same</span></pre>
<pre><span class="lineno"><a href="#line_1426" id="line_1426"> 1426.</a></span><span class="count        ">      2</span><span>//     number of fields throughout the file.  Spaces are considered part</span></pre>
<pre><span class="lineno"><a href="#line_1427" id="line_1427"> 1427.</a></span><span class="count        ">      2</span><span>//     of a field and should not be ignored.  The last field in the</span></pre>
<pre><span class="lineno"><a href="#line_1428" id="line_1428"> 1428.</a></span><span class="count        ">      2</span><span>//     record must not be followed by a comma.  For example:</span></pre>
<pre><span class="lineno"><a href="#line_1429" id="line_1429"> 1429.</a></span><span class="count        ">      2</span><span>//     aaa,bbb,ccc</span></pre>
<pre><span class="lineno"><a href="#line_1430" id="line_1430"> 1430.</a></span><span class="count        ">      2</span><span>//</span></pre>
<pre><span class="lineno"><a href="#line_1431" id="line_1431"> 1431.</a></span><span class="count        ">      2</span><span>// 5.  Each field may or may not be enclosed in double quotes (however</span></pre>
<pre><span class="lineno"><a href="#line_1432" id="line_1432"> 1432.</a></span><span class="count        ">      2</span><span>//     some programs, such as Microsoft Excel, do not use double quotes</span></pre>
<pre><span class="lineno"><a href="#line_1433" id="line_1433"> 1433.</a></span><span class="count        ">      2</span><span>//     at all).  If fields are not enclosed with double quotes, then</span></pre>
<pre><span class="lineno"><a href="#line_1434" id="line_1434"> 1434.</a></span><span class="count        ">      2</span><span>//     double quotes may not appear inside the fields.  For example:</span></pre>
<pre><span class="lineno"><a href="#line_1435" id="line_1435"> 1435.</a></span><span class="count        ">      2</span><span>//     "aaa","bbb","ccc" CRLF</span></pre>
<pre><span class="lineno"><a href="#line_1436" id="line_1436"> 1436.</a></span><span class="count        ">      2</span><span>//     zzz,yyy,xxx</span></pre>
<pre><span class="lineno"><a href="#line_1437" id="line_1437"> 1437.</a></span><span class="count        ">      2</span><span>//</span></pre>
<pre><span class="lineno"><a href="#line_1438" id="line_1438"> 1438.</a></span><span class="count        ">      2</span><span>// 6.  Fields containing line breaks (CRLF), double quotes, and commas</span></pre>
<pre><span class="lineno"><a href="#line_1439" id="line_1439"> 1439.</a></span><span class="count        ">      2</span><span>//     should be enclosed in double-quotes.  For example:</span></pre>
<pre><span class="lineno"><a href="#line_1440" id="line_1440"> 1440.</a></span><span class="count        ">      2</span><span>//     "aaa","b CRLF</span></pre>
<pre><span class="lineno"><a href="#line_1441" id="line_1441"> 1441.</a></span><span class="count        ">      2</span><span>//     bb","ccc" CRLF</span></pre>
<pre><span class="lineno"><a href="#line_1442" id="line_1442"> 1442.</a></span><span class="count        ">      2</span><span>//     zzz,yyy,xxx</span></pre>
<pre><span class="lineno"><a href="#line_1443" id="line_1443"> 1443.</a></span><span class="count        ">      2</span><span>//</span></pre>
<pre><span class="lineno"><a href="#line_1444" id="line_1444"> 1444.</a></span><span class="count        ">      2</span><span>// 7.  If double-quotes are used to enclose fields, then a double-quote</span></pre>
<pre><span class="lineno"><a href="#line_1445" id="line_1445"> 1445.</a></span><span class="count        ">      2</span><span>//     appearing inside a field must be escaped by preceding it with</span></pre>
<pre><span class="lineno"><a href="#line_1446" id="line_1446"> 1446.</a></span><span class="count        ">      2</span><span>//     another double quote.  For example:</span></pre>
<pre><span class="lineno"><a href="#line_1447" id="line_1447"> 1447.</a></span><span class="count        ">      2</span><span>//     "aaa","b""bb","ccc"</span></pre>
<pre><span class="lineno"><a href="#line_1448" id="line_1448"> 1448.</a></span><span class="count        ">      2</span><span>    let match;</span></pre>
<pre><span class="lineno"><a href="#line_1449" id="line_1449"> 1449.</a></span><span class="count        ">      2</span><span>    let quote;</span></pre>
<pre><span class="lineno"><a href="#line_1450" id="line_1450"> 1450.</a></span><span class="count        ">      2</span><span>    let rgx;</span></pre>
<pre><span class="lineno"><a href="#line_1451" id="line_1451"> 1451.</a></span><span class="count        ">      2</span><span>    let row;</span></pre>
<pre><span class="lineno"><a href="#line_1452" id="line_1452"> 1452.</a></span><span class="count        ">      2</span><span>    let rowList;</span></pre>
<pre><span class="lineno"><a href="#line_1453" id="line_1453"> 1453.</a></span><span class="count        ">      2</span><span>    let val;</span></pre>
<pre><span class="lineno"><a href="#line_1454" id="line_1454"> 1454.</a></span><span class="count        ">      2</span><span>    // normalize "\r\n" to "\n"</span></pre>
<pre><span class="lineno"><a href="#line_1455" id="line_1455"> 1455.</a></span><span class="count        ">      2</span><span>    csv = csv.trimEnd().replace((</span></pre>
<pre><span class="lineno"><a href="#line_1456" id="line_1456"> 1456.</a></span><span class="count        ">      2</span><span>        /\r\n?/gu</span></pre>
<pre><span class="lineno"><a href="#line_1457" id="line_1457"> 1457.</a></span><span class="count        ">      2</span><span>    ), "\n") + "\n";</span></pre>
<pre><span class="lineno"><a href="#line_1458" id="line_1458"> 1458.</a></span><span class="count        ">      2</span><span>    rgx = (</span></pre>
<pre><span class="lineno"><a href="#line_1459" id="line_1459"> 1459.</a></span><span class="count        ">      2</span><span>        /(.*?)(""|"|,|\n)/gu</span></pre>
<pre><span class="lineno"><a href="#line_1460" id="line_1460"> 1460.</a></span><span class="count        ">      2</span><span>    );</span></pre>
<pre><span class="lineno"><a href="#line_1461" id="line_1461"> 1461.</a></span><span class="count        ">      2</span><span>    rowList = [];</span></pre>
<pre><span class="lineno"><a href="#line_1462" id="line_1462"> 1462.</a></span><span class="count        ">      2</span><span>    // reset row</span></pre>
<pre><span class="lineno"><a href="#line_1463" id="line_1463"> 1463.</a></span><span class="count        ">      2</span><span>    row = [];</span></pre>
<pre><span class="lineno"><a href="#line_1464" id="line_1464"> 1464.</a></span><span class="count        ">      2</span><span>    val = "";</span></pre>
<pre><span class="lineno"><a href="#line_1465" id="line_1465"> 1465.</a></span><span class="count        ">     28</span><span>    while (true) {</span></pre>
<pre><span class="lineno"><a href="#line_1466" id="line_1466"> 1466.</a></span><span class="count        ">     28</span><span>        match = rgx.exec(csv);</span></pre>
<pre><span class="lineno"><a href="#line_1467" id="line_1467"> 1467.</a></span><span class="count        ">     28</span><span>        if (!match) {</span></pre>
<pre><span class="lineno"><a href="#line_1468" id="line_1468"> 1468.</a></span><span class="count        ">     28</span><span>// 2.  The last record in the file may or may not have an ending line</span></pre>
<pre><span class="lineno"><a href="#line_1469" id="line_1469"> 1469.</a></span><span class="count        ">     28</span><span>//     break.  For example:</span></pre>
<pre><span class="lineno"><a href="#line_1470" id="line_1470"> 1470.</a></span><span class="count        ">     28</span><span>//     aaa,bbb,ccc CRLF</span></pre>
<pre><span class="lineno"><a href="#line_1471" id="line_1471"> 1471.</a></span><span class="count        ">     28</span><span>//     zzz,yyy,xxx</span></pre>
<pre><span class="lineno"><a href="#line_1472" id="line_1472"> 1472.</a></span><span class="count        ">     28</span><span>            if (!row.length) {</span></pre>
<pre><span class="lineno"><a href="#line_1473" id="line_1473"> 1473.</a></span><span class="count        ">     28</span><span>                break;</span></pre>
<pre><span class="lineno"><a href="#line_1474" id="line_1474"> 1474.</a></span><span class="count        ">     28</span><span>            }</span></pre>
<pre><span class="lineno"><a href="#line_1475" id="line_1475"> 1475.</a></span><span class="count        ">     28</span><span>            // // if eof missing crlf, then mock it</span></pre>
<pre><span class="lineno"><a href="#line_1476" id="line_1476"> 1476.</a></span><span class="count        ">     28</span><span>            // rgx.lastIndex = csv.length;</span></pre>
<pre><span class="lineno"><a href="#line_1477" id="line_1477"> 1477.</a></span><span class="count        ">     28</span><span>            // match = [</span></pre>
<pre><span class="lineno"><a href="#line_1478" id="line_1478"> 1478.</a></span><span class="count        ">     28</span><span>            //     "\n", "", "\n"</span></pre>
<pre><span class="lineno"><a href="#line_1479" id="line_1479"> 1479.</a></span><span class="count        ">     28</span><span>            // ];</span></pre>
<pre><span class="lineno"><a href="#line_1480" id="line_1480"> 1480.</a></span><span class="count        ">     28</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_1481" id="line_1481"> 1481.</a></span><span class="count        ">     28</span><span>        // build val</span></pre>
<pre><span class="lineno"><a href="#line_1482" id="line_1482"> 1482.</a></span><span class="count        ">     28</span><span>        val += match[1];</span></pre>
<pre><span class="lineno"><a href="#line_1483" id="line_1483"> 1483.</a></span><span class="count        ">     28</span><span>        if (match[2] === "\"") {</span></pre>
<pre><span class="lineno"><a href="#line_1484" id="line_1484"> 1484.</a></span><span class="count        ">     28</span><span>// 5.  Each field may or may not be enclosed in double quotes (however</span></pre>
<pre><span class="lineno"><a href="#line_1485" id="line_1485"> 1485.</a></span><span class="count        ">     28</span><span>//     some programs, such as Microsoft Excel, do not use double quotes</span></pre>
<pre><span class="lineno"><a href="#line_1486" id="line_1486"> 1486.</a></span><span class="count        ">     28</span><span>//     at all).  If fields are not enclosed with double quotes, then</span></pre>
<pre><span class="lineno"><a href="#line_1487" id="line_1487"> 1487.</a></span><span class="count        ">     28</span><span>//     double quotes may not appear inside the fields.  For example:</span></pre>
<pre><span class="lineno"><a href="#line_1488" id="line_1488"> 1488.</a></span><span class="count        ">     28</span><span>//     "aaa","bbb","ccc" CRLF</span></pre>
<pre><span class="lineno"><a href="#line_1489" id="line_1489"> 1489.</a></span><span class="count        ">     28</span><span>//     zzz,yyy,xxx</span></pre>
<pre><span class="lineno"><a href="#line_1490" id="line_1490"> 1490.</a></span><span class="count        ">     28</span><span>            quote = !quote;</span></pre>
<pre><span class="lineno"><a href="#line_1491" id="line_1491"> 1491.</a></span><span class="count        ">     28</span><span>        } else if (quote) {</span></pre>
<pre><span class="lineno"><a href="#line_1492" id="line_1492"> 1492.</a></span><span class="count        ">     28</span><span>// 7.  If double-quotes are used to enclose fields, then a double-quote</span></pre>
<pre><span class="lineno"><a href="#line_1493" id="line_1493"> 1493.</a></span><span class="count        ">     28</span><span>//     appearing inside a field must be escaped by preceding it with</span></pre>
<pre><span class="lineno"><a href="#line_1494" id="line_1494"> 1494.</a></span><span class="count        ">     28</span><span>//     another double quote.  For example:</span></pre>
<pre><span class="lineno"><a href="#line_1495" id="line_1495"> 1495.</a></span><span class="count        ">     28</span><span>//     "aaa","b""bb","ccc"</span></pre>
<pre><span class="lineno"><a href="#line_1496" id="line_1496"> 1496.</a></span><span class="count        ">     28</span><span>            if (match[2] === "\"\"") {</span></pre>
<pre><span class="lineno"><a href="#line_1497" id="line_1497"> 1497.</a></span><span class="count        ">     28</span><span>                val += "\"";</span></pre>
<pre><span class="lineno"><a href="#line_1498" id="line_1498"> 1498.</a></span><span class="count        ">     28</span><span>// 6.  Fields containing line breaks (CRLF), double quotes, and commas</span></pre>
<pre><span class="lineno"><a href="#line_1499" id="line_1499"> 1499.</a></span><span class="count        ">     28</span><span>//     should be enclosed in double-quotes.  For example:</span></pre>
<pre><span class="lineno"><a href="#line_1500" id="line_1500"> 1500.</a></span><span class="count        ">     28</span><span>//     "aaa","b CRLF</span></pre>
<pre><span class="lineno"><a href="#line_1501" id="line_1501"> 1501.</a></span><span class="count        ">     28</span><span>//     bb","ccc" CRLF</span></pre>
<pre><span class="lineno"><a href="#line_1502" id="line_1502"> 1502.</a></span><span class="count        ">     28</span><span>//     zzz,yyy,xxx</span></pre>
<pre><span class="lineno"><a href="#line_1503" id="line_1503"> 1503.</a></span><span class="count        ">     28</span><span>            } else {</span></pre>
<pre><span class="lineno"><a href="#line_1504" id="line_1504"> 1504.</a></span><span class="count        ">     28</span><span>                val += match[2];</span></pre>
<pre><span class="lineno"><a href="#line_1505" id="line_1505"> 1505.</a></span><span class="count        ">     28</span><span>            }</span></pre>
<pre><span class="lineno"><a href="#line_1506" id="line_1506"> 1506.</a></span><span class="count        ">     28</span><span>        } else if (match[2] === ",") {</span></pre>
<pre><span class="lineno"><a href="#line_1507" id="line_1507"> 1507.</a></span><span class="count        ">     28</span><span>// 4.  Within the header and each record, there may be one or more</span></pre>
<pre><span class="lineno"><a href="#line_1508" id="line_1508"> 1508.</a></span><span class="count        ">     28</span><span>//     fields, separated by commas.  Each line should contain the same</span></pre>
<pre><span class="lineno"><a href="#line_1509" id="line_1509"> 1509.</a></span><span class="count        ">     28</span><span>//     number of fields throughout the file.  Spaces are considered part</span></pre>
<pre><span class="lineno"><a href="#line_1510" id="line_1510"> 1510.</a></span><span class="count        ">     28</span><span>//     of a field and should not be ignored.  The last field in the</span></pre>
<pre><span class="lineno"><a href="#line_1511" id="line_1511"> 1511.</a></span><span class="count        ">     28</span><span>//     record must not be followed by a comma.  For example:</span></pre>
<pre><span class="lineno"><a href="#line_1512" id="line_1512"> 1512.</a></span><span class="count        ">     28</span><span>//     aaa,bbb,ccc</span></pre>
<pre><span class="lineno"><a href="#line_1513" id="line_1513"> 1513.</a></span><span class="count        ">     28</span><span>            // delimit val</span></pre>
<pre><span class="lineno"><a href="#line_1514" id="line_1514"> 1514.</a></span><span class="count        ">     28</span><span>            row.push(val);</span></pre>
<pre><span class="lineno"><a href="#line_1515" id="line_1515"> 1515.</a></span><span class="count        ">     28</span><span>            val = "";</span></pre>
<pre><span class="lineno"><a href="#line_1516" id="line_1516"> 1516.</a></span><span class="count        ">     28</span><span>        } else if (match[2] === "\n") {</span></pre>
<pre><span class="lineno"><a href="#line_1517" id="line_1517"> 1517.</a></span><span class="count        ">     28</span><span>// 1.  Each record is located on a separate line, delimited by a line</span></pre>
<pre><span class="lineno"><a href="#line_1518" id="line_1518"> 1518.</a></span><span class="count        ">     28</span><span>//     break (CRLF).  For example:</span></pre>
<pre><span class="lineno"><a href="#line_1519" id="line_1519"> 1519.</a></span><span class="count        ">     28</span><span>//     aaa,bbb,ccc CRLF</span></pre>
<pre><span class="lineno"><a href="#line_1520" id="line_1520"> 1520.</a></span><span class="count        ">     28</span><span>//     zzz,yyy,xxx CRLF</span></pre>
<pre><span class="lineno"><a href="#line_1521" id="line_1521"> 1521.</a></span><span class="count        ">     28</span><span>            // delimit val</span></pre>
<pre><span class="lineno"><a href="#line_1522" id="line_1522"> 1522.</a></span><span class="count        ">     28</span><span>            row.push(val);</span></pre>
<pre><span class="lineno"><a href="#line_1523" id="line_1523"> 1523.</a></span><span class="count        ">     28</span><span>            val = "";</span></pre>
<pre><span class="lineno"><a href="#line_1524" id="line_1524"> 1524.</a></span><span class="count        ">     28</span><span>            // append row</span></pre>
<pre><span class="lineno"><a href="#line_1525" id="line_1525"> 1525.</a></span><span class="count        ">     28</span><span>            rowList.push(row);</span></pre>
<pre><span class="lineno"><a href="#line_1526" id="line_1526"> 1526.</a></span><span class="count        ">     28</span><span>            // reset row</span></pre>
<pre><span class="lineno"><a href="#line_1527" id="line_1527"> 1527.</a></span><span class="count        ">     28</span><span>            row = [];</span></pre>
<pre><span class="lineno"><a href="#line_1528" id="line_1528"> 1528.</a></span><span class="count        ">     28</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_1529" id="line_1529"> 1529.</a></span><span class="count        ">     28</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1530" id="line_1530"> 1530.</a></span><span class="count        ">      2</span><span>    // // append val</span></pre>
<pre><span class="lineno"><a href="#line_1531" id="line_1531"> 1531.</a></span><span class="count        ">      2</span><span>    // if (val) {</span></pre>
<pre><span class="lineno"><a href="#line_1532" id="line_1532"> 1532.</a></span><span class="count        ">      2</span><span>    //     row.push(val);</span></pre>
<pre><span class="lineno"><a href="#line_1533" id="line_1533"> 1533.</a></span><span class="count        ">      2</span><span>    // }</span></pre>
<pre><span class="lineno"><a href="#line_1534" id="line_1534"> 1534.</a></span><span class="count        ">      2</span><span>    // // append row</span></pre>
<pre><span class="lineno"><a href="#line_1535" id="line_1535"> 1535.</a></span><span class="count        ">      2</span><span>    // if (row.length) {</span></pre>
<pre><span class="lineno"><a href="#line_1536" id="line_1536"> 1536.</a></span><span class="count        ">      2</span><span>    //     rowList.push(row);</span></pre>
<pre><span class="lineno"><a href="#line_1537" id="line_1537"> 1537.</a></span><span class="count        ">      2</span><span>    // }</span></pre>
<pre><span class="lineno"><a href="#line_1538" id="line_1538"> 1538.</a></span><span class="count        ">      2</span><span>    return rowList;</span></pre>
<pre><span class="lineno"><a href="#line_1539" id="line_1539"> 1539.</a></span><span class="count        ">      2</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1540" id="line_1540"> 1540.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1541" id="line_1541"> 1541.</a></span><span class="count        ">      1</span><span>function listOrEmptyList(list) {</span></pre>
<pre><span class="lineno"><a href="#line_1542" id="line_1542"> 1542.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1543" id="line_1543"> 1543.</a></span><span class="count        ">      1</span><span>// This function will return &lt;list&gt; or empty-list if falsy.</span></pre>
<pre><span class="lineno"><a href="#line_1544" id="line_1544"> 1544.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1545" id="line_1545"> 1545.</a></span><span class="count        ">      1</span><span>    return list || [];</span></pre>
<pre><span class="lineno"><a href="#line_1546" id="line_1546"> 1546.</a></span><span class="count        ">      1</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1547" id="line_1547"> 1547.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1548" id="line_1548"> 1548.</a></span><span class="count        ">      8</span><span>async function moduleFsInit() {</span></pre>
<pre><span class="lineno"><a href="#line_1549" id="line_1549"> 1549.</a></span><span class="count        ">      8</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1550" id="line_1550"> 1550.</a></span><span class="count        ">      8</span><span>// This function will import nodejs builtin-modules if they have not yet been</span></pre>
<pre><span class="lineno"><a href="#line_1551" id="line_1551"> 1551.</a></span><span class="count        ">      8</span><span>// imported.</span></pre>
<pre><span class="lineno"><a href="#line_1552" id="line_1552"> 1552.</a></span><span class="count        ">      8</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1553" id="line_1553"> 1553.</a></span><span class="count        ">      8</span><span>// State 3 - Modules already imported.</span></pre>
<pre><span class="lineno"><a href="#line_1554" id="line_1554"> 1554.</a></span><span class="count        ">      8</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1555" id="line_1555"> 1555.</a></span><span class="count        ">      6</span><span>    if (moduleFs !== undefined) {</span></pre>
<pre><span class="lineno"><a href="#line_1556" id="line_1556"> 1556.</a></span><span class="count        ">      6</span><span>        return;</span></pre>
<pre><span class="lineno"><a href="#line_1557" id="line_1557"> 1557.</a></span><span class="count        ">      6</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1558" id="line_1558"> 1558.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1559" id="line_1559"> 1559.</a></span><span class="count        ">      2</span><span>// State 2 - Wait while modules are importing.</span></pre>
<pre><span class="lineno"><a href="#line_1560" id="line_1560"> 1560.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1561" id="line_1561"> 1561.</a></span><span class="count        ">      2</span><span>    if (moduleFsInitResolveList !== undefined) {</span></pre>
<pre><span class="lineno"><a href="#line_1562" id="line_1562"> 1562.</a></span><span class="count        ">      1</span><span>        return new Promise(function (resolve) {</span></pre>
<pre><span class="lineno"><a href="#line_1563" id="line_1563"> 1563.</a></span><span class="count        ">      1</span><span>            moduleFsInitResolveList.push(resolve);</span></pre>
<pre><span class="lineno"><a href="#line_1564" id="line_1564"> 1564.</a></span><span class="count        ">      1</span><span>        });</span></pre>
<pre><span class="lineno"><a href="#line_1565" id="line_1565"> 1565.</a></span><span class="count        ">      1</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1566" id="line_1566"> 1566.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1567" id="line_1567"> 1567.</a></span><span class="count        ">      1</span><span>// State 1 - Start importing modules.</span></pre>
<pre><span class="lineno"><a href="#line_1568" id="line_1568"> 1568.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1569" id="line_1569"> 1569.</a></span><span class="count        ">      1</span><span>    moduleFsInitResolveList = [];</span></pre>
<pre><span class="lineno"><a href="#line_1570" id="line_1570"> 1570.</a></span><span class="count        ">      1</span><span>    [</span></pre>
<pre><span class="lineno"><a href="#line_1571" id="line_1571"> 1571.</a></span><span class="count        ">      1</span><span>        moduleChildProcess,</span></pre>
<pre><span class="lineno"><a href="#line_1572" id="line_1572"> 1572.</a></span><span class="count        ">      1</span><span>        moduleCrypto,</span></pre>
<pre><span class="lineno"><a href="#line_1573" id="line_1573"> 1573.</a></span><span class="count        ">      1</span><span>        moduleFs,</span></pre>
<pre><span class="lineno"><a href="#line_1574" id="line_1574"> 1574.</a></span><span class="count        ">      1</span><span>        modulePath,</span></pre>
<pre><span class="lineno"><a href="#line_1575" id="line_1575"> 1575.</a></span><span class="count        ">      1</span><span>        moduleUrl</span></pre>
<pre><span class="lineno"><a href="#line_1576" id="line_1576"> 1576.</a></span><span class="count        ">      1</span><span>    ] = await Promise.all([</span></pre>
<pre><span class="lineno"><a href="#line_1577" id="line_1577"> 1577.</a></span><span class="count        ">      1</span><span>        import("child_process"),</span></pre>
<pre><span class="lineno"><a href="#line_1578" id="line_1578"> 1578.</a></span><span class="count        ">      1</span><span>        import("crypto"),</span></pre>
<pre><span class="lineno"><a href="#line_1579" id="line_1579"> 1579.</a></span><span class="count        ">      1</span><span>        import("fs"),</span></pre>
<pre><span class="lineno"><a href="#line_1580" id="line_1580"> 1580.</a></span><span class="count        ">      1</span><span>        import("path"),</span></pre>
<pre><span class="lineno"><a href="#line_1581" id="line_1581"> 1581.</a></span><span class="count        ">      1</span><span>        import("url")</span></pre>
<pre><span class="lineno"><a href="#line_1582" id="line_1582"> 1582.</a></span><span class="count        ">      1</span><span>    ]);</span></pre>
<pre><span class="lineno"><a href="#line_1583" id="line_1583"> 1583.</a></span><span class="count        ">      1</span><span>    while (moduleFsInitResolveList.length &gt; 0) {</span></pre>
<pre><span class="lineno"><a href="#line_1584" id="line_1584"> 1584.</a></span><span class="count        ">      1</span><span>        moduleFsInitResolveList.shift()();</span></pre>
<pre><span class="lineno"><a href="#line_1585" id="line_1585"> 1585.</a></span><span class="count        ">      1</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1586" id="line_1586"> 1586.</a></span><span class="count        ">      8</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1587" id="line_1587"> 1587.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1588" id="line_1588"> 1588.</a></span><span class="count        ">    236</span><span>function noop(val) {</span></pre>
<pre><span class="lineno"><a href="#line_1589" id="line_1589"> 1589.</a></span><span class="count        ">    236</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1590" id="line_1590"> 1590.</a></span><span class="count        ">    236</span><span>// This function will do nothing except return &lt;val&gt;.</span></pre>
<pre><span class="lineno"><a href="#line_1591" id="line_1591"> 1591.</a></span><span class="count        ">    236</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1592" id="line_1592"> 1592.</a></span><span class="count        ">    236</span><span>    return val;</span></pre>
<pre><span class="lineno"><a href="#line_1593" id="line_1593"> 1593.</a></span><span class="count        ">    236</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1594" id="line_1594"> 1594.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1595" id="line_1595"> 1595.</a></span><span class="count        ">  42580</span><span>function objectDeepCopyWithKeysSorted(obj) {</span></pre>
<pre><span class="lineno"><a href="#line_1596" id="line_1596"> 1596.</a></span><span class="count        ">  42580</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1597" id="line_1597"> 1597.</a></span><span class="count        ">  42580</span><span>// This function will recursively deep-copy &lt;obj&gt; with keys sorted.</span></pre>
<pre><span class="lineno"><a href="#line_1598" id="line_1598"> 1598.</a></span><span class="count        ">  42580</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1599" id="line_1599"> 1599.</a></span><span class="count        ">  42580</span><span>    let sorted;</span></pre>
<pre><span class="lineno"><a href="#line_1600" id="line_1600"> 1600.</a></span><span class="count        ">  28132</span><span>    if (typeof obj !== "object" || !obj) {</span></pre>
<pre><span class="lineno"><a href="#line_1601" id="line_1601"> 1601.</a></span><span class="count        ">  28132</span><span>        return obj;</span></pre>
<pre><span class="lineno"><a href="#line_1602" id="line_1602"> 1602.</a></span><span class="count        ">  28132</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1603" id="line_1603"> 1603.</a></span><span class="count        ">  14448</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1604" id="line_1604"> 1604.</a></span><span class="count        ">  14448</span><span>// Recursively deep-copy list with child-keys sorted.</span></pre>
<pre><span class="lineno"><a href="#line_1605" id="line_1605"> 1605.</a></span><span class="count        ">  14448</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1606" id="line_1606"> 1606.</a></span><span class="count        ">  14448</span><span>    if (Array.isArray(obj)) {</span></pre>
<pre><span class="lineno"><a href="#line_1607" id="line_1607"> 1607.</a></span><span class="count        ">   2202</span><span>        return obj.map(objectDeepCopyWithKeysSorted);</span></pre>
<pre><span class="lineno"><a href="#line_1608" id="line_1608"> 1608.</a></span><span class="count        ">  12246</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1609" id="line_1609"> 1609.</a></span><span class="count        ">  12246</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1610" id="line_1610"> 1610.</a></span><span class="count        ">  12246</span><span>// Recursively deep-copy obj with keys sorted.</span></pre>
<pre><span class="lineno"><a href="#line_1611" id="line_1611"> 1611.</a></span><span class="count        ">  12246</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1612" id="line_1612"> 1612.</a></span><span class="count        ">  12246</span><span>    sorted = Object.create(null);</span></pre>
<pre><span class="lineno"><a href="#line_1613" id="line_1613"> 1613.</a></span><span class="count        ">  13522</span><span>    Object.keys(obj).sort().forEach(function (key) {</span></pre>
<pre><span class="lineno"><a href="#line_1614" id="line_1614"> 1614.</a></span><span class="count        ">  13522</span><span>        sorted[key] = objectDeepCopyWithKeysSorted(obj[key]);</span></pre>
<pre><span class="lineno"><a href="#line_1615" id="line_1615"> 1615.</a></span><span class="count        ">  13522</span><span>    });</span></pre>
<pre><span class="lineno"><a href="#line_1616" id="line_1616"> 1616.</a></span><span class="count        ">  12246</span><span>    return sorted;</span></pre>
<pre><span class="lineno"><a href="#line_1617" id="line_1617"> 1617.</a></span><span class="count        ">  12246</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1618" id="line_1618"> 1618.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1619" id="line_1619"> 1619.</a></span><span class="count        ">      3</span><span>async function sqlmathInit() {</span></pre>
<pre><span class="lineno"><a href="#line_1620" id="line_1620"> 1620.</a></span><span class="count        ">      3</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1621" id="line_1621"> 1621.</a></span><span class="count        ">      3</span><span>// This function will init sqlmath.</span></pre>
<pre><span class="lineno"><a href="#line_1622" id="line_1622"> 1622.</a></span><span class="count        ">      3</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1623" id="line_1623"> 1623.</a></span><span class="count        ">      3</span><span>    let moduleModule;</span></pre>
<pre><span class="lineno"><a href="#line_1624" id="line_1624"> 1624.</a></span><span class="count        ">      3</span><span>    dbFinalizationRegistry = (</span></pre>
<pre><span class="lineno"><a href="#line_1625" id="line_1625"> 1625.</a></span><span class="count        ">      3</span><span>        dbFinalizationRegistry</span></pre>
<pre><span class="lineno"><a href="#line_1626" id="line_1626"> 1626.</a></span><span class="count        ">     28</span><span>    ) || new FinalizationRegistry(function ({afterFinalization, ptr}) {</span></pre>
<pre><span class="lineno"><a href="#line_1627" id="line_1627"> 1627.</a></span><span class="count        ">     28</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1628" id="line_1628"> 1628.</a></span><span class="count        ">     28</span><span>// This function will auto-close any open sqlite3-db-pointer,</span></pre>
<pre><span class="lineno"><a href="#line_1629" id="line_1629"> 1629.</a></span><span class="count        ">     28</span><span>// after its js-wrapper has been garbage-collected.</span></pre>
<pre><span class="lineno"><a href="#line_1630" id="line_1630"> 1630.</a></span><span class="count        ">     28</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1631" id="line_1631"> 1631.</a></span><span class="count        ">     28</span><span>        dbCallAsync(jsbatonCreate("_dbClose"), [ptr[0]]);</span></pre>
<pre><span class="lineno"><a href="#line_1632" id="line_1632"> 1632.</a></span><span class="count        ">      1</span><span>        if (afterFinalization) {</span></pre>
<pre><span class="lineno"><a href="#line_1633" id="line_1633"> 1633.</a></span><span class="count        ">      1</span><span>            afterFinalization();</span></pre>
<pre><span class="lineno"><a href="#line_1634" id="line_1634"> 1634.</a></span><span class="count        ">      1</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_1635" id="line_1635"> 1635.</a></span><span class="count        ">     28</span><span>    });</span></pre>
<pre><span class="lineno"><a href="#line_1636" id="line_1636"> 1636.</a></span><span class="count        ">      3</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1637" id="line_1637"> 1637.</a></span><span class="count        ">      3</span><span>// Feature-detect nodejs.</span></pre>
<pre><span class="lineno"><a href="#line_1638" id="line_1638"> 1638.</a></span><span class="count        ">      3</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1639" id="line_1639"> 1639.</a></span><span class="count        ">      3</span><span>    if (</span></pre>
<pre><span class="lineno"><a href="#line_1640" id="line_1640"> 1640.</a></span><span class="count        ">      3</span><span>        typeof process !== "object"</span></pre>
<pre><span class="lineno"><a href="#line_1641" id="line_1641"> 1641.</a></span><span class="count        ">      3</span><span>        || typeof process?.versions?.node !== "string"</span></pre>
<pre><span class="lineno"><a href="#line_1642" id="line_1642"> 1642.</a></span><span class="count        ">      3</span><span>        || cModule</span></pre>
<pre><span class="lineno"><a href="#line_1643" id="line_1643"> 1643.</a></span><span class="count        ">      1</span><span>    ) {</span></pre>
<pre><span class="lineno"><a href="#line_1644" id="line_1644"> 1644.</a></span><span class="count        ">      1</span><span>        return;</span></pre>
<pre><span class="lineno"><a href="#line_1645" id="line_1645"> 1645.</a></span><span class="count        ">      2</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1646" id="line_1646"> 1646.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1647" id="line_1647"> 1647.</a></span><span class="count        ">      2</span><span>// Init moduleFs.</span></pre>
<pre><span class="lineno"><a href="#line_1648" id="line_1648"> 1648.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1649" id="line_1649"> 1649.</a></span><span class="count        ">      2</span><span>    await moduleFsInit();</span></pre>
<pre><span class="lineno"><a href="#line_1650" id="line_1650"> 1650.</a></span><span class="count        ">      2</span><span>    moduleFsInit(); // coverage-hack</span></pre>
<pre><span class="lineno"><a href="#line_1651" id="line_1651"> 1651.</a></span><span class="count        ">      2</span><span>    moduleChildProcessSpawn = moduleChildProcess.spawn;</span></pre>
<pre><span class="lineno"><a href="#line_1652" id="line_1652"> 1652.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1653" id="line_1653"> 1653.</a></span><span class="count        ">      2</span><span>// Init moduleFs.</span></pre>
<pre><span class="lineno"><a href="#line_1654" id="line_1654"> 1654.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1655" id="line_1655"> 1655.</a></span><span class="count        ">      2</span><span>    await moduleFsInit();</span></pre>
<pre><span class="lineno"><a href="#line_1656" id="line_1656"> 1656.</a></span><span class="count        ">      2</span><span>    moduleFsInit(); // coverage-hack</span></pre>
<pre><span class="lineno"><a href="#line_1657" id="line_1657"> 1657.</a></span><span class="count        ">      2</span><span>    moduleChildProcessSpawn = moduleChildProcess.spawn;</span></pre>
<pre><span class="lineno"><a href="#line_1658" id="line_1658"> 1658.</a></span><span class="count        ">      2</span><span>    cModulePath = moduleUrl.fileURLToPath(import.meta.url).replace(</span></pre>
<pre><span class="lineno"><a href="#line_1659" id="line_1659"> 1659.</a></span><span class="count        ">      2</span><span>        (/\bsqlmath\.mjs$/),</span></pre>
<pre><span class="lineno"><a href="#line_1660" id="line_1660"> 1660.</a></span><span class="count        ">      2</span><span>        `_sqlmath.napi6_${process.platform}_${process.arch}.node`</span></pre>
<pre><span class="lineno"><a href="#line_1661" id="line_1661"> 1661.</a></span><span class="count        ">      2</span><span>    );</span></pre>
<pre><span class="lineno"><a href="#line_1662" id="line_1662"> 1662.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1663" id="line_1663"> 1663.</a></span><span class="count        ">      2</span><span>// Import napi c-addon.</span></pre>
<pre><span class="lineno"><a href="#line_1664" id="line_1664"> 1664.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1665" id="line_1665"> 1665.</a></span><span class="count        ">      2</span><span>    if (!npm_config_mode_setup) {</span></pre>
<pre><span class="lineno"><a href="#line_1666" id="line_1666"> 1666.</a></span><span class="count        ">      2</span><span>        moduleModule = await import("module");</span></pre>
<pre><span class="lineno"><a href="#line_1667" id="line_1667"> 1667.</a></span><span class="count        ">      2</span><span>        if (!cModule) {</span></pre>
<pre><span class="lineno"><a href="#line_1668" id="line_1668"> 1668.</a></span><span class="count        ">      2</span><span>            cModule = moduleModule.createRequire(cModulePath);</span></pre>
<pre><span class="lineno"><a href="#line_1669" id="line_1669"> 1669.</a></span><span class="count        ">      2</span><span>            cModule = cModule(cModulePath);</span></pre>
<pre><span class="lineno"><a href="#line_1670" id="line_1670"> 1670.</a></span><span class="count        ">      2</span><span>        }</span></pre>
<pre><span class="lineno"><a href="#line_1671" id="line_1671"> 1671.</a></span><span class="count        ">      2</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1672" id="line_1672"> 1672.</a></span><span class="count        ">      2</span><span>    if (npm_config_mode_test) {</span></pre>
<pre><span class="lineno"><a href="#line_1673" id="line_1673"> 1673.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1674" id="line_1674"> 1674.</a></span><span class="count        ">      2</span><span>// Mock consoleError.</span></pre>
<pre><span class="lineno"><a href="#line_1675" id="line_1675"> 1675.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1676" id="line_1676"> 1676.</a></span><span class="count        ">      2</span><span>        consoleError = noop;</span></pre>
<pre><span class="lineno"><a href="#line_1677" id="line_1677"> 1677.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1678" id="line_1678"> 1678.</a></span><span class="count        ">      2</span><span>// Mock moduleChildProcessSpawn.</span></pre>
<pre><span class="lineno"><a href="#line_1679" id="line_1679"> 1679.</a></span><span class="count        ">      2</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1680" id="line_1680"> 1680.</a></span><span class="count        ">     15</span><span>        moduleChildProcessSpawn = function () {</span></pre>
<pre><span class="lineno"><a href="#line_1681" id="line_1681"> 1681.</a></span><span class="count        ">     15</span><span>            let child = {</span></pre>
<pre><span class="lineno"><a href="#line_1682" id="line_1682"> 1682.</a></span><span class="count        ">     15</span><span>                end: noop,</span></pre>
<pre><span class="lineno"><a href="#line_1683" id="line_1683"> 1683.</a></span><span class="count        ">     17</span><span>                on: function (onType, resolve) {</span></pre>
<pre><span class="lineno"><a href="#line_1684" id="line_1684"> 1684.</a></span><span class="count        ">     17</span><span>                    switch (onType) {</span></pre>
<pre><span class="lineno"><a href="#line_1685" id="line_1685"> 1685.</a></span><span class="count        ">      2</span><span>                    case "data":</span></pre>
<pre><span class="lineno"><a href="#line_1686" id="line_1686"> 1686.</a></span><span class="count        ">      2</span><span>                        resolve(Buffer.alloc(0));</span></pre>
<pre><span class="lineno"><a href="#line_1687" id="line_1687"> 1687.</a></span><span class="count        ">      2</span><span>                        return;</span></pre>
<pre><span class="lineno"><a href="#line_1688" id="line_1688"> 1688.</a></span><span class="count        ">     15</span><span>                    default:</span></pre>
<pre><span class="lineno"><a href="#line_1689" id="line_1689"> 1689.</a></span><span class="count        ">     15</span><span>                        resolve(0);</span></pre>
<pre><span class="lineno"><a href="#line_1690" id="line_1690"> 1690.</a></span><span class="count        ">     17</span><span>                    }</span></pre>
<pre><span class="lineno"><a href="#line_1691" id="line_1691"> 1691.</a></span><span class="count        ">     17</span><span>                },</span></pre>
<pre><span class="lineno"><a href="#line_1692" id="line_1692"> 1692.</a></span><span class="count        ">     15</span><span>                setEncoding: noop,</span></pre>
<pre><span class="lineno"><a href="#line_1693" id="line_1693"> 1693.</a></span><span class="count        ">     15</span><span>                write: noop</span></pre>
<pre><span class="lineno"><a href="#line_1694" id="line_1694"> 1694.</a></span><span class="count        ">     15</span><span>            };</span></pre>
<pre><span class="lineno"><a href="#line_1695" id="line_1695"> 1695.</a></span><span class="count        ">     15</span><span>            child.stderr = child;</span></pre>
<pre><span class="lineno"><a href="#line_1696" id="line_1696"> 1696.</a></span><span class="count        ">     15</span><span>            child.stdin = child;</span></pre>
<pre><span class="lineno"><a href="#line_1697" id="line_1697"> 1697.</a></span><span class="count        ">     15</span><span>            child.stdout = child;</span></pre>
<pre><span class="lineno"><a href="#line_1698" id="line_1698"> 1698.</a></span><span class="count        ">     15</span><span>            return child;</span></pre>
<pre><span class="lineno"><a href="#line_1699" id="line_1699"> 1699.</a></span><span class="count        ">     15</span><span>        };</span></pre>
<pre><span class="lineno"><a href="#line_1700" id="line_1700"> 1700.</a></span><span class="count        ">      2</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1701" id="line_1701"> 1701.</a></span><span class="count        ">      3</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1702" id="line_1702"> 1702.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1703" id="line_1703"> 1703.</a></span><span class="count        ">      1</span><span>function sqlmathWebworkerInit({</span></pre>
<pre><span class="lineno"><a href="#line_1704" id="line_1704"> 1704.</a></span><span class="count        ">      1</span><span>    db,</span></pre>
<pre><span class="lineno"><a href="#line_1705" id="line_1705"> 1705.</a></span><span class="count        ">      1</span><span>    modeTest</span></pre>
<pre><span class="lineno"><a href="#line_1706" id="line_1706"> 1706.</a></span><span class="count        ">      1</span><span>}) {</span></pre>
<pre><span class="lineno"><a href="#line_1707" id="line_1707"> 1707.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1708" id="line_1708"> 1708.</a></span><span class="count        ">      1</span><span>// This function will init sqlmath web-worker.</span></pre>
<pre><span class="lineno"><a href="#line_1709" id="line_1709"> 1709.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1710" id="line_1710"> 1710.</a></span><span class="count        ">      1</span><span>// Feature-detect browser.</span></pre>
<pre><span class="lineno"><a href="#line_1711" id="line_1711"> 1711.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1712" id="line_1712"> 1712.</a></span><span class="count        ">      1</span><span>    let Worker = globalThis.Worker;</span></pre>
<pre><span class="lineno"><a href="#line_1713" id="line_1713"> 1713.</a></span><span class="count        ">      1</span><span>    IS_BROWSER = true;</span></pre>
<pre><span class="lineno"><a href="#line_1714" id="line_1714"> 1714.</a></span><span class="count        ">      1</span><span>    if (modeTest) {</span></pre>
<pre><span class="lineno"><a href="#line_1715" id="line_1715"> 1715.</a></span><span class="count        ">      1</span><span>        Worker = function () {</span></pre>
<pre><span class="lineno"><a href="#line_1716" id="line_1716"> 1716.</a></span><span class="count        ">      1</span><span>            return;</span></pre>
<pre><span class="lineno"><a href="#line_1717" id="line_1717"> 1717.</a></span><span class="count        ">      1</span><span>        };</span></pre>
<pre><span class="lineno"><a href="#line_1718" id="line_1718"> 1718.</a></span><span class="count        ">      1</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1719" id="line_1719"> 1719.</a></span><span class="count        ">      1</span><span>    sqlWorker = new Worker("sqlmath_wasm.js");</span></pre>
<pre><span class="lineno"><a href="#line_1720" id="line_1720"> 1720.</a></span><span class="count        ">      2</span><span>    sqlWorker.onmessage = function ({</span></pre>
<pre><span class="lineno"><a href="#line_1721" id="line_1721"> 1721.</a></span><span class="count        ">      2</span><span>        data</span></pre>
<pre><span class="lineno"><a href="#line_1722" id="line_1722"> 1722.</a></span><span class="count        ">      2</span><span>    }) {</span></pre>
<pre><span class="lineno"><a href="#line_1723" id="line_1723"> 1723.</a></span><span class="count        ">      2</span><span>        sqlMessageDict[data.id](data);</span></pre>
<pre><span class="lineno"><a href="#line_1724" id="line_1724"> 1724.</a></span><span class="count        ">      2</span><span>    };</span></pre>
<pre><span class="lineno"><a href="#line_1725" id="line_1725"> 1725.</a></span><span class="count        ">      1</span><span>    if (modeTest) {</span></pre>
<pre><span class="lineno"><a href="#line_1726" id="line_1726"> 1726.</a></span><span class="count        ">      2</span><span>        sqlWorker.postMessage = function (data) {</span></pre>
<pre><span class="lineno"><a href="#line_1727" id="line_1727"> 1727.</a></span><span class="count        ">      2</span><span>            setTimeout(function () {</span></pre>
<pre><span class="lineno"><a href="#line_1728" id="line_1728"> 1728.</a></span><span class="count        ">      2</span><span>                sqlWorker.onmessage({data});</span></pre>
<pre><span class="lineno"><a href="#line_1729" id="line_1729"> 1729.</a></span><span class="count        ">      2</span><span>            });</span></pre>
<pre><span class="lineno"><a href="#line_1730" id="line_1730"> 1730.</a></span><span class="count        ">      2</span><span>        };</span></pre>
<pre><span class="lineno"><a href="#line_1731" id="line_1731"> 1731.</a></span><span class="count        ">      1</span><span>        // test dbCallAsync handling-behavior</span></pre>
<pre><span class="lineno"><a href="#line_1732" id="line_1732"> 1732.</a></span><span class="count        ">      1</span><span>        dbCallAsync(jsbatonCreate("testTimeElapsed"), [true]);</span></pre>
<pre><span class="lineno"><a href="#line_1733" id="line_1733"> 1733.</a></span><span class="count        ">      1</span><span>        // test dbFileLoadAsync handling-behavior</span></pre>
<pre><span class="lineno"><a href="#line_1734" id="line_1734"> 1734.</a></span><span class="count        ">      1</span><span>        dbFileLoadAsync({db, filename: "aa", modeTest});</span></pre>
<pre><span class="lineno"><a href="#line_1735" id="line_1735"> 1735.</a></span><span class="count        ">      1</span><span>        // test jsonParseArraybuffer handling-behavior</span></pre>
<pre><span class="lineno"><a href="#line_1736" id="line_1736"> 1736.</a></span><span class="count        ">      1</span><span>        jsonParseArraybuffer(new TextEncoder().encode("0"));</span></pre>
<pre><span class="lineno"><a href="#line_1737" id="line_1737"> 1737.</a></span><span class="count        ">      1</span><span>        // revert IS_BROWSER</span></pre>
<pre><span class="lineno"><a href="#line_1738" id="line_1738"> 1738.</a></span><span class="count        ">      1</span><span>        IS_BROWSER = undefined;</span></pre>
<pre><span class="lineno"><a href="#line_1739" id="line_1739"> 1739.</a></span><span class="count        ">      1</span><span>    }</span></pre>
<pre><span class="lineno"><a href="#line_1740" id="line_1740"> 1740.</a></span><span class="count        ">      1</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1741" id="line_1741"> 1741.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1742" id="line_1742"> 1742.</a></span><span class="count        ">      1</span><span>function waitAsync(timeout) {</span></pre>
<pre><span class="lineno"><a href="#line_1743" id="line_1743"> 1743.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1744" id="line_1744"> 1744.</a></span><span class="count        ">      1</span><span>// This function will wait &lt;timeout&gt; ms.</span></pre>
<pre><span class="lineno"><a href="#line_1745" id="line_1745"> 1745.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1746" id="line_1746"> 1746.</a></span><span class="count        ">      1</span><span>    return new Promise(function (resolve) {</span></pre>
<pre><span class="lineno"><a href="#line_1747" id="line_1747"> 1747.</a></span><span class="count        ">      1</span><span>        setTimeout(resolve, timeout * !npm_config_mode_test);</span></pre>
<pre><span class="lineno"><a href="#line_1748" id="line_1748"> 1748.</a></span><span class="count        ">      1</span><span>    });</span></pre>
<pre><span class="lineno"><a href="#line_1749" id="line_1749"> 1749.</a></span><span class="count        ">      1</span><span>}</span></pre>
<pre><span class="lineno"><a href="#line_1750" id="line_1750"> 1750.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1751" id="line_1751"> 1751.</a></span><span class="count        ">      1</span><span>sqlmathInit(); // coverage-hack</span></pre>
<pre><span class="lineno"><a href="#line_1752" id="line_1752"> 1752.</a></span><span class="count        ">      1</span><span>await sqlmathInit();</span></pre>
<pre><span class="lineno"><a href="#line_1753" id="line_1753"> 1753.</a></span><span class="count        ">      1</span><span>sqlmathInit(); // coverage-hack</span></pre>
<pre><span class="lineno"><a href="#line_1754" id="line_1754"> 1754.</a></span><span class="count        ">      1</span><span></span></pre>
<pre><span class="lineno"><a href="#line_1755" id="line_1755"> 1755.</a></span><span class="count        ">      1</span><span>export {</span></pre>
<pre><span class="lineno"><a href="#line_1756" id="line_1756"> 1756.</a></span><span class="count        ">      1</span><span>    LGBM_DTYPE_FLOAT32,</span></pre>
<pre><span class="lineno"><a href="#line_1757" id="line_1757"> 1757.</a></span><span class="count        ">      1</span><span>    LGBM_DTYPE_FLOAT64,</span></pre>
<pre><span class="lineno"><a href="#line_1758" id="line_1758"> 1758.</a></span><span class="count        ">      1</span><span>    LGBM_DTYPE_INT32,</span></pre>
<pre><span class="lineno"><a href="#line_1759" id="line_1759"> 1759.</a></span><span class="count        ">      1</span><span>    LGBM_DTYPE_INT64,</span></pre>
<pre><span class="lineno"><a href="#line_1760" id="line_1760"> 1760.</a></span><span class="count        ">      1</span><span>    LGBM_FEATURE_IMPORTANCE_GAIN,</span></pre>
<pre><span class="lineno"><a href="#line_1761" id="line_1761"> 1761.</a></span><span class="count        ">      1</span><span>    LGBM_FEATURE_IMPORTANCE_SPLIT,</span></pre>
<pre><span class="lineno"><a href="#line_1762" id="line_1762"> 1762.</a></span><span class="count        ">      1</span><span>    LGBM_MATRIX_TYPE_CSC,</span></pre>
<pre><span class="lineno"><a href="#line_1763" id="line_1763"> 1763.</a></span><span class="count        ">      1</span><span>    LGBM_MATRIX_TYPE_CSR,</span></pre>
<pre><span class="lineno"><a href="#line_1764" id="line_1764"> 1764.</a></span><span class="count        ">      1</span><span>    LGBM_PREDICT_CONTRIB,</span></pre>
<pre><span class="lineno"><a href="#line_1765" id="line_1765"> 1765.</a></span><span class="count        ">      1</span><span>    LGBM_PREDICT_LEAF_INDEX,</span></pre>
<pre><span class="lineno"><a href="#line_1766" id="line_1766"> 1766.</a></span><span class="count        ">      1</span><span>    LGBM_PREDICT_NORMAL,</span></pre>
<pre><span class="lineno"><a href="#line_1767" id="line_1767"> 1767.</a></span><span class="count        ">      1</span><span>    LGBM_PREDICT_RAW_SCORE,</span></pre>
<pre><span class="lineno"><a href="#line_1768" id="line_1768"> 1768.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_AUTOPROXY,</span></pre>
<pre><span class="lineno"><a href="#line_1769" id="line_1769"> 1769.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_CREATE,</span></pre>
<pre><span class="lineno"><a href="#line_1770" id="line_1770"> 1770.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_DELETEONCLOSE,</span></pre>
<pre><span class="lineno"><a href="#line_1771" id="line_1771"> 1771.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_EXCLUSIVE,</span></pre>
<pre><span class="lineno"><a href="#line_1772" id="line_1772"> 1772.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_FULLMUTEX,</span></pre>
<pre><span class="lineno"><a href="#line_1773" id="line_1773"> 1773.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_MAIN_DB,</span></pre>
<pre><span class="lineno"><a href="#line_1774" id="line_1774"> 1774.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_MAIN_JOURNAL,</span></pre>
<pre><span class="lineno"><a href="#line_1775" id="line_1775"> 1775.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_MEMORY,</span></pre>
<pre><span class="lineno"><a href="#line_1776" id="line_1776"> 1776.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_NOFOLLOW,</span></pre>
<pre><span class="lineno"><a href="#line_1777" id="line_1777"> 1777.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_NOMUTEX,</span></pre>
<pre><span class="lineno"><a href="#line_1778" id="line_1778"> 1778.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_PRIVATECACHE,</span></pre>
<pre><span class="lineno"><a href="#line_1779" id="line_1779"> 1779.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_READONLY,</span></pre>
<pre><span class="lineno"><a href="#line_1780" id="line_1780"> 1780.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_READWRITE,</span></pre>
<pre><span class="lineno"><a href="#line_1781" id="line_1781"> 1781.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_SHAREDCACHE,</span></pre>
<pre><span class="lineno"><a href="#line_1782" id="line_1782"> 1782.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_SUBJOURNAL,</span></pre>
<pre><span class="lineno"><a href="#line_1783" id="line_1783"> 1783.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_SUPER_JOURNAL,</span></pre>
<pre><span class="lineno"><a href="#line_1784" id="line_1784"> 1784.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_TEMP_DB,</span></pre>
<pre><span class="lineno"><a href="#line_1785" id="line_1785"> 1785.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_TEMP_JOURNAL,</span></pre>
<pre><span class="lineno"><a href="#line_1786" id="line_1786"> 1786.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_TRANSIENT_DB,</span></pre>
<pre><span class="lineno"><a href="#line_1787" id="line_1787"> 1787.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_URI,</span></pre>
<pre><span class="lineno"><a href="#line_1788" id="line_1788"> 1788.</a></span><span class="count        ">      1</span><span>    SQLITE_OPEN_WAL,</span></pre>
<pre><span class="lineno"><a href="#line_1789" id="line_1789"> 1789.</a></span><span class="count        ">      1</span><span>    assertErrorThrownAsync,</span></pre>
<pre><span class="lineno"><a href="#line_1790" id="line_1790"> 1790.</a></span><span class="count        ">      1</span><span>    assertInt64,</span></pre>
<pre><span class="lineno"><a href="#line_1791" id="line_1791"> 1791.</a></span><span class="count        ">      1</span><span>    assertJsonEqual,</span></pre>
<pre><span class="lineno"><a href="#line_1792" id="line_1792"> 1792.</a></span><span class="count        ">      1</span><span>    assertNumericalEqual,</span></pre>
<pre><span class="lineno"><a href="#line_1793" id="line_1793"> 1793.</a></span><span class="count        ">      1</span><span>    assertOrThrow,</span></pre>
<pre><span class="lineno"><a href="#line_1794" id="line_1794"> 1794.</a></span><span class="count        ">      1</span><span>    childProcessSpawn2,</span></pre>
<pre><span class="lineno"><a href="#line_1795" id="line_1795"> 1795.</a></span><span class="count        ">      1</span><span>    ciBuildExt,</span></pre>
<pre><span class="lineno"><a href="#line_1796" id="line_1796"> 1796.</a></span><span class="count        ">      1</span><span>    dbCloseAsync,</span></pre>
<pre><span class="lineno"><a href="#line_1797" id="line_1797"> 1797.</a></span><span class="count        ">      1</span><span>    dbExecAndReturnLastBlob,</span></pre>
<pre><span class="lineno"><a href="#line_1798" id="line_1798"> 1798.</a></span><span class="count        ">      1</span><span>    dbExecAndReturnLastRow,</span></pre>
<pre><span class="lineno"><a href="#line_1799" id="line_1799"> 1799.</a></span><span class="count        ">      1</span><span>    dbExecAndReturnLastTable,</span></pre>
<pre><span class="lineno"><a href="#line_1800" id="line_1800"> 1800.</a></span><span class="count        ">      1</span><span>    dbExecAndReturnLastValue,</span></pre>
<pre><span class="lineno"><a href="#line_1801" id="line_1801"> 1801.</a></span><span class="count        ">      1</span><span>    dbExecAsync,</span></pre>
<pre><span class="lineno"><a href="#line_1802" id="line_1802"> 1802.</a></span><span class="count        ">      1</span><span>    dbFileLoadAsync,</span></pre>
<pre><span class="lineno"><a href="#line_1803" id="line_1803"> 1803.</a></span><span class="count        ">      1</span><span>    dbFileSaveAsync,</span></pre>
<pre><span class="lineno"><a href="#line_1804" id="line_1804"> 1804.</a></span><span class="count        ">      1</span><span>    dbNoopAsync,</span></pre>
<pre><span class="lineno"><a href="#line_1805" id="line_1805"> 1805.</a></span><span class="count        ">      1</span><span>    dbOpenAsync,</span></pre>
<pre><span class="lineno"><a href="#line_1806" id="line_1806"> 1806.</a></span><span class="count        ">      1</span><span>    dbTableImportAsync,</span></pre>
<pre><span class="lineno"><a href="#line_1807" id="line_1807"> 1807.</a></span><span class="count        ">      1</span><span>    debugInline,</span></pre>
<pre><span class="lineno"><a href="#line_1808" id="line_1808"> 1808.</a></span><span class="count        ">      1</span><span>    fsCopyFileUnlessTest,</span></pre>
<pre><span class="lineno"><a href="#line_1809" id="line_1809"> 1809.</a></span><span class="count        ">      1</span><span>    fsExistsUnlessTest,</span></pre>
<pre><span class="lineno"><a href="#line_1810" id="line_1810"> 1810.</a></span><span class="count        ">      1</span><span>    fsReadFileUnlessTest,</span></pre>
<pre><span class="lineno"><a href="#line_1811" id="line_1811"> 1811.</a></span><span class="count        ">      1</span><span>    fsWriteFileUnlessTest,</span></pre>
<pre><span class="lineno"><a href="#line_1812" id="line_1812"> 1812.</a></span><span class="count        ">      1</span><span>    jsbatonGetInt64,</span></pre>
<pre><span class="lineno"><a href="#line_1813" id="line_1813"> 1813.</a></span><span class="count        ">      1</span><span>    jsbatonGetString,</span></pre>
<pre><span class="lineno"><a href="#line_1814" id="line_1814"> 1814.</a></span><span class="count        ">      1</span><span>    listOrEmptyList,</span></pre>
<pre><span class="lineno"><a href="#line_1815" id="line_1815"> 1815.</a></span><span class="count        ">      1</span><span>    noop,</span></pre>
<pre><span class="lineno"><a href="#line_1816" id="line_1816"> 1816.</a></span><span class="count        ">      1</span><span>    objectDeepCopyWithKeysSorted,</span></pre>
<pre><span class="lineno"><a href="#line_1817" id="line_1817"> 1817.</a></span><span class="count        ">      1</span><span>    sqlmathWebworkerInit,</span></pre>
<pre><span class="lineno"><a href="#line_1818" id="line_1818"> 1818.</a></span><span class="count        ">      1</span><span>    version,</span></pre>
<pre><span class="lineno"><a href="#line_1819" id="line_1819"> 1819.</a></span><span class="count        ">      1</span><span>    waitAsync</span></pre>
<pre><span class="lineno"><a href="#line_1820" id="line_1820"> 1820.</a></span><span class="count        ">      1</span><span>};</span></pre>
<pre><span class="lineno"><a href="#line_1821" id="line_1821"> 1821.</a></span><span class="count        ">      1</span><span></span></pre>
</div>
<!-- content end -->
<div class="footer">
  [
  This document was created with
  <a href="https://github.com/jslint-org/jslint">JSLint</a>
  ]
</div>
</body>
</html>
